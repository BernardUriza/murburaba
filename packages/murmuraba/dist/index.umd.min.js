!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Murmuraba={},e.React)}(this,function(e,t){"use strict";function a(e,t){return t.forEach(function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach(function(a){if("default"!==a&&!(a in e)){var s=Object.getOwnPropertyDescriptor(t,a);Object.defineProperty(e,a,s.get?s:{enumerable:!0,get:function(){return t[a]}})}})}),Object.freeze(e)}class s{constructor(){this.events=new Map}on(e,t){this.events.has(e)||this.events.set(e,new Set),this.events.get(e).add(t)}off(e,t){const a=this.events.get(e);a&&(a.delete(t),0===a.size&&this.events.delete(e))}emit(e,...t){const a=this.events.get(e);a&&a.forEach(a=>{try{a(...t)}catch(t){console.error(`Error in event handler for ${String(e)}:`,t)}})}once(e,t){const a=(...s)=>{this.off(e,a),t(...s)};this.on(e,a)}removeAllListeners(e){e?this.events.delete(e):this.events.clear()}listenerCount(e){const t=this.events.get(e);return t?t.size:0}}class r extends s{constructor(){super(...arguments),this.currentState="uninitialized",this.allowedTransitions=new Map([["uninitialized",["initializing","error"]],["initializing",["ready","error"]],["ready",["processing","destroying","error"]],["processing",["ready","paused","destroying","error"]],["paused",["processing","ready","destroying","error"]],["destroying",["destroyed","error"]],["destroyed",[]],["error",["initializing","destroying"]]])}getState(){return this.currentState}canTransitionTo(e){return(this.allowedTransitions.get(this.currentState)||[]).includes(e)}transitionTo(e){if(!this.canTransitionTo(e))return console.warn(`Invalid state transition: ${this.currentState} -> ${e}`),!1;const t=this.currentState;return this.currentState=e,this.emit("state-change",t,e),!0}isInState(...e){return e.includes(this.currentState)}requireState(...e){if(!this.isInState(...e))throw new Error(`Operation requires state to be one of: ${e.join(", ")}, but current state is: ${this.currentState}`)}reset(){const e=this.currentState;this.currentState="uninitialized","uninitialized"!==e&&this.emit("state-change",e,"uninitialized")}}class n{constructor(e="[Murmuraba]"){this.level="info",this.prefix=e}setLevel(e){this.level=e}setLogHandler(e){this.onLog=e}shouldLog(e){const t=["none","error","warn","info","debug"],a=t.indexOf(this.level),s=t.indexOf(e);return a>0&&s<=a}log(e,t,a){if(!this.shouldLog(e))return;const s=(new Date).toISOString(),r=`${this.prefix} [${s}] [${e.toUpperCase()}] ${t}`;if(this.onLog)this.onLog(e,r,a);else{const t="error"===e?console.error:"warn"===e?console.warn:console.log;void 0!==a?t(r,a):t(r)}}error(e,t){this.log("error",e,t)}warn(e,t){this.log("warn",e,t)}info(e,t){this.log("info",e,t)}debug(e,t){this.log("debug",e,t)}}class i extends Error{constructor(e,t,a){super(t),this.name="MurmubaraError",this.code=e,this.details=a}}const o={WASM_NOT_LOADED:"WASM_NOT_LOADED",INVALID_STREAM:"INVALID_STREAM",ENGINE_BUSY:"ENGINE_BUSY",INITIALIZATION_FAILED:"INITIALIZATION_FAILED",PROCESSING_FAILED:"PROCESSING_FAILED",CLEANUP_FAILED:"CLEANUP_FAILED",WORKER_ERROR:"WORKER_ERROR",INVALID_CONFIG:"INVALID_CONFIG",NOT_INITIALIZED:"NOT_INITIALIZED",ALREADY_INITIALIZED:"ALREADY_INITIALIZED"};class l{constructor(e){this.workers=new Map,this.logger=e}createWorker(e,t){if(this.workers.has(e))throw new i(o.WORKER_ERROR,`Worker with id ${e} already exists`);try{const a=new Worker(t);return this.workers.set(e,a),this.logger.debug(`Worker created: ${e}`),a}catch(t){throw this.logger.error(`Failed to create worker: ${e}`,t),new i(o.WORKER_ERROR,`Failed to create worker: ${t instanceof Error?t.message:String(t)}`)}}getWorker(e){return this.workers.get(e)}sendMessage(e,t){const a=this.workers.get(e);if(!a)throw new i(o.WORKER_ERROR,`Worker ${e} not found`);a.postMessage(t),this.logger.debug(`Message sent to worker ${e}:`,t)}terminateWorker(e){const t=this.workers.get(e);t&&(t.terminate(),this.workers.delete(e),this.logger.debug(`Worker terminated: ${e}`))}terminateAll(){this.logger.info(`Terminating all ${this.workers.size} workers`);for(const[e,t]of this.workers)t.terminate(),this.logger.debug(`Worker terminated: ${e}`);this.workers.clear()}getActiveWorkerCount(){return this.workers.size}getWorkerIds(){return Array.from(this.workers.keys())}}class _ extends s{constructor(){super(...arguments),this.metrics={noiseReductionLevel:0,processingLatency:0,inputLevel:0,outputLevel:0,timestamp:Date.now(),frameCount:0,droppedFrames:0},this.frameTimestamps=[],this.maxFrameHistory=100}startAutoUpdate(e=100){this.stopAutoUpdate(),this.updateInterval=setInterval(()=>{this.calculateLatency(),this.emit("metrics-update",{...this.metrics})},e)}stopAutoUpdate(){this.updateInterval&&(clearInterval(this.updateInterval),this.updateInterval=void 0)}updateInputLevel(e){this.metrics.inputLevel=Math.max(0,Math.min(1,e))}updateOutputLevel(e){this.metrics.outputLevel=Math.max(0,Math.min(1,e))}updateNoiseReduction(e){this.metrics.noiseReductionLevel=Math.max(0,Math.min(100,e))}recordFrame(e=Date.now()){this.frameTimestamps.push(e),this.frameTimestamps.length>this.maxFrameHistory&&this.frameTimestamps.shift(),this.metrics.frameCount++,this.metrics.timestamp=e}recordDroppedFrame(){this.metrics.droppedFrames++}recordChunk(e){this.emit("chunk-processed",e)}calculateLatency(){if(this.frameTimestamps.length<2)return void(this.metrics.processingLatency=0);const e=[];for(let t=1;t<this.frameTimestamps.length;t++)e.push(this.frameTimestamps[t]-this.frameTimestamps[t-1]);const t=e.reduce((e,t)=>e+t,0)/e.length;this.metrics.processingLatency=t}getMetrics(){return{...this.metrics}}reset(){this.metrics={noiseReductionLevel:0,processingLatency:0,inputLevel:0,outputLevel:0,timestamp:Date.now(),frameCount:0,droppedFrames:0},this.frameTimestamps=[]}calculateRMS(e){let t=0;for(let a=0;a<e.length;a++)t+=e[a]*e[a];return Math.sqrt(t/e.length)}calculatePeak(e){let t=0;for(let a=0;a<e.length;a++)t=Math.max(t,Math.abs(e[a]));return t}}class c extends s{constructor(e,t,a,s){super(),this.currentChunk=[],this.chunkStartTime=Date.now(),this.chunkIndex=0,this.currentSampleCount=0,this.overlapBuffer=[],this.logger=a,this.sampleRate=e,this.metricsManager=s,this.config={chunkDuration:t.chunkDuration,onChunkProcessed:t.onChunkProcessed||void 0,overlap:t.overlap||0},this.samplesPerChunk=Math.floor(this.config.chunkDuration/1e3*this.sampleRate),this.logger.info("ChunkProcessor initialized:",{sampleRate:this.sampleRate,chunkDuration:this.config.chunkDuration,samplesPerChunk:this.samplesPerChunk,overlap:this.config.overlap})}addSamples(e){for(0===this.chunkStartTime&&(this.chunkStartTime=Date.now()),this.currentChunk.push(new Float32Array(e)),this.currentSampleCount+=e.length;this.currentSampleCount>=this.samplesPerChunk;)this.processCurrentChunk()}processCurrentChunk(){const e="chunk-"+this.chunkIndex++,t=Date.now(),a=this.extractChunkSamples(),s=this.applyOverlap(a),r={id:e,data:s,startTime:this.chunkStartTime,endTime:t,sampleRate:this.sampleRate,channelCount:1};this.emit("chunk-ready",r),this.emitChunkMetrics(r,a,s),this.chunkStartTime=t}extractChunkSamples(){const e=new Float32Array(this.samplesPerChunk);let t=0,a=this.samplesPerChunk;for(;a>0&&this.currentChunk.length>0;){const s=this.currentChunk[0],r=Math.min(a,s.length);e.set(s.subarray(0,r),t),t+=r,a-=r,r===s.length?this.currentChunk.shift():this.currentChunk[0]=s.subarray(r)}return this.currentSampleCount-=this.samplesPerChunk,e}applyOverlap(e){if(0===this.config.overlap)return e;const t=Math.floor(this.samplesPerChunk*this.config.overlap),a=new Float32Array(e.length);if(a.set(e),this.overlapBuffer.length>0){const e=this.combineBuffers(this.overlapBuffer),s=Math.min(t,e.length);for(let t=0;t<s;t++){const r=t/s,n=1-r;a[t]=a[t]*r+e[t]*n}}return this.overlapBuffer=[e.subarray(e.length-t)],a}emitChunkMetrics(e,t,a){const s=this.metricsManager.calculateRMS(t),r=this.metricsManager.calculateRMS(a),n=this.metricsManager.calculatePeak(t),i=this.metricsManager.calculatePeak(a),o=s>0?(s-r)/s*100:0,l={originalSize:4*t.length,processedSize:4*a.length,noiseRemoved:Math.max(0,Math.min(100,o)),metrics:{noiseReductionLevel:o,processingLatency:e.endTime-e.startTime,inputLevel:n,outputLevel:i,timestamp:e.endTime,frameCount:Math.floor(a.length/480),droppedFrames:0},duration:this.config.chunkDuration,startTime:e.startTime,endTime:e.endTime};if(this.emit("chunk-processed",l),this.config.onChunkProcessed)try{this.config.onChunkProcessed(l)}catch(e){this.logger.error("Error in chunk processed callback:",e)}this.logger.debug(`Chunk ${e.id} processed:`,{duration:`${l.duration}ms`,noiseRemoved:`${l.noiseRemoved.toFixed(1)}%`,latency:`${l.metrics.processingLatency}ms`})}flush(){if(this.currentSampleCount>0){this.logger.info(`Flushing final chunk with ${this.currentSampleCount} samples`);const e=this.samplesPerChunk-this.currentSampleCount;e>0&&this.addSamples(new Float32Array(e)),this.processCurrentChunk()}this.reset()}reset(){this.currentChunk=[],this.overlapBuffer=[],this.currentSampleCount=0,this.chunkIndex=0,this.chunkStartTime=Date.now(),this.logger.debug("ChunkProcessor reset")}combineBuffers(e){const t=e.reduce((e,t)=>e+t.length,0),a=new Float32Array(t);let s=0;for(const t of e)a.set(t,s),s+=t.length;return a}getStatus(){return{currentSampleCount:this.currentSampleCount,samplesPerChunk:this.samplesPerChunk,chunkIndex:this.chunkIndex,bufferFillPercentage:this.currentSampleCount/this.samplesPerChunk*100}}}class u extends s{constructor(e={}){super(),this.activeStreams=new Map,this.errorHistory=[],this.config={logLevel:e.logLevel||"info",onLog:e.onLog||void 0,noiseReductionLevel:e.noiseReductionLevel||"medium",bufferSize:e.bufferSize||4096,algorithm:e.algorithm||"rnnoise",autoCleanup:e.autoCleanup??!0,cleanupDelay:e.cleanupDelay||3e4,useWorker:e.useWorker??!1,workerPath:e.workerPath||"/murmuraba.worker.js",allowDegraded:e.allowDegraded??!1},this.logger=new n("[Murmuraba]"),this.logger.setLevel(this.config.logLevel),this.config.onLog&&this.logger.setLogHandler(this.config.onLog),this.stateManager=new r,this.workerManager=new l(this.logger),this.metricsManager=new _,this.setupEventForwarding(),this.setupAutoCleanup()}setupEventForwarding(){this.stateManager.on("state-change",(e,t)=>{this.logger.info(`State transition: ${e} -> ${t}`),this.emit("state-change",e,t)}),this.metricsManager.on("metrics-update",e=>{this.emit("metrics-update",e)})}setupAutoCleanup(){if(!this.config.autoCleanup)return;this.on("processing-start",()=>{this.cleanupTimer&&(clearTimeout(this.cleanupTimer),this.cleanupTimer=void 0)}),this.on("processing-end",()=>{this.cleanupTimer&&clearTimeout(this.cleanupTimer),0===this.activeStreams.size&&this.stateManager.isInState("ready")&&(this.cleanupTimer=setTimeout(()=>{this.logger.info("Auto-cleanup triggered due to inactivity"),this.destroy()},this.config.cleanupDelay))})}async initialize(){if(this.initPromise)return this.initPromise;if(!this.stateManager.canTransitionTo("initializing"))throw new i(o.ALREADY_INITIALIZED,"Engine is already initialized or in an invalid state");return this.initPromise=this.performInitialization(),this.initPromise}async performInitialization(){this.stateManager.transitionTo("initializing");try{if(this.logger.info("Initializing Murmuraba engine..."),!this.checkEnvironmentSupport())throw new Error("Environment not supported: Missing required APIs");this.stateManager.transitionTo("creating-context"),await this.initializeAudioContext(),this.stateManager.transitionTo("loading-wasm"),await this.loadWasmModuleWithTimeout(5e3),this.metricsManager.startAutoUpdate(100),this.stateManager.transitionTo("ready"),this.emit("initialized"),this.logger.info("Murmuraba engine initialized successfully")}catch(e){this.stateManager.transitionTo("error"),this.recordError(e);const t=new i(o.INITIALIZATION_FAILED,`Initialization failed: ${e instanceof Error?e.message:String(e)}`,e);if(this.emit("error",t),!this.config.allowDegraded)throw t;this.logger.warn("Attempting degraded mode initialization..."),await this.initializeDegraded()}}checkEnvironmentSupport(){const e=!(!window.AudioContext&&!window.webkitAudioContext),t=!!window.WebAssembly;return e||this.logger.error("AudioContext API not supported"),t||this.logger.error("WebAssembly not supported"),e&&t}async initializeAudioContext(){try{const e=window.AudioContext||window.webkitAudioContext;this.audioContext=new e({sampleRate:48e3}),"suspended"===this.audioContext.state&&await this.audioContext.resume()}catch(e){throw new Error(`Failed to create AudioContext: ${e instanceof Error?e.message:String(e)}`)}}async loadWasmModuleWithTimeout(e){const t=new Promise((t,a)=>{setTimeout(()=>a(new Error(`WASM loading timeout after ${e}ms`)),e)});try{await Promise.race([this.loadWasmModule(),t])}catch(e){throw e instanceof Error&&e.message.includes("timeout")&&this.logger.error("WASM module loading timed out"),e}}recordError(e){const t=e instanceof Error?e.message:String(e);this.errorHistory.push({timestamp:Date.now(),error:t}),this.errorHistory.length>10&&this.errorHistory.shift()}async initializeDegraded(){if(this.logger.info("Initializing in degraded mode..."),this.stateManager.transitionTo("degraded"),!this.audioContext)try{await this.initializeAudioContext()}catch{return void this.logger.error("Failed to create audio context even in degraded mode")}this.emit("degraded-mode"),this.logger.warn("Engine running in degraded mode - noise reduction disabled")}async loadWasmModule(){this.logger.debug("Loading WASM module...");const e=document.createElement("script");e.src="/rnnoise-fixed.js",await new Promise((t,a)=>{e.onload=()=>t(),e.onerror=()=>a(new Error("Failed to load RNNoise script")),document.head.appendChild(e)});const t=window.createRNNWasmModule;if(!t)throw new Error("RNNoise WASM module creator not found");if(this.wasmModule=await t({locateFile:e=>e.endsWith(".wasm")?`/dist/${e}`:e}),this.rnnoiseState=this.wasmModule._rnnoise_create(0),!this.rnnoiseState)throw new Error("Failed to create RNNoise state");this.inputPtr=this.wasmModule._malloc(1920),this.outputPtr=this.wasmModule._malloc(1920),await this.warmupModel(),this.logger.debug("WASM module loaded successfully")}async warmupModel(){this.logger.debug("Warming up noise reduction model...");const e=new Float32Array(480);for(let t=0;t<10;t++)this.processFrame(e)}processFrame(e){if(!(this.wasmModule&&this.rnnoiseState&&this.inputPtr&&this.outputPtr))throw new Error("WASM module not initialized");this.wasmModule.HEAPF32.set(e,this.inputPtr>>2),this.wasmModule._rnnoise_process_frame(this.rnnoiseState,this.outputPtr,this.inputPtr);const t=new Float32Array(480);for(let e=0;e<480;e++)t[e]=this.wasmModule.HEAPF32[(this.outputPtr>>2)+e];return t}async processStream(e,t){this.stateManager.requireState("ready","processing");const a=this.generateStreamId();this.logger.info(`Processing stream ${a}`);try{const s=await this.createStreamController(e,a,t);return this.activeStreams.set(a,s),1===this.activeStreams.size&&(this.stateManager.transitionTo("processing"),this.emit("processing-start")),s}catch(e){const t=new i(o.PROCESSING_FAILED,`Failed to process stream: ${e instanceof Error?e.message:String(e)}`,e);throw this.emit("error",t),t}}async createStreamController(e,t,a){if(!this.audioContext)throw new Error("Audio context not initialized");const s=this.audioContext.createMediaStreamSource(e),r=this.audioContext.createMediaStreamDestination(),n=this.audioContext.createScriptProcessor(this.config.bufferSize,1,1),i=this.audioContext.createBiquadFilter();i.type="notch",i.frequency.value=1e3,i.Q.value=30;const o=this.audioContext.createBiquadFilter();o.type="notch",o.frequency.value=2e3,o.Q.value=30;const l=this.audioContext.createBiquadFilter();l.type="highpass",l.frequency.value=80,l.Q.value=.7;const _=this.audioContext.createBiquadFilter();_.type="lowshelf",_.frequency.value=200,_.gain.value=-3;let u=!1,f=!1;const h=[],m=[];let p;a&&(p=new c(this.audioContext.sampleRate,a,this.logger,this.metricsManager),p.on("chunk-processed",e=>{this.logger.debug("Chunk processed:",e),this.metricsManager.recordChunk(e)})),n.onaudioprocess=e=>{if(f||u)return void e.outputBuffer.getChannelData(0).fill(0);const t=e.inputBuffer.getChannelData(0),a=e.outputBuffer.getChannelData(0);this.metricsManager.calculateRMS(t);const s=this.metricsManager.calculatePeak(t);this.metricsManager.updateInputLevel(s);for(let e=0;e<t.length;e++)h.push(t[e]);!p||u||f||p.addSamples(t);let r=0,n=0,i=0;for(;h.length>=480;){const e=new Float32Array(h.splice(0,480)),t=this.metricsManager.calculateRMS(e),a=this.processFrame(e),s=this.metricsManager.calculateRMS(a),o=this.getReductionFactor();for(let e=0;e<a.length;e++)a[e]*=o,m.push(a[e]);r+=t,n+=s*o,i++,this.metricsManager.recordFrame()}for(let e=0;e<a.length;e++)m.length>0?a[e]=m.shift():a[e]=0;this.metricsManager.calculateRMS(a);const o=this.metricsManager.calculatePeak(a);if(this.metricsManager.updateOutputLevel(o),i>0){const e=r/i,t=n/i,a=e>0?Math.max(0,100*(1-t/e)):0;this.metricsManager.updateNoiseReduction(a)}},s.connect(l),l.connect(i),i.connect(o),o.connect(_),_.connect(n),n.connect(r);const d={stream:r.stream,processor:{id:t,state:"processing",inputNode:s,outputNode:r},stop:()=>{f=!0,p&&p.flush(),n.disconnect(),s.disconnect(),this.activeStreams.delete(t),this.logger.info(`Stream ${t} stopped`),0===this.activeStreams.size&&(this.stateManager.transitionTo("ready"),this.emit("processing-end"))},pause:()=>{u=!0,d.processor.state="paused",this.logger.debug(`Stream ${t} paused`)},resume:()=>{u=!1,d.processor.state="processing",this.logger.debug(`Stream ${t} resumed`)},getState:()=>d.processor.state};return d}getReductionFactor(){switch(this.config.noiseReductionLevel){case"low":return.9;case"medium":case"auto":default:return.7;case"high":return.5}}generateStreamId(){return`stream-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}async destroy(e=!1){if(!this.stateManager.canTransitionTo("destroying")){if(!e)throw new i(o.CLEANUP_FAILED,"Cannot destroy engine in current state");this.logger.warn("Force destroying engine")}this.stateManager.transitionTo("destroying"),this.logger.info("Destroying Murmuraba engine...");try{for(const[e,t]of this.activeStreams)t.stop();this.activeStreams.clear(),this.metricsManager.stopAutoUpdate(),this.workerManager.terminateAll(),this.wasmModule&&(this.inputPtr&&this.wasmModule._free(this.inputPtr),this.outputPtr&&this.wasmModule._free(this.outputPtr),this.rnnoiseState&&this.wasmModule._rnnoise_destroy(this.rnnoiseState)),this.audioContext&&"closed"!==this.audioContext.state&&await this.audioContext.close(),this.cleanupTimer&&clearTimeout(this.cleanupTimer),this.removeAllListeners(),this.stateManager.transitionTo("destroyed"),this.emit("destroyed"),this.logger.info("Murmuraba engine destroyed successfully")}catch(e){this.stateManager.transitionTo("error");const t=new i(o.CLEANUP_FAILED,`Cleanup failed: ${e instanceof Error?e.message:String(e)}`,e);throw this.emit("error",t),t}}getMetrics(){return this.metricsManager.getMetrics()}onMetricsUpdate(e){this.on("metrics-update",e)}getDiagnostics(){const e=window.React?.version||"unknown",t={hasWASM:!!window.WebAssembly,hasAudioContext:!(!window.AudioContext&&!window.webkitAudioContext),hasWorklet:!!window.AudioWorkletNode,maxChannels:this.audioContext?.destination.maxChannelCount||0};return{version:"1.3.0",engineVersion:"2.0.0",reactVersion:e,browserInfo:{name:this.getBrowserName(),version:this.getBrowserVersion(),audioAPIsSupported:this.getAudioAPIsSupported()},wasmLoaded:!!this.wasmModule,activeProcessors:this.activeStreams.size,memoryUsage:performance.memory?.usedJSHeapSize||0,processingTime:this.metricsManager.getMetrics().processingLatency,engineState:this.stateManager.getState(),capabilities:t,errors:this.errorHistory,initializationLog:[],performanceMetrics:{wasmLoadTime:0,contextCreationTime:0,totalInitTime:0}}}getBrowserName(){const e=navigator.userAgent;return e.includes("Chrome")?"Chrome":e.includes("Firefox")?"Firefox":e.includes("Safari")?"Safari":e.includes("Edge")?"Edge":"Unknown"}getBrowserVersion(){const e=navigator.userAgent.match(/(Chrome|Firefox|Safari|Edge)\/([\d.]+)/);return e?e[2]:"unknown"}getAudioAPIsSupported(){const e=[];return(window.AudioContext||window.webkitAudioContext)&&e.push("AudioContext"),window.AudioWorkletNode&&e.push("AudioWorklet"),window.webkitAudioContext&&e.push("webkitAudioContext"),window.MediaStream&&e.push("MediaStream"),window.MediaRecorder&&e.push("MediaRecorder"),e}async runDiagnosticTests(){const e={timestamp:Date.now(),tests:[],passed:0,failed:0,warnings:0},t={name:"Environment Support",passed:!1,message:"",duration:0},a=Date.now();this.checkEnvironmentSupport()?(t.passed=!0,t.message="All required APIs are supported"):t.message="Missing required APIs",t.duration=Date.now()-a,e.tests.push(t);const s={name:"Audio Context Creation",passed:!1,message:"",duration:0},r=Date.now();try{this.audioContext||await this.initializeAudioContext(),s.passed=!0,s.message=`Audio context created (state: ${this.audioContext?.state})`}catch(e){s.message=`Failed: ${e instanceof Error?e.message:String(e)}`}s.duration=Date.now()-r,e.tests.push(s);const n={name:"WASM Module Loading",passed:!1,message:"",duration:0},i=Date.now();this.wasmModule?(n.passed=!0,n.message="WASM module already loaded"):n.message="WASM module not loaded (run initialize first)",n.duration=Date.now()-i,e.tests.push(n);const o={name:"Frame Processing",passed:!1,message:"",duration:0},l=Date.now();try{if(this.wasmModule&&this.rnnoiseState){const e=new Float32Array(480),t=this.processFrame(e);o.passed=480===t.length,o.message=o.passed?"Frame processing successful":"Invalid output size"}else o.message="Engine not initialized"}catch(e){o.message=`Failed: ${e instanceof Error?e.message:String(e)}`}return o.duration=Date.now()-l,e.tests.push(o),e.passed=e.tests.filter(e=>e.passed).length,e.failed=e.tests.filter(e=>!e.passed).length,e}}let f=null;async function h(e){if(f)throw new Error("Audio engine is already initialized. Call destroyEngine() first.");f=new u(e),await f.initialize()}function m(){if(!f)throw new Error("Audio engine not initialized. Call initializeAudioEngine() first.");return f}async function p(e){return m().processStream(e)}async function d(e,t){return m().processStream(e,t)}async function b(e){f&&(await f.destroy(e?.force||!1),f=null)}function g(){return f?f.getDiagnostics().engineState:"uninitialized"}function v(){return m().getDiagnostics()}function S(e){m().onMetricsUpdate(e)}class w{constructor(){this.audioContext=new(window.AudioContext||window.webkitAudioContext)}async convertToWav(e){try{const t=await e.arrayBuffer(),a=await this.audioContext.decodeAudioData(t.slice(0)),s=this.audioBufferToWav(a);return console.log("Successfully converted to WAV, size:",s.size),s}catch(e){throw console.error("Failed to convert audio:",e),e}}static async webmToWav(e){return(new w).convertToWav(e)}static async webmToMp3(e,t=128){const a=new w;try{const s=await Promise.resolve().then(function(){return ls}),r=await e.arrayBuffer(),n=await a.audioContext.decodeAudioData(r),i=(n.numberOfChannels,n.sampleRate),o=n.length,l=new Int16Array(o),_=n.getChannelData(0);for(let e=0;e<o;e++){const t=Math.max(-1,Math.min(1,_[e]));l[e]=t<0?32768*t:32767*t}const c=new s.Mp3Encoder(1,i,t),u=[],f=1152;for(let e=0;e<o;e+=f){const t=l.subarray(e,Math.min(e+f,o)),a=c.encodeBuffer(t);a.length>0&&u.push(a)}const h=c.flush();h.length>0&&u.push(h);let m=0;u.forEach(e=>m+=e.length);const p=new Int8Array(m);let d=0;return u.forEach(e=>{p.set(e,d),d+=e.length}),console.log("Successfully converted to MP3, size:",p.length),new Blob([p],{type:"audio/mp3"})}catch(e){throw console.error("Failed to convert to MP3:",e),e}}audioBufferToWav(e){const t=e.numberOfChannels,a=e.length*t*2,s=new ArrayBuffer(44+a),r=new DataView(s),n=(e,t)=>{for(let a=0;a<t.length;a++)r.setUint8(e+a,t.charCodeAt(a))};n(0,"RIFF"),r.setUint32(4,36+a,!0),n(8,"WAVE"),n(12,"fmt "),r.setUint32(16,16,!0),r.setUint16(20,1,!0),r.setUint16(22,t,!0),r.setUint32(24,e.sampleRate,!0),r.setUint32(28,e.sampleRate*t*2,!0),r.setUint16(32,2*t,!0),r.setUint16(34,16,!0),n(36,"data"),r.setUint32(40,a,!0);let i=44;for(let a=0;a<e.length;a++)for(let s=0;s<t;s++){const t=e.getChannelData(s)[a],n=Math.max(-32768,Math.min(32767,32768*t));r.setInt16(i,n,!0),i+=2}return new Blob([s],{type:"audio/wav"})}static canPlayType(e){return"probably"===(new Audio).canPlayType(e)}static getBestRecordingFormat(){return MediaRecorder.isTypeSupported("audio/webm")?(console.log("Using audio/webm for recording"),"audio/webm"):MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?(console.log("Using audio/webm;codecs=opus for recording"),"audio/webm;codecs=opus"):MediaRecorder.isTypeSupported("audio/mp4")?(console.log("Using audio/mp4 - WARNING: Blob playback may fail!"),"audio/mp4"):(console.error("NO AUDIO FORMAT SUPPORTED - THIS BROWSER IS GARBAGE"),"audio/webm")}async convertBlobUrl(e){try{const t=await fetch(e),a=await t.blob();if("audio/wav"===a.type)return console.log("Audio is already WAV format"),e;if(a.type.includes("webm")||a.type.includes("mp4"))return console.log("Using native browser playback for",a.type),e;console.log("Converting audio from",a.type,"to WAV, blob size:",a.size);const s=await this.convertToWav(a),r=URL.createObjectURL(s);return console.log("Audio converted successfully to WAV, new size:",s.size),r}catch(t){return console.error("Error converting blob URL:",t),console.error("Falling back to original URL"),e}}}let M=null;function A(){return M||(M=new w),M}function R(e={}){const{autoInitialize:a=!1,defaultChunkDuration:s=8,fallbackToManual:r=!1,onInitError:n,react19Mode:i=!1,...o}=e,l=t.version.startsWith("19")||i,[_,c]=t.useState(!1),[u,f]=t.useState(!1),[M,R]=t.useState(null),[E,y]=t.useState("uninitialized"),[k,T]=t.useState(null),[B,x]=t.useState(null),[P,I]=t.useState({isRecording:!1,isPaused:!1,recordingTime:0,chunks:[]}),[L,C]=t.useState(null),[N,O]=t.useState(null),[D,H]=t.useState(null),F=t.useRef(null),V=t.useRef(null),z=t.useRef(null),X=t.useRef(null),Y=t.useRef({}),q=t.useRef(null),U=t.useRef(new Map),j=t.useRef(null),G=t.useRef("audio/webm"),W=t.useRef(null),K=t.useRef(!1),Z=t.useCallback(()=>{if(!_)return x(null),null;try{const e=v();return x(e),y(e.engineState),e}catch{return null}},[_]),$=t.useCallback(async()=>(console.log("🚀 [LIFECYCLE] Initializing MurmubaraEngine..."),V.current?(console.log("⏳ [LIFECYCLE] Already initializing, returning existing promise"),V.current):_?void console.log("✅ [LIFECYCLE] Already initialized, skipping"):(f(!0),R(null),V.current=(async()=>{try{console.log("🔧 [LIFECYCLE] Calling initializeAudioEngine with config:",o),await h(o),S(e=>{T(e)}),W.current=A(),c(!0),y("ready"),Z(),console.log("🎉 [LIFECYCLE] Engine initialized successfully!");const e=m();if(e){const t=()=>{console.log("💥 [LIFECYCLE] Engine destroyed by auto-cleanup!"),c(!1),y("destroyed"),T(null),x(null)},a=(e,t)=>{console.log(`🔄 [LIFECYCLE] Engine state changed: ${e} → ${t}`),y(t),"destroyed"===t&&c(!1)};e.on("destroyed",t),e.on("state-change",a),F.current=()=>{e.off("destroyed",t),e.off("state-change",a)}}}catch(e){const t=e instanceof Error?e:new Error(String(e)),a=t.message;if(R(a),y("error"),n&&n(t),!r||!l)throw e;console.warn("[MurmubaraEngine] Auto-init failed in React 19, attempting manual fallback")}finally{f(!1),V.current=null}})(),V.current)),[o,_,l,r,n,Z]),Q=t.useCallback(async(e=!1)=>{if(console.log("🔥 [LIFECYCLE] Destroying engine...",{force:e}),_)try{P.isRecording&&(console.log("🛑 [LIFECYCLE] Stopping ongoing recording before destroy"),te()),F.current&&(F.current(),F.current=null),await b({force:e}),c(!1),y("destroyed"),T(null),x(null),console.log("💀 [LIFECYCLE] Engine destroyed successfully")}catch(e){const t=e instanceof Error?e.message:String(e);throw R(t),e}else console.log("⚠️ [LIFECYCLE] Engine not initialized, skipping destroy")},[_,P.isRecording]),J=t.useCallback(()=>w.getBestRecordingFormat(),[]),ee=t.useCallback(async(e=s)=>{try{_||await $();const t=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!1,autoGainControl:!0}});O(t),C(t),U.current.clear();const a=await d(t,{chunkDuration:1e3*e,onChunkProcessed:e=>{console.log("📦 [ENGINE] Engine chunk ignored, using recording cycles instead")}});H(a);const s=J();G.current=s,console.log("🎤 [LIFECYCLE] Using MIME type for recording:",s);const r=a.stream;let n=0,i=null,o=null;K.current=!1;const l=()=>{if(K.current)return;n++;const e=Date.now();console.log(`🔄 [FAKE-STREAM] Starting recording cycle #${n}`);const a=`chunk-${e}-${Math.random().toString(36).substr(2,9)}`;U.current.set(a,{processed:[],original:[],finalized:!1}),i=new MediaRecorder(r,{mimeType:s}),o=new MediaRecorder(t,{mimeType:s}),console.log("🔍 [FAKE-STREAM] Stream states:",{processedStreamActive:r.active,processedStreamTracks:r.getTracks().map(e=>({kind:e.kind,enabled:e.enabled,readyState:e.readyState})),originalStreamActive:t.active,originalStreamTracks:t.getTracks().map(e=>({kind:e.kind,enabled:e.enabled,readyState:e.readyState}))}),i.ondataavailable=e=>{if(e.data.size>0){const t=U.current.get(a);t&&!t.finalized&&(t.processed.push(e.data),console.log(`💾 [FAKE-STREAM] Cycle #${n} - Processed data: ${e.data.size} bytes, type: ${e.data.type}`))}else console.error(`❌ [FAKE-STREAM] Cycle #${n} - Empty data received!`)},o.ondataavailable=e=>{if(e.data.size>0){const t=U.current.get(a);t&&!t.finalized&&(t.original.push(e.data),console.log(`💾 [FAKE-STREAM] Cycle #${n} - Original data: ${e.data.size} bytes`))}else console.error(`❌ [FAKE-STREAM] Cycle #${n} - Empty original data received!`)},i.onerror=e=>{console.error("❌ [FAKE-STREAM] Processed recorder error:",e)},o.onerror=e=>{console.error("❌ [FAKE-STREAM] Original recorder error:",e)},i.onstop=()=>{const t=U.current.get(a);if(t&&t.processed.length>0){console.log(`🔍 [FAKE-STREAM] Creating blobs for cycle #${n}:`),console.log(`  - Processed chunks: ${t.processed.length}, total size: ${t.processed.reduce((e,t)=>e+t.size,0)} bytes`),console.log(`  - Original chunks: ${t.original.length}, total size: ${t.original.reduce((e,t)=>e+t.size,0)} bytes`);const r=new Blob(t.processed,{type:s}),i=new Blob(t.original,{type:s});console.log("📦 [FAKE-STREAM] Created blobs:"),console.log(`  - Processed: ${r.size} bytes, type: ${r.type}`),console.log(`  - Original: ${i.size} bytes, type: ${i.type}`);const o=1e3;let l=!0,_="";(r.size<o||i.size<o)&&(l=!1,_=`Audio too small (${Math.min(r.size,i.size)} bytes). Recording may be corrupted.`,console.error("❌ [FAKE-STREAM] Invalid blob size detected!"));const c=l?URL.createObjectURL(r):void 0,u=l?URL.createObjectURL(i):void 0,f=Date.now(),h=f-e,m={id:a,startTime:e,endTime:f,duration:h,processedAudioUrl:c,originalAudioUrl:u,isPlaying:!1,isExpanded:!1,isValid:l,errorMessage:_,noiseRemoved:i.size>0?(i.size-r.size)/i.size*100:0,originalSize:i.size,processedSize:r.size,metrics:{processingLatency:Date.now()-e-h,frameCount:Math.floor(h/10),inputLevel:1,outputLevel:r.size/i.size,noiseReductionLevel:Math.max(0,Math.min(1,(i.size-r.size)/i.size)),timestamp:Date.now(),droppedFrames:0}};I(e=>({...e,chunks:[...e.chunks,m]})),t.finalized=!0,console.log(`✅ [FAKE-STREAM] Cycle #${n} complete: ${(h/1e3).toFixed(1)}s chunk`)}},i.start(),o.start(),z.current=i,X.current=o},c=()=>{K.current||(console.log(`⏹️ [FAKE-STREAM] Stopping cycle #${n}`),i&&"recording"===i.state&&i.requestData(),o&&"recording"===o.state&&o.requestData(),setTimeout(()=>{i&&"inactive"!==i.state&&i.stop(),o&&"inactive"!==o.state&&o.stop(),setTimeout(()=>{K.current||l()},200)},100))};l(),j.current=setInterval(()=>{c()},1e3*e),I(e=>({...e,isRecording:!0,recordingTime:0}))}catch(e){console.error("Error starting recording:",e),R(e instanceof Error?e.message:"Failed to start recording")}},[_,$,J,s]),te=t.useCallback(()=>{K.current=!0,j.current&&(clearInterval(j.current),j.current=null),z.current&&"inactive"!==z.current.state&&z.current.stop(),X.current&&"inactive"!==X.current.state&&X.current.stop(),D&&D.stop(),L&&L.getTracks().forEach(e=>e.stop()),N&&N.getTracks().forEach(e=>e.stop()),q.current&&(clearInterval(q.current),q.current=null),I(e=>({...e,isRecording:!1,isPaused:!1})),H(null),C(null),O(null),j.current&&(clearInterval(j.current),j.current=null),q.current&&(clearInterval(q.current),q.current=null),I(e=>({...e,isRecording:!1,isPaused:!1})),H(null),C(null),O(null)},[D,L,N]),ae=t.useCallback(()=>{D&&!P.isPaused&&(D.pause(),"recording"===z.current?.state&&z.current.pause(),"recording"===X.current?.state&&X.current.pause(),I(e=>({...e,isPaused:!0})))},[D,P.isPaused]),se=t.useCallback(()=>{D&&P.isPaused&&(D.resume(),"paused"===z.current?.state&&z.current.resume(),"paused"===X.current?.state&&X.current.resume(),I(e=>({...e,isPaused:!1})))},[D,P.isPaused]),re=t.useCallback(()=>{P.chunks.forEach(e=>{e.processedAudioUrl&&URL.revokeObjectURL(e.processedAudioUrl),e.originalAudioUrl&&URL.revokeObjectURL(e.originalAudioUrl)}),Object.values(Y.current).forEach(e=>{e.pause(),e.src=""}),Y.current={},I(e=>({...e,chunks:[]}))},[P.chunks]),ne=t.useCallback(async(e,t)=>{console.log("♒Searching for this chunk:",e);const a=P.chunks.find(t=>t.id===e);if(!a)return void console.error("Chunk not found:",e);const s="processed"===t?a.processedAudioUrl:a.originalAudioUrl;if(!s)return void console.error(`No ${t} audio URL for chunk:`,e);const r=`${e}-${t}`,n=s,i=G.current;console.log("🎵 Playing audio natively, format:",i),Y.current[r]||(Y.current[r]=new Audio,Y.current[r].onerror=e=>{console.error("Audio playback error:",e),console.error("Audio URL:",s),console.error("Audio type:",t)},Y.current[r].onended=()=>{I(t=>({...t,chunks:t.chunks.map(t=>t.id===e?{...t,isPlaying:!1}:t)}))},Y.current[r].src=n);const o=Y.current[r];if(a.isPlaying)o.pause(),o.currentTime=0,I(t=>({...t,chunks:t.chunks.map(t=>t.id===e?{...t,isPlaying:!1}:t)}));else{Object.values(Y.current).forEach(e=>{e.pause(),e.currentTime=0}),I(e=>({...e,chunks:e.chunks.map(e=>({...e,isPlaying:!1}))}));try{await o.play(),I(t=>({...t,chunks:t.chunks.map(t=>t.id===e?{...t,isPlaying:!0}:t)}))}catch(e){console.error("Failed to play audio:",e),"NotSupportedError"===e.name&&console.error("Audio format not supported. MIME type:",i)}}},[P.chunks]),ie=t.useCallback(e=>{I(t=>({...t,chunks:t.chunks.map(t=>t.id===e?{...t,isExpanded:!t.isExpanded}:{...t,isExpanded:!1})}))},[]),oe=t.useCallback(e=>{const t=e%60;return`${Math.floor(e/60).toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`},[]),le=t.useCallback(()=>0===P.chunks.length?0:P.chunks.reduce((e,t)=>e+t.noiseRemoved,0)/P.chunks.length,[P.chunks]),_e=t.useCallback(async(e,t)=>{const a=P.chunks.find(t=>t.id===e);if(!a)throw new Error(`Chunk not found: ${e}`);const s="processed"===t?a.processedAudioUrl:a.originalAudioUrl;if(!s)throw new Error(`No ${t} audio URL for chunk: ${e}`);const r=await fetch(s),n=await r.blob();return w.webmToWav(n)},[P.chunks]),ce=t.useCallback(async(e,t,a=128)=>{const s=P.chunks.find(t=>t.id===e);if(!s)throw new Error(`Chunk not found: ${e}`);const r="processed"===t?s.processedAudioUrl:s.originalAudioUrl;if(!r)throw new Error(`No ${t} audio URL for chunk: ${e}`);const n=await fetch(r),i=await n.blob();return w.webmToMp3(i,a)},[P.chunks]),ue=t.useCallback(async(e,t,a)=>{const s=P.chunks.find(t=>t.id===e);if(!s)throw new Error(`Chunk not found: ${e}`);let r,n;const i=new Date(s.startTime).toISOString().replace(/:/g,"-").split(".")[0],o="processed"===a?"enhanced":"original";if("webm"===t){const t="processed"===a?s.processedAudioUrl:s.originalAudioUrl;if(!t)throw new Error(`No ${a} audio URL for chunk: ${e}`);const l=await fetch(t);r=await l.blob(),n=`${o}_${i}.webm`}else if("wav"===t)r=await _e(e,a),n=`${o}_${i}.wav`;else{if("mp3"!==t)throw new Error(`Unsupported format: ${t}`);r=await ce(e,a),n=`${o}_${i}.mp3`}const l=URL.createObjectURL(r),_=document.createElement("a");_.href=l,_.download=n,document.body.appendChild(_),_.click(),document.body.removeChild(_),URL.revokeObjectURL(l)},[P.chunks,_e,ce]),fe=t.useCallback(async e=>{if(!_)throw new Error("Engine not initialized");try{const t=await p(e);return Z(),t}catch(e){const t=e instanceof Error?e.message:String(e);throw R(t),e}},[_,Z]),he=t.useCallback(async(e,t)=>{if(!_)throw new Error("Engine not initialized");try{const a=await d(e,t);return Z(),a}catch(e){const t=e instanceof Error?e.message:String(e);throw R(t),e}},[_,Z]),me=t.useCallback(()=>{R(null)},[]);return t.useEffect(()=>{!a||_||u||(console.log("🤖 [LIFECYCLE] Auto-initializing engine..."),$())},[a,_,u,$]),t.useEffect(()=>{if(P.isRecording&&!P.isPaused){const e=Date.now()-1e3*P.recordingTime;q.current=setInterval(()=>{I(t=>({...t,recordingTime:Math.floor((Date.now()-e)/1e3)}))},100)}return()=>{q.current&&(clearInterval(q.current),q.current=null)}},[P.isRecording,P.isPaused,P.recordingTime]),t.useEffect(()=>{if(!_)return;const e=setInterval(()=>{try{const e=g();y(e)}catch{}},1e3);return()=>clearInterval(e)},[_]),t.useEffect(()=>{console.log("🌟 [LIFECYCLE] Component mounted, setting up cleanup handler");let e=!1;return()=>{e||(e=!0,console.log("👋 [LIFECYCLE] Component unmounting, cleaning up..."))}},[]),{isInitialized:_,isLoading:u,error:M,engineState:E,metrics:k,diagnostics:B,recordingState:P,currentStream:L,streamController:D,initialize:$,destroy:Q,processStream:fe,processStreamChunked:he,startRecording:ee,stopRecording:te,pauseRecording:ae,resumeRecording:se,clearRecordings:re,toggleChunkPlayback:ne,toggleChunkExpansion:ie,exportChunkAsWav:_e,exportChunkAsMp3:ce,downloadChunk:ue,getDiagnostics:Z,resetError:me,formatTime:oe,getAverageNoiseReduction:le}}class E{constructor(){this.name="RNNoise",this.description="Neural network-based noise suppression",this.isInitialized=!1,this.module=null,this.state=null,this.inputPtr=0,this.outputPtr=0}async initialize(){if(this.isInitialized)return;console.log("[RNNoiseEngine] Starting initialization...");const e=document.createElement("script");e.src="/rnnoise-fixed.js",await new Promise((t,a)=>{e.onload=t,e.onerror=a,document.head.appendChild(e)});const t=window.createRNNWasmModule;if(this.module=await t({locateFile:e=>e.endsWith(".wasm")?`/dist/${e}`:e}),this.state=this.module._rnnoise_create(0),!this.state)throw new Error("Failed to create RNNoise state");this.inputPtr=this.module._malloc(1920),this.outputPtr=this.module._malloc(1920);const a=new Float32Array(480);for(let e=0;e<10;e++)this.module.HEAPF32.set(a,this.inputPtr>>2),this.module._rnnoise_process_frame(this.state,this.outputPtr,this.inputPtr);this.isInitialized=!0,console.log("[RNNoiseEngine] Initialization complete!")}process(e){if(!this.isInitialized)throw new Error("RNNoiseEngine not initialized");if(480!==e.length)throw new Error("RNNoise requires exactly 480 samples per frame");this.module.HEAPF32.set(e,this.inputPtr>>2),this.module._rnnoise_process_frame(this.state,this.outputPtr,this.inputPtr);const t=new Float32Array(480);for(let e=0;e<480;e++)t[e]=this.module.HEAPF32[(this.outputPtr>>2)+e];return t}cleanup(){this.module&&this.state&&(this.module._free(this.inputPtr),this.module._free(this.outputPtr),this.module._rnnoise_destroy(this.state),this.state=null,this.module=null,this.isInitialized=!1)}}const y=(e={engineType:"rnnoise"})=>{console.warn("[Murmuraba] useAudioEngine is deprecated. Please use useMurmubaraEngine instead for better React 19 compatibility.");const[a,s]=t.useState(!1),[r,n]=t.useState(!1),[i,o]=t.useState(null),l=t.useRef(null),_=t.useRef(null),c=t.useRef(null),u=t.useRef(null),f=t.useRef({inputSamples:0,outputSamples:0,silenceFrames:0,activeFrames:0,totalInputEnergy:0,totalOutputEnergy:0,peakInput:0,peakOutput:0,startTime:0,totalFrames:0}),h=async()=>{if(!a&&!r){n(!0),o(null);try{console.log("[AudioEngine] Creating audio engine with config:",e);const t=function(e){switch(e.engineType){case"rnnoise":return new E;case"speex":throw new Error("Speex engine not implemented yet");case"custom":throw new Error("Custom engine not implemented yet");default:throw new Error(`Unknown engine type: ${e.engineType}`)}}(e);await t.initialize(),c.current=t,u.current={inputBuffer:[],outputBuffer:[],energyHistory:new Array(20).fill(0),energyIndex:0},console.log("[AudioEngine] Engine ready for processing"),l.current=new AudioContext({sampleRate:48e3});const a=l.current.createScriptProcessor(4096,1,1);a.onaudioprocess=e=>{const t=e.inputBuffer.getChannelData(0),a=e.outputBuffer.getChannelData(0);if(c.current&&u.current){f.current.inputSamples+=t.length;for(let e=0;e<t.length;e++)u.current.inputBuffer.push(t[e]),f.current.peakInput=Math.max(f.current.peakInput,Math.abs(t[e]));for(;u.current.inputBuffer.length>=480;){const e=u.current.inputBuffer.splice(0,480),t=new Float32Array(e),a=c.current.process(t),s=k(t),r=k(a);f.current.totalFrames++,f.current.totalInputEnergy+=s,f.current.totalOutputEnergy+=r,u.current.energyHistory[u.current.energyIndex]=s,u.current.energyIndex=(u.current.energyIndex+1)%20;const n=u.current.energyHistory.reduce((e,t)=>e+t)/20;let i=a;const o=.001,l=.005;let _=!1;if(n<o)i=i.map(e=>.1*e),_=!0,f.current.silenceFrames++;else if(n<l){const e=.1+.9*((n-o)/(l-o));i=i.map(t=>t*e),f.current.activeFrames++}else f.current.activeFrames++;const h=r/(s+1e-4);if(h<.3&&n<l&&(i=i.map(e=>e*h),_||f.current.silenceFrames++),Math.random()<.02){const e=n<o?"SILENCE":n<l?"TRANSITION":"SPEECH";console.log("[AudioEngine]","\n  Status:",e,"\n  Avg Energy:",n.toFixed(6),"\n  Frame Energy:",s.toFixed(6),"\n  Engine Reduction:",(100*(1-h)).toFixed(1)+"%","\n  Gate Applied:",n<l?"Yes":"No")}for(let e=0;e<480;e++)u.current.outputBuffer.push(i[e])}for(let e=0;e<a.length;e++)if(u.current.outputBuffer.length>0){const t=u.current.outputBuffer.shift();a[e]=t,f.current.outputSamples++,f.current.peakOutput=Math.max(f.current.peakOutput,Math.abs(t))}else a[e]=0}else a.set(t)},_.current=a,s(!0),console.log("[AudioEngine] Initialization complete!")}catch(e){throw console.error("[AudioEngine] Error:",e),o(e instanceof Error?e.message:String(e)),e}finally{n(!1)}}},m=()=>{f.current={inputSamples:0,outputSamples:0,silenceFrames:0,activeFrames:0,totalInputEnergy:0,totalOutputEnergy:0,peakInput:0,peakOutput:0,startTime:Date.now(),totalFrames:0}};return{isInitialized:a,isLoading:r,error:i,processStream:async e=>{if(a||await h(),!l.current||!_.current)throw new Error("Not initialized");m();const t=l.current.createMediaStreamSource(e),s=l.current.createMediaStreamDestination();return t.connect(_.current),_.current.connect(s),s.stream},cleanup:()=>{_.current&&_.current.disconnect(),c.current&&(c.current.cleanup(),c.current=null),l.current&&"closed"!==l.current.state&&l.current.close()},initializeAudioEngine:h,getMetrics:()=>{const e=f.current,t=Date.now()-e.startTime,a=e.totalFrames>0?e.totalInputEnergy/e.totalFrames:0,s=e.totalFrames>0?e.totalOutputEnergy/e.totalFrames:0,r=100*(.5*(a>0?Math.abs(a-s)/a:0)+.5*(e.totalFrames>0?e.silenceFrames/e.totalFrames:0));return{inputSamples:e.inputSamples,outputSamples:e.outputSamples,noiseReductionLevel:Math.max(0,Math.min(100,r)),silenceFrames:e.silenceFrames,activeFrames:e.activeFrames,averageInputEnergy:a,averageOutputEnergy:s,peakInputLevel:e.peakInput,peakOutputLevel:e.peakOutput,processingTimeMs:t,chunkOffset:0,totalFramesProcessed:e.totalFrames}},resetMetrics:m}};function k(e){let t=0;for(let a=0;a<e.length;a++)t+=e[a]*e[a];return Math.sqrt(t/e.length)}const T="1.3.0",B=T;var x={useMurmubaraEngine:R,useAudioEngine:y,MurmubaraEngine:u},P={};function I(e){return new Int32Array(e)}function L(e){return new Float32Array(e)}var C={fill:function(e,t,a,s){if(2==arguments.length)for(var r=0;r<e.length;r++)e[r]=arguments[1];else for(r=t;r<a;r++)e[r]=s}},N={arraycopy:function(e,t,a,s,r){for(var n=t+r;t<n;)a[s++]=e[t++]},out:{}};N.out.println=function(e){console.log(e)},N.out.printf=function(){console.log.apply(console,arguments)};var O={};function D(e){this.ordinal=e}O.SQRT2=1.4142135623730951,O.FAST_LOG10=function(e){return Math.log10(e)},O.FAST_LOG10_X=function(e,t){return Math.log10(e)*t},D.short_block_allowed=new D(0),D.short_block_coupled=new D(1),D.short_block_dispensed=new D(2),D.short_block_forced=new D(3);var H={};function F(e){this.ordinal=e}H.MAX_VALUE=34028235e31,F.vbr_off=new F(0),F.vbr_mt=new F(1),F.vbr_rh=new F(2),F.vbr_abr=new F(3),F.vbr_mtrh=new F(4),F.vbr_default=F.vbr_mtrh;var V,z,X,Y,q,U,j,G,W={System:N,VbrMode:F,Float:H,ShortBlock:D,Util:O,Arrays:C,new_array_n:function e(t){if(1==t.length)return new Array(t[0]);var a=t[0];t=t.slice(1);for(var s=[],r=0;r<a;r++)s.push(e(t));return s},new_byte:function(e){return new Int8Array(e)},new_double:function(e){return new Float64Array(e)},new_float:L,new_float_n:function e(t){if(1==t.length)return L(t[0]);var a=t[0];t=t.slice(1);for(var s=[],r=0;r<a;r++)s.push(e(t));return s},new_int:I,new_int_n:function e(t){if(1==t.length)return I(t[0]);var a=t[0];t=t.slice(1);for(var s=[],r=0;r<a;r++)s.push(e(t));return s},new_short_n:function e(t){if(1==t.length)return a=t[0],new Int16Array(a);var a,s=t[0];t=t.slice(1);for(var r=[],n=0;n<s;n++)r.push(e(t));return r},assert:function(e){}};function K(){if(Y)return X;Y=1;var e=Z(),t=W.System,a=W.new_float,s=W.new_float_n;return X=function(){this.l=a(e.SBMAX_l),this.s=s([e.SBMAX_s,3]);var r=this;this.assign=function(a){t.arraycopy(a.l,0,r.l,0,e.SBMAX_l);for(var s=0;s<e.SBMAX_s;s++)for(var n=0;n<3;n++)r.s[s][n]=a.s[s][n]}}}function Z(){if(G)return j;G=1;var e=W.System,t=W.VbrMode,a=W.new_array_n,s=W.new_float,r=W.new_float_n,n=W.new_int,i=W.assert;function o(){var l=function(){if(z)return V;z=1;var e=W.System,t=W.Util,a=W.Arrays,s=W.new_float,r=Z();return V=function(){var n=[-.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,.9063471690191471,.1960342806591213,-.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,.8206787908286602,.3901806440322567,-.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,.7416505462720353,.5805693545089249,-.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,.6681786379192989,.7653668647301797,-.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,.5993769336819237,.9427934736519954,-.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,.5345111359507916,1.111140466039205,-.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,.4729647758913199,1.268786568327291,-.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,.41421356237309503,1.414213562373095,-.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,.3578057213145241,1.546020906725474,-.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,.3033466836073424,1.66293922460509,-.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,.2504869601913055,1.76384252869671,-.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,.198912367379658,1.847759065022573,-.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,.1483359875383474,1.913880671464418,-.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,.09849140335716425,1.961570560806461,-.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,.04912684976946725,1.990369453344394,.035780907*t.SQRT2*.5/2384e-9,.017876148*t.SQRT2*.5/2384e-9,.003134727*t.SQRT2*.5/2384e-9,.002457142*t.SQRT2*.5/2384e-9,971317e-9*t.SQRT2*.5/2384e-9,218868e-9*t.SQRT2*.5/2384e-9,101566e-9*t.SQRT2*.5/2384e-9,13828e-9*t.SQRT2*.5/2384e-9,12804.797818791945,1945.5515939597317,313.4244966442953,20.801593959731544,1995.1556208053692,9.000838926174497,-29.20218120805369],i=[[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,940084909404969e-27,6423305872147839e-28,2382191739347918e-28,5456116108943412e-27,4878985199565852e-27,4240448995017367e-27,3559909094758252e-27,2858043359288075e-27,2156177623817898e-27,1475637723558783e-27,8371015190102974e-28,2599706096327376e-28,-5456116108943412e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758252e-27,-2858043359288076e-27,-2156177623817898e-27,-1475637723558783e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347923e-28,-6423305872147843e-28,-9400849094049696e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049694e-28,-642330587214784e-27,-2382191739347918e-28],[2382191739347913e-28,6423305872147834e-28,9400849094049688e-28,1122435026096556e-27,1183840321267481e-27,1122435026096556e-27,9400849094049688e-28,6423305872147841e-28,2382191739347918e-28,5456116108943413e-27,4878985199565852e-27,4240448995017367e-27,3559909094758253e-27,2858043359288075e-27,2156177623817898e-27,1475637723558782e-27,8371015190102975e-28,2599706096327376e-28,-5461314069809755e-27,-4921085770524055e-27,-4343405037091838e-27,-3732668368707687e-27,-3093523840190885e-27,-2430835727329465e-27,-1734679010007751e-27,-974825365660928e-27,-2797435120168326e-28,0,0,0,0,0,0,-2283748241799531e-28,-4037858874020686e-28,-2146547464825323e-28],[.1316524975873958,.414213562373095,.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,.984807753012208,.6427876096865394,.3420201433256688,.9396926207859084,-.1736481776669303,-.7660444431189779,.8660254037844387,.5,-.5144957554275265,-.4717319685649723,-.3133774542039019,-.1819131996109812,-.09457419252642064,-.04096558288530405,-.01419856857247115,-.003699974673760037,.8574929257125442,.8817419973177052,.9496286491027329,.9833145924917901,.9955178160675857,.9991605581781475,.999899195244447,.9999931550702802],[0,0,0,0,0,0,2283748241799531e-28,4037858874020686e-28,2146547464825323e-28,5461314069809755e-27,4921085770524055e-27,4343405037091838e-27,3732668368707687e-27,3093523840190885e-27,2430835727329466e-27,1734679010007751e-27,974825365660928e-27,2797435120168326e-28,-5456116108943413e-27,-4878985199565852e-27,-4240448995017367e-27,-3559909094758253e-27,-2858043359288075e-27,-2156177623817898e-27,-1475637723558782e-27,-8371015190102975e-28,-2599706096327376e-28,-2382191739347913e-28,-6423305872147834e-28,-9400849094049688e-28,-1122435026096556e-27,-1183840321267481e-27,-1122435026096556e-27,-9400849094049688e-28,-6423305872147841e-28,-2382191739347918e-28]],o=i[r.SHORT_TYPE],l=i[r.SHORT_TYPE],_=i[r.SHORT_TYPE],c=i[r.SHORT_TYPE],u=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];function f(e,a,s){for(var r,i,o,l=10,_=a+238-14-286,c=-15;c<0;c++){var u,f,h;u=n[l+-10],f=e[_+-224]*u,h=e[a+224]*u,u=n[l+-9],f+=e[_+-160]*u,h+=e[a+160]*u,u=n[l+-8],f+=e[_+-96]*u,h+=e[a+96]*u,u=n[l+-7],f+=e[_+-32]*u,h+=e[a+32]*u,u=n[l+-6],f+=e[_+32]*u,h+=e[a+-32]*u,u=n[l+-5],f+=e[_+96]*u,h+=e[a+-96]*u,u=n[l+-4],f+=e[_+160]*u,h+=e[a+-160]*u,u=n[l+-3],f+=e[_+224]*u,h+=e[a+-224]*u,u=n[l+-2],f+=e[a+-256]*u,h-=e[_+256]*u,u=n[l+-1],f+=e[a+-192]*u,h-=e[_+192]*u,u=n[l+0],f+=e[a+-128]*u,h-=e[_+128]*u,u=n[l+1],f+=e[a+-64]*u,h-=e[_+64]*u,u=n[l+2],f+=e[a+0]*u,h-=e[_+0]*u,u=n[l+3],f+=e[a+64]*u,h-=e[_+-64]*u,u=n[l+4],f+=e[a+128]*u,h-=e[_+-128]*u,u=n[l+5],f+=e[a+192]*u,u=(h-=e[_+-192]*u)-(f*=n[l+6]),s[30+2*c]=h+f,s[31+2*c]=n[l+7]*u,l+=18,a--,_++}h=e[a+-16]*n[l+-10],f=e[a+-32]*n[l+-2],h+=(e[a+-48]-e[a+16])*n[l+-9],f+=e[a+-96]*n[l+-1],h+=(e[a+-80]+e[a+48])*n[l+-8],f+=e[a+-160]*n[l+0],h+=(e[a+-112]-e[a+80])*n[l+-7],f+=e[a+-224]*n[l+1],h+=(e[a+-144]+e[a+112])*n[l+-6],f-=e[a+32]*n[l+2],h+=(e[a+-176]-e[a+144])*n[l+-5],f-=e[a+96]*n[l+3],h+=(e[a+-208]+e[a+176])*n[l+-4],f-=e[a+160]*n[l+4],h+=(e[a+-240]-e[a+208])*n[l+-3],r=(f-=e[a+224])-h,i=f+h,h=s[14],f=s[15]-h,s[31]=i+h,s[30]=r+f,s[15]=r-f,s[14]=i-h,o=s[28]-s[0],s[0]+=s[28],s[28]=o*n[l+-36+7],o=s[29]-s[1],s[1]+=s[29],s[29]=o*n[l+-36+7],o=s[26]-s[2],s[2]+=s[26],s[26]=o*n[l+-72+7],o=s[27]-s[3],s[3]+=s[27],s[27]=o*n[l+-72+7],o=s[24]-s[4],s[4]+=s[24],s[24]=o*n[l+-108+7],o=s[25]-s[5],s[5]+=s[25],s[25]=o*n[l+-108+7],o=s[22]-s[6],s[6]+=s[22],s[22]=o*t.SQRT2,o=s[23]-s[7],s[7]+=s[23],s[23]=o*t.SQRT2-s[7],s[7]-=s[6],s[22]-=s[7],s[23]-=s[22],o=s[6],s[6]=s[31]-o,s[31]=s[31]+o,o=s[7],s[7]=s[30]-o,s[30]=s[30]+o,o=s[22],s[22]=s[15]-o,s[15]=s[15]+o,o=s[23],s[23]=s[14]-o,s[14]=s[14]+o,o=s[20]-s[8],s[8]+=s[20],s[20]=o*n[l+-180+7],o=s[21]-s[9],s[9]+=s[21],s[21]=o*n[l+-180+7],o=s[18]-s[10],s[10]+=s[18],s[18]=o*n[l+-216+7],o=s[19]-s[11],s[11]+=s[19],s[19]=o*n[l+-216+7],o=s[16]-s[12],s[12]+=s[16],s[16]=o*n[l+-252+7],o=s[17]-s[13],s[13]+=s[17],s[17]=o*n[l+-252+7],o=-s[20]+s[24],s[20]+=s[24],s[24]=o*n[l+-216+7],o=-s[21]+s[25],s[21]+=s[25],s[25]=o*n[l+-216+7],o=s[4]-s[8],s[4]+=s[8],s[8]=o*n[l+-216+7],o=s[5]-s[9],s[5]+=s[9],s[9]=o*n[l+-216+7],o=s[0]-s[12],s[0]+=s[12],s[12]=o*n[l+-72+7],o=s[1]-s[13],s[1]+=s[13],s[13]=o*n[l+-72+7],o=s[16]-s[28],s[16]+=s[28],s[28]=o*n[l+-72+7],o=-s[17]+s[29],s[17]+=s[29],s[29]=o*n[l+-72+7],o=t.SQRT2*(s[2]-s[10]),s[2]+=s[10],s[10]=o,o=t.SQRT2*(s[3]-s[11]),s[3]+=s[11],s[11]=o,o=t.SQRT2*(-s[18]+s[26]),s[18]+=s[26],s[26]=o-s[18],o=t.SQRT2*(-s[19]+s[27]),s[19]+=s[27],s[27]=o-s[19],o=s[2],s[19]-=s[3],s[3]-=o,s[2]=s[31]-o,s[31]+=o,o=s[3],s[11]-=s[19],s[18]-=o,s[3]=s[30]-o,s[30]+=o,o=s[18],s[27]-=s[11],s[19]-=o,s[18]=s[15]-o,s[15]+=o,o=s[19],s[10]-=o,s[19]=s[14]-o,s[14]+=o,o=s[10],s[11]-=o,s[10]=s[23]-o,s[23]+=o,o=s[11],s[26]-=o,s[11]=s[22]-o,s[22]+=o,o=s[26],s[27]-=o,s[26]=s[7]-o,s[7]+=o,o=s[27],s[27]=s[6]-o,s[6]+=o,o=t.SQRT2*(s[0]-s[4]),s[0]+=s[4],s[4]=o,o=t.SQRT2*(s[1]-s[5]),s[1]+=s[5],s[5]=o,o=t.SQRT2*(s[16]-s[20]),s[16]+=s[20],s[20]=o,o=t.SQRT2*(s[17]-s[21]),s[17]+=s[21],s[21]=o,o=-t.SQRT2*(s[8]-s[12]),s[8]+=s[12],s[12]=o-s[8],o=-t.SQRT2*(s[9]-s[13]),s[9]+=s[13],s[13]=o-s[9],o=-t.SQRT2*(s[25]-s[29]),s[25]+=s[29],s[29]=o-s[25],o=-t.SQRT2*(s[24]+s[28]),s[24]-=s[28],s[28]=o-s[24],o=s[24]-s[16],s[24]=o,o=s[20]-o,s[20]=o,o=s[28]-o,s[28]=o,o=s[25]-s[17],s[25]=o,o=s[21]-o,s[21]=o,o=s[29]-o,s[29]=o,o=s[17]-s[1],s[17]=o,o=s[9]-o,s[9]=o,o=s[25]-o,s[25]=o,o=s[5]-o,s[5]=o,o=s[21]-o,s[21]=o,o=s[13]-o,s[13]=o,o=s[29]-o,s[29]=o,o=s[1]-s[0],s[1]=o,o=s[16]-o,s[16]=o,o=s[17]-o,s[17]=o,o=s[8]-o,s[8]=o,o=s[9]-o,s[9]=o,o=s[24]-o,s[24]=o,o=s[25]-o,s[25]=o,o=s[4]-o,s[4]=o,o=s[5]-o,s[5]=o,o=s[20]-o,s[20]=o,o=s[21]-o,s[21]=o,o=s[12]-o,s[12]=o,o=s[13]-o,s[13]=o,o=s[28]-o,s[28]=o,o=s[29]-o,s[29]=o,o=s[0],s[0]+=s[31],s[31]-=o,o=s[1],s[1]+=s[30],s[30]-=o,o=s[16],s[16]+=s[15],s[15]-=o,o=s[17],s[17]+=s[14],s[14]-=o,o=s[8],s[8]+=s[23],s[23]-=o,o=s[9],s[9]+=s[22],s[22]-=o,o=s[24],s[24]+=s[7],s[7]-=o,o=s[25],s[25]+=s[6],s[6]-=o,o=s[4],s[4]+=s[27],s[27]-=o,o=s[5],s[5]+=s[26],s[26]-=o,o=s[20],s[20]+=s[11],s[11]-=o,o=s[21],s[21]+=s[10],s[10]-=o,o=s[12],s[12]+=s[19],s[19]-=o,o=s[13],s[13]+=s[18],s[18]-=o,o=s[28],s[28]+=s[3],s[3]-=o,o=s[29],s[29]+=s[2],s[2]-=o}function h(e,t){for(var a=0;a<3;a++){var s,n,o,l,_,c;n=(l=e[t+6]*i[r.SHORT_TYPE][0]-e[t+15])+(s=e[t+0]*i[r.SHORT_TYPE][2]-e[t+9]),o=l-s,_=(l=e[t+15]*i[r.SHORT_TYPE][0]+e[t+6])+(s=e[t+9]*i[r.SHORT_TYPE][2]+e[t+0]),c=-l+s,s=2069978111953089e-26*(e[t+3]*i[r.SHORT_TYPE][1]-e[t+12]),l=2069978111953089e-26*(e[t+12]*i[r.SHORT_TYPE][1]+e[t+3]),e[t+0]=190752519173728e-25*n+s,e[t+15]=190752519173728e-25*-_+l,o=.8660254037844387*o*1907525191737281e-26,_=.5*_*1907525191737281e-26+l,e[t+3]=o-_,e[t+6]=o+_,n=.5*n*1907525191737281e-26-s,c=.8660254037844387*c*1907525191737281e-26,e[t+9]=n+c,e[t+12]=n-c,t++}}function m(e,t,a){var s,r,n,i,o,_,c,u,f,h,m,p,d,b,g,v,S,w;n=a[17]-a[9],o=a[15]-a[11],_=a[14]-a[12],c=a[0]+a[8],u=a[1]+a[7],f=a[2]+a[6],h=a[3]+a[5],e[t+17]=c+f-h-(u-a[4]),r=(c+f-h)*l[19]+(u-a[4]),s=(n-o-_)*l[18],e[t+5]=s+r,e[t+6]=s-r,i=(a[16]-a[10])*l[18],u=u*l[19]+a[4],s=n*l[12]+i+o*l[13]+_*l[14],r=-c*l[16]+u-f*l[17]+h*l[15],e[t+1]=s+r,e[t+2]=s-r,s=n*l[13]-i-o*l[14]+_*l[12],r=-c*l[17]+u-f*l[15]+h*l[16],e[t+9]=s+r,e[t+10]=s-r,s=n*l[14]-i+o*l[12]-_*l[13],r=c*l[15]-u+f*l[16]-h*l[17],e[t+13]=s+r,e[t+14]=s-r,m=a[8]-a[0],d=a[6]-a[2],b=a[5]-a[3],g=a[17]+a[9],v=a[16]+a[10],S=a[15]+a[11],w=a[14]+a[12],e[t+0]=g+S+w+(v+a[13]),s=(g+S+w)*l[19]-(v+a[13]),r=(m-d+b)*l[18],e[t+11]=s+r,e[t+12]=s-r,p=(a[7]-a[1])*l[18],v=a[13]-v*l[19],s=g*l[15]-v+S*l[16]+w*l[17],r=m*l[14]+p+d*l[12]+b*l[13],e[t+3]=s+r,e[t+4]=s-r,s=-g*l[17]+v-S*l[15]-w*l[16],r=m*l[13]+p-d*l[14]-b*l[12],e[t+7]=s+r,e[t+8]=s-r,s=-g*l[16]+v-S*l[17]-w*l[15],r=m*l[12]-p+d*l[13]-b*l[14],e[t+15]=s+r,e[t+16]=s-r}this.mdct_sub48=function(t,n,l){for(var p=n,d=286,b=0;b<t.channels_out;b++){for(var g=0;g<t.mode_gr;g++){for(var v,S=t.l3_side.tt[g][b],w=S.xr,M=0,A=t.sb_sample[b][1-g],R=0,E=0;E<9;E++)for(f(p,d,A[R]),f(p,d+32,A[R+1]),R+=2,d+=64,v=1;v<32;v+=2)A[R-1][v]*=-1;for(v=0;v<32;v++,M+=18){var y=S.block_type,k=t.sb_sample[b][g],T=t.sb_sample[b][1-g];if(0!=S.mixed_block_flag&&v<2&&(y=0),t.amp_filter[v]<1e-12)a.fill(w,M+0,M+18,0);else{if(t.amp_filter[v]<1)for(E=0;E<18;E++)T[E][u[v]]*=t.amp_filter[v];if(y==r.SHORT_TYPE){for(E=-3;E<0;E++){var B=i[r.SHORT_TYPE][E+3];w[M+3*E+9]=k[9+E][u[v]]*B-k[8-E][u[v]],w[M+3*E+18]=k[14-E][u[v]]*B+k[15+E][u[v]],w[M+3*E+10]=k[15+E][u[v]]*B-k[14-E][u[v]],w[M+3*E+19]=T[2-E][u[v]]*B+T[3+E][u[v]],w[M+3*E+11]=T[3+E][u[v]]*B-T[2-E][u[v]],w[M+3*E+20]=T[8-E][u[v]]*B+T[9+E][u[v]]}h(w,M)}else{var x=s(18);for(E=-9;E<0;E++){var P,I;P=i[y][E+27]*T[E+9][u[v]]+i[y][E+36]*T[8-E][u[v]],I=i[y][E+9]*k[E+9][u[v]]-i[y][E+18]*k[8-E][u[v]],x[E+9]=P-I*o[3+E+9],x[E+18]=P*o[3+E+9]+I}m(w,M,x)}}if(y!=r.SHORT_TYPE&&0!=v)for(E=7;E>=0;--E){var L,C;L=w[M+E]*_[20+E]+w[M+-1-E]*c[28+E],C=w[M+E]*c[28+E]-w[M+-1-E]*_[20+E],w[M+-1-E]=L,w[M+E]=C}}}if(p=l,d=286,1==t.mode_gr)for(var N=0;N<18;N++)e.arraycopy(t.sb_sample[b][1][N],0,t.sb_sample[b][0][N],0,32)}}}}(),_=function(){if(U)return q;U=1;var e=K();return q=function(){this.thm=new e,this.en=new e}}(),c=o.FFTOFFSET,u=o.MPG_MD_MS_LR,f=null;this.psy=null;var h=null,m=null,p=null;this.setModules=function(e,t,a,s){f=e,this.psy=t,h=t,m=s,p=a};var d=new l;this.lame_encode_mp3_frame=function(l,b,g,v,S,w){var M,A=a([2,2]);A[0][0]=new _,A[0][1]=new _,A[1][0]=new _,A[1][1]=new _;var R,E=a([2,2]);E[0][0]=new _,E[0][1]=new _,E[1][0]=new _,E[1][1]=new _;var y,k,T,B=[null,null],x=l.internal_flags,P=r([2,4]),I=[.5,.5],L=[[0,0],[0,0]],C=[[0,0],[0,0]];if(B[0]=b,B[1]=g,0==x.lame_encode_frame_init&&function(e,t){var a,r,n=e.internal_flags;if(0==n.lame_encode_frame_init){var l,_,c=s(2014),u=s(2014);for(n.lame_encode_frame_init=1,l=0,_=0;l<286+576*(1+n.mode_gr);++l)l<576*n.mode_gr?(c[l]=0,2==n.channels_out&&(u[l]=0)):(c[l]=t[0][_],2==n.channels_out&&(u[l]=t[1][_]),++_);for(r=0;r<n.mode_gr;r++)for(a=0;a<n.channels_out;a++)n.l3_side.tt[r][a].block_type=o.SHORT_TYPE;d.mdct_sub48(n,c,u),i(576>=o.FFTOFFSET),i(n.mf_size>=o.BLKSIZE+e.framesize-o.FFTOFFSET),i(n.mf_size>=512+e.framesize-32)}}(l,B),x.padding=0,(x.slot_lag-=x.frac_SpF)<0&&(x.slot_lag+=l.out_samplerate,x.padding=1),0!=x.psymodel){var N=[null,null],O=0,D=n(2);for(T=0;T<x.mode_gr;T++){for(k=0;k<x.channels_out;k++)N[k]=B[k],O=576+576*T-o.FFTOFFSET;if(0!=(l.VBR==t.vbr_mtrh||l.VBR==t.vbr_mt?h.L3psycho_anal_vbr(l,N,O,T,A,E,L[T],C[T],P[T],D):h.L3psycho_anal_ns(l,N,O,T,A,E,L[T],C[T],P[T],D)))return-4;for(l.mode==MPEGMode.JOINT_STEREO&&(I[T]=P[T][2]+P[T][3],I[T]>0&&(I[T]=P[T][3]/I[T])),k=0;k<x.channels_out;k++){var H=x.l3_side.tt[T][k];H.block_type=D[k],H.mixed_block_flag=0}}}else for(T=0;T<x.mode_gr;T++)for(k=0;k<x.channels_out;k++)x.l3_side.tt[T][k].block_type=o.NORM_TYPE,x.l3_side.tt[T][k].mixed_block_flag=0,C[T][k]=L[T][k]=700;if(function(e){var t,a;if(0!=e.ATH.useAdjust)if(a=e.loudness_sq[0][0],t=e.loudness_sq[1][0],2==e.channels_out?(a+=e.loudness_sq[0][1],t+=e.loudness_sq[1][1]):(a+=a,t+=t),2==e.mode_gr&&(a=Math.max(a,t)),a*=.5,(a*=e.ATH.aaSensitivityP)>.03125)e.ATH.adjust>=1?e.ATH.adjust=1:e.ATH.adjust<e.ATH.adjustLimit&&(e.ATH.adjust=e.ATH.adjustLimit),e.ATH.adjustLimit=1;else{var s=31.98*a+625e-6;e.ATH.adjust>=s?(e.ATH.adjust*=.075*s+.925,e.ATH.adjust<s&&(e.ATH.adjust=s)):e.ATH.adjustLimit>=s?e.ATH.adjust=s:e.ATH.adjust<e.ATH.adjustLimit&&(e.ATH.adjust=e.ATH.adjustLimit),e.ATH.adjustLimit=s}else e.ATH.adjust=1}(x),d.mdct_sub48(x,B[0],B[1]),x.mode_ext=o.MPG_MD_LR_LR,l.force_ms)x.mode_ext=o.MPG_MD_MS_LR;else if(l.mode==MPEGMode.JOINT_STEREO){var F=0,V=0;for(T=0;T<x.mode_gr;T++)for(k=0;k<x.channels_out;k++)F+=C[T][k],V+=L[T][k];if(F<=1*V){var z=x.l3_side.tt[0],X=x.l3_side.tt[x.mode_gr-1];z[0].block_type==z[1].block_type&&X[0].block_type==X[1].block_type&&(x.mode_ext=o.MPG_MD_MS_LR)}}if(x.mode_ext==u?(R=E,y=C):(R=A,y=L),l.analysis&&null!=x.pinfo)for(T=0;T<x.mode_gr;T++)for(k=0;k<x.channels_out;k++)x.pinfo.ms_ratio[T]=x.ms_ratio[T],x.pinfo.ms_ener_ratio[T]=I[T],x.pinfo.blocktype[T][k]=x.l3_side.tt[T][k].block_type,x.pinfo.pe[T][k]=y[T][k],e.arraycopy(x.l3_side.tt[T][k].xr,0,x.pinfo.xr[T][k],0,576),x.mode_ext==u&&(x.pinfo.ers[T][k]=x.pinfo.ers[T][k+2],e.arraycopy(x.pinfo.energy[T][k+2],0,x.pinfo.energy[T][k],0,x.pinfo.energy[T][k].length));if(l.VBR==t.vbr_off||l.VBR==t.vbr_abr){var Y,q;for(Y=0;Y<18;Y++)x.nsPsy.pefirbuf[Y]=x.nsPsy.pefirbuf[Y+1];for(q=0,T=0;T<x.mode_gr;T++)for(k=0;k<x.channels_out;k++)q+=y[T][k];for(x.nsPsy.pefirbuf[18]=q,q=x.nsPsy.pefirbuf[9],Y=0;Y<9;Y++)q+=(x.nsPsy.pefirbuf[Y]+x.nsPsy.pefirbuf[18-Y])*o.fircoef[Y];for(q=3350*x.mode_gr*x.channels_out/q,T=0;T<x.mode_gr;T++)for(k=0;k<x.channels_out;k++)y[T][k]*=q}if(x.iteration_loop.iteration_loop(l,y,I,R),f.format_bitstream(l),M=f.copy_buffer(x,v,S,w,1),l.bWriteVbrTag&&m.addVbrFrame(l),l.analysis&&null!=x.pinfo){for(k=0;k<x.channels_out;k++){var U;for(U=0;U<c;U++)x.pinfo.pcmdata[k][U]=x.pinfo.pcmdata[k][U+l.framesize];for(U=c;U<1600;U++)x.pinfo.pcmdata[k][U]=B[k][U-c]}p.set_frame_pinfo(l,R)}return function(e){var t,a;for(i(0<=e.bitrate_index&&e.bitrate_index<16),i(0<=e.mode_ext&&e.mode_ext<4),e.bitrate_stereoMode_Hist[e.bitrate_index][4]++,e.bitrate_stereoMode_Hist[15][4]++,2==e.channels_out&&(e.bitrate_stereoMode_Hist[e.bitrate_index][e.mode_ext]++,e.bitrate_stereoMode_Hist[15][e.mode_ext]++),t=0;t<e.mode_gr;++t)for(a=0;a<e.channels_out;++a){var s=0|e.l3_side.tt[t][a].block_type;0!=e.l3_side.tt[t][a].mixed_block_flag&&(s=4),e.bitrate_blockType_Hist[e.bitrate_index][s]++,e.bitrate_blockType_Hist[e.bitrate_index][5]++,e.bitrate_blockType_Hist[15][s]++,e.bitrate_blockType_Hist[15][5]++}}(x),M}}return o.ENCDELAY=576,o.POSTDELAY=1152,o.MDCTDELAY=48,o.FFTOFFSET=224+o.MDCTDELAY,o.DECDELAY=528,o.SBLIMIT=32,o.CBANDS=64,o.SBPSY_l=21,o.SBPSY_s=12,o.SBMAX_l=22,o.SBMAX_s=13,o.PSFB21=6,o.PSFB12=6,o.BLKSIZE=1024,o.HBLKSIZE=o.BLKSIZE/2+1,o.BLKSIZE_s=256,o.HBLKSIZE_s=o.BLKSIZE_s/2+1,o.NORM_TYPE=0,o.START_TYPE=1,o.SHORT_TYPE=2,o.STOP_TYPE=3,o.MPG_MD_LR_LR=0,o.MPG_MD_LR_I=1,o.MPG_MD_MS_LR=2,o.MPG_MD_MS_I=3,o.fircoef=[-.1039435,-.1892065,5*-.0432472,-.155915,3898045e-23,.0467745*5,.50455,.756825,.187098*5],j=o}var $=W.Util,Q=W.new_float,J=Z();var ee=W.VbrMode,te=W.Float,ae=W.ShortBlock,se=W.Util,re=W.Arrays,ne=W.new_float,ie=W.new_float_n,oe=W.new_int,le=W.assert,_e=function(){var e=Q(J.BLKSIZE),t=Q(J.BLKSIZE_s/2),a=[.9238795325112867,.3826834323650898,.9951847266721969,.0980171403295606,.9996988186962042,.02454122852291229,.9999811752826011,.006135884649154475];function s(e,t,s){var r,n,i,o=0,l=t+(s<<=1);r=4;do{var _,c,u,f,h,m,p;p=r>>1,m=(h=r<<1)+(f=r),r=h<<1,i=(n=t)+p;do{M=e[n+0]-e[n+f],w=e[n+0]+e[n+f],y=e[n+h]-e[n+m],R=e[n+h]+e[n+m],e[n+h]=w-R,e[n+0]=w+R,e[n+m]=M-y,e[n+f]=M+y,M=e[i+0]-e[i+f],w=e[i+0]+e[i+f],y=$.SQRT2*e[i+m],R=$.SQRT2*e[i+h],e[i+h]=w-R,e[i+0]=w+R,e[i+m]=M-y,e[i+f]=M+y,i+=r,n+=r}while(n<l);for(c=a[o+0],_=a[o+1],u=1;u<p;u++){var d,b;d=1-2*_*_,b=2*_*c,n=t+u,i=t+f-u;do{var g,v,S,w,M,A,R,E,y,k;v=b*e[n+f]-d*e[i+f],g=d*e[n+f]+b*e[i+f],M=e[n+0]-g,w=e[n+0]+g,A=e[i+0]-v,S=e[i+0]+v,v=b*e[n+m]-d*e[i+m],g=d*e[n+m]+b*e[i+m],y=e[n+h]-g,R=e[n+h]+g,k=e[i+h]-v,E=e[i+h]+v,v=_*R-c*k,g=c*R+_*k,e[n+h]=w-g,e[n+0]=w+g,e[i+m]=A-v,e[i+f]=A+v,v=c*E-_*y,g=_*E+c*y,e[i+h]=S-g,e[i+0]=S+g,e[n+m]=M-v,e[n+f]=M+v,i+=r,n+=r}while(n<l);c=(d=c)*a[o+0]-_*a[o+1],_=d*a[o+1]+_*a[o+0]}o+=2}while(r<s)}var r=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(e,a,n,i,o){for(var l=0;l<3;l++){var _=J.BLKSIZE_s/2,c=65535&192*(l+1),u=J.BLKSIZE_s/8-1;do{var f,h,m,p,d,b=255&r[u<<2];h=(f=t[b]*i[n][o+b+c])-(d=t[127-b]*i[n][o+b+c+128]),f+=d,p=(m=t[b+64]*i[n][o+b+c+64])-(d=t[63-b]*i[n][o+b+c+192]),m+=d,_-=4,a[l][_+0]=f+m,a[l][_+2]=f-m,a[l][_+1]=h+p,a[l][_+3]=h-p,h=(f=t[b+1]*i[n][o+b+c+1])-(d=t[126-b]*i[n][o+b+c+129]),f+=d,p=(m=t[b+65]*i[n][o+b+c+65])-(d=t[62-b]*i[n][o+b+c+193]),m+=d,a[l][_+J.BLKSIZE_s/2+0]=f+m,a[l][_+J.BLKSIZE_s/2+2]=f-m,a[l][_+J.BLKSIZE_s/2+1]=h+p,a[l][_+J.BLKSIZE_s/2+3]=h-p}while(--u>=0);s(a[l],_,J.BLKSIZE_s/2)}},this.fft_long=function(t,a,n,i,o){var l=J.BLKSIZE/8-1,_=J.BLKSIZE/2;do{var c,u,f,h,m,p=255&r[l];u=(c=e[p]*i[n][o+p])-(m=e[p+512]*i[n][o+p+512]),c+=m,h=(f=e[p+256]*i[n][o+p+256])-(m=e[p+768]*i[n][o+p+768]),f+=m,a[(_-=4)+0]=c+f,a[_+2]=c-f,a[_+1]=u+h,a[_+3]=u-h,u=(c=e[p+1]*i[n][o+p+1])-(m=e[p+513]*i[n][o+p+513]),c+=m,h=(f=e[p+257]*i[n][o+p+257])-(m=e[p+769]*i[n][o+p+769]),f+=m,a[_+J.BLKSIZE/2+0]=c+f,a[_+J.BLKSIZE/2+2]=c-f,a[_+J.BLKSIZE/2+1]=u+h,a[_+J.BLKSIZE/2+3]=u-h}while(--l>=0);s(a,_,J.BLKSIZE/2)},this.init_fft=function(a){for(var s=0;s<J.BLKSIZE;s++)e[s]=.42-.5*Math.cos(2*Math.PI*(s+.5)/J.BLKSIZE)+.08*Math.cos(4*Math.PI*(s+.5)/J.BLKSIZE);for(s=0;s<J.BLKSIZE_s/2;s++)t[s]=.5*(1-Math.cos(2*Math.PI*(s+.5)/J.BLKSIZE_s))}},ce=Z();var ue=function(){var e=new _e,t=2.302585092994046,a=1/217621504/(ce.BLKSIZE/2),s=.3,r=21,n=.2302585093;function i(e){return e}function o(e,t){for(var s=0,r=0;r<ce.BLKSIZE/2;++r)s+=e[r]*t.ATH.eql_w[r];return s*=a}function l(t,a,s,r,n,l,_,c,u,f,h){var m=t.internal_flags;if(u<2)e.fft_long(m,r[n],u,f,h),e.fft_short(m,l[_],u,f,h);else if(2==u){for(var p=ce.BLKSIZE-1;p>=0;--p){var d=r[n+0][p],b=r[n+1][p];r[n+0][p]=(d+b)*se.SQRT2*.5,r[n+1][p]=(d-b)*se.SQRT2*.5}for(var g=2;g>=0;--g)for(p=ce.BLKSIZE_s-1;p>=0;--p){d=l[_+0][g][p],b=l[_+1][g][p];l[_+0][g][p]=(d+b)*se.SQRT2*.5,l[_+1][g][p]=(d-b)*se.SQRT2*.5}}a[0]=r[n+0][0],a[0]*=a[0];for(p=ce.BLKSIZE/2-1;p>=0;--p){var v=r[n+0][ce.BLKSIZE/2-p],S=r[n+0][ce.BLKSIZE/2+p];a[ce.BLKSIZE/2-p]=i(.5*(v*v+S*S))}for(g=2;g>=0;--g){s[g][0]=l[_+0][g][0],s[g][0]*=s[g][0];for(p=ce.BLKSIZE_s/2-1;p>=0;--p){v=l[_+0][g][ce.BLKSIZE_s/2-p],S=l[_+0][g][ce.BLKSIZE_s/2+p];s[g][ce.BLKSIZE_s/2-p]=i(.5*(v*v+S*S))}}var w=0;for(p=11;p<ce.HBLKSIZE;p++)w+=a[p];if(m.tot_ener[u]=w,t.analysis){for(p=0;p<ce.HBLKSIZE;p++)m.pinfo.energy[c][u][p]=m.pinfo.energy_save[u][p],m.pinfo.energy_save[u][p]=a[p];m.pinfo.pe[c][u]=m.pe[u]}2==t.athaa_loudapprox&&u<2&&(m.loudness_sq[c][u]=m.loudness_sq_save[u],m.loudness_sq_save[u]=o(a,m))}var _,c,u,f=[1,.79433,.63096,.63096,.63096,.63096,.63096,.25119,.11749],h=[3.3246*3.3246,3.23837*3.23837,9.9500500969,9.0247369744,8.1854926609,7.0440875649,2.46209*2.46209,2.284*2.284,4.4892710641,1.96552*1.96552,1.82335*1.82335,1.69146*1.69146,2.4621061921,2.1508568964,1.37074*1.37074,1.31036*1.31036,1.5691069696,1.4555939904,1.16203*1.16203,1.2715945225,1.09428*1.09428,1.0659*1.0659,1.0779838276,1.0382591025,1],m=[1.7782755904,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.6999465924,1.22321*1.22321,1.3169398564,1],p=[5.5396212496,2.29259*2.29259,4.9868695969,2.12675*2.12675,2.02545*2.02545,1.87894*1.87894,1.74303*1.74303,1.61695*1.61695,2.2499700001,1.39148*1.39148,1.29083*1.29083,1.19746*1.19746,1.2339655056,1.0779838276];function d(e,t,a,s,r,n){var i;if(t>e){if(!(t<e*c))return e+t;i=t/e}else{if(e>=t*c)return e+t;i=e/t}if(e+=t,s+3<=6){if(i>=_)return e;var o=0|se.FAST_LOG10_X(i,16);return e*m[o]}var l,f;o=0|se.FAST_LOG10_X(i,16);return t=r.ATH.cb_l[a]*r.ATH.adjust,e<u*t?e>t?(l=1,o<=13&&(l=p[o]),f=se.FAST_LOG10_X(e/t,10/15),e*((h[o]-l)*f+l)):o>13?e:e*p[o]:e*h[o]}var b=[1.7782755904,1.35879*1.35879,1.38454*1.38454,1.39497*1.39497,1.40548*1.40548,1.3537*1.3537,1.6999465924,1.22321*1.22321,1.3169398564,1];function g(e,t,a){var s;if(e<0&&(e=0),t<0&&(t=0),e<=0)return t;if(t<=0)return e;if(s=t>e?t/e:e/t,-2<=a&&a<=2){if(s>=_)return e+t;var r=0|se.FAST_LOG10_X(s,16);return(e+t)*b[r]}return s<c?e+t:(e<t&&(e=t),e)}function v(e,t,a,s,r){var n,i,o=0,l=0;for(n=i=0;n<ce.SBMAX_s;++i,++n){for(var _=e.bo_s[n],c=e.npart_s,u=_<c?_:c;i<u;)le(t[i]>=0),le(a[i]>=0),o+=t[i],l+=a[i],i++;if(e.en[s].s[n][r]=o,e.thm[s].s[n][r]=l,i>=c){++n;break}le(t[i]>=0),le(a[i]>=0);var f=e.PSY.bo_s_weight[n],h=1-f;o=f*t[i],l=f*a[i],e.en[s].s[n][r]+=o,e.thm[s].s[n][r]+=l,o=h*t[i],l=h*a[i]}for(;n<ce.SBMAX_s;++n)e.en[s].s[n][r]=0,e.thm[s].s[n][r]=0}function S(e,t,a,s){var r,n,i=0,o=0;for(r=n=0;r<ce.SBMAX_l;++n,++r){for(var l=e.bo_l[r],_=e.npart_l,c=l<_?l:_;n<c;)le(t[n]>=0),le(a[n]>=0),i+=t[n],o+=a[n],n++;if(e.en[s].l[r]=i,e.thm[s].l[r]=o,n>=_){++r;break}le(t[n]>=0),le(a[n]>=0);var u=e.PSY.bo_l_weight[r],f=1-u;i=u*t[n],o=u*a[n],e.en[s].l[r]+=i,e.thm[s].l[r]+=o,i=f*t[n],o=f*a[n]}for(;r<ce.SBMAX_l;++r)e.en[s].l[r]=0,e.thm[s].l[r]=0}function w(e,t,a,s,r,n){var i,o,l=e.internal_flags;for(o=i=0;o<l.npart_s;++o){for(var _=0,c=l.numlines_s[o],u=0;u<c;++u,++i){_+=t[n][i]}a[o]=_}for(le(o==l.npart_s),i=o=0;o<l.npart_s;o++){var f=l.s3ind_s[o][0],h=l.s3_ss[i++]*a[f];for(++f;f<=l.s3ind_s[o][1];)h+=l.s3_ss[i]*a[f],++i,++f;var m=2*l.nb_s1[r][o];if(s[o]=Math.min(h,m),l.blocktype_old[1&r]==ce.SHORT_TYPE){m=16*l.nb_s2[r][o];var p=s[o];s[o]=Math.min(m,p)}l.nb_s2[r][o]=l.nb_s1[r][o],l.nb_s1[r][o]=h,le(s[o]>=0)}for(;o<=ce.CBANDS;++o)a[o]=0,s[o]=0}function M(e,t,a){return a>=1?e:a<=0?t:t>0?Math.pow(e/t,a)*t:0}var A=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130];function R(e,a){for(var s=309.07,r=0;r<ce.SBMAX_s-1;r++)for(var n=0;n<3;n++){var i=e.thm.s[r][n];if(i>0){var o=i*a,l=e.en.s[r][n];l>o&&(s+=l>1e10*o?A[r]*(10*t):A[r]*se.FAST_LOG10(l/o))}}return s}var E=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1];function y(e,a){for(var s=281.0575,r=0;r<ce.SBMAX_l-1;r++){var n=e.thm.l[r];if(n>0){var i=n*a,o=e.en.l[r];o>i&&(s+=o>1e10*i?E[r]*(10*t):E[r]*se.FAST_LOG10(o/i))}}return s}function k(e,t,a,s,r){var n,i;for(n=i=0;n<e.npart_l;++n){var o,l=0,_=0;for(o=0;o<e.numlines_l[n];++o,++i){var c=t[i];l+=c,_<c&&(_=c)}a[n]=l,s[n]=_,r[n]=l*e.rnumlines_l[n],le(e.rnumlines_l[n]>=0),le(a[n]>=0),le(s[n]>=0),le(r[n]>=0)}}function T(e,t,a,s){var r=f.length-1,n=0,i=a[n]+a[n+1];i>0?((o=t[n])<t[n+1]&&(o=t[n+1]),le(e.numlines_l[n]+e.numlines_l[n+1]-1>0),(l=0|(i=20*(2*o-i)/(i*(e.numlines_l[n]+e.numlines_l[n+1]-1))))>r&&(l=r),s[n]=l):s[n]=0;for(n=1;n<e.npart_l-1;n++){var o,l;if((i=a[n-1]+a[n]+a[n+1])>0)(o=t[n-1])<t[n]&&(o=t[n]),o<t[n+1]&&(o=t[n+1]),le(e.numlines_l[n-1]+e.numlines_l[n]+e.numlines_l[n+1]-1>0),(l=0|(i=20*(3*o-i)/(i*(e.numlines_l[n-1]+e.numlines_l[n]+e.numlines_l[n+1]-1))))>r&&(l=r),s[n]=l;else s[n]=0}(le(n==e.npart_l-1),(i=a[n-1]+a[n])>0)?((o=t[n-1])<t[n]&&(o=t[n]),le(e.numlines_l[n-1]+e.numlines_l[n]-1>0),(l=0|(i=20*(2*o-i)/(i*(e.numlines_l[n-1]+e.numlines_l[n]-1))))>r&&(l=r),s[n]=l):s[n]=0;le(n==e.npart_l-1)}var B=[-1730326e-23,-.01703172,-1349528e-23,.0418072,-673278e-22,-.0876324,-30835e-21,.1863476,-1104424e-22,-.627638];function x(t,a,s,r,n,o,l,_){var c=t.internal_flags;if(r<2)e.fft_long(c,l[_],r,a,s);else if(2==r)for(var u=ce.BLKSIZE-1;u>=0;--u){var f=l[_+0][u],h=l[_+1][u];l[_+0][u]=(f+h)*se.SQRT2*.5,l[_+1][u]=(f-h)*se.SQRT2*.5}o[0]=l[_+0][0],o[0]*=o[0];for(u=ce.BLKSIZE/2-1;u>=0;--u){var m=l[_+0][ce.BLKSIZE/2-u],p=l[_+0][ce.BLKSIZE/2+u];o[ce.BLKSIZE/2-u]=i(.5*(m*m+p*p))}var d=0;for(u=11;u<ce.HBLKSIZE;u++)d+=o[u];if(c.tot_ener[r]=d,t.analysis){for(u=0;u<ce.HBLKSIZE;u++)c.pinfo.energy[n][r][u]=c.pinfo.energy_save[r][u],c.pinfo.energy_save[r][u]=o[u];c.pinfo.pe[n][r]=c.pe[r]}}function P(t,a,s,r,n,o,l,_){var c=t.internal_flags;if(0==n&&r<2&&e.fft_short(c,l[_],r,a,s),2==r)for(var u=ce.BLKSIZE_s-1;u>=0;--u){var f=l[_+0][n][u],h=l[_+1][n][u];l[_+0][n][u]=(f+h)*se.SQRT2*.5,l[_+1][n][u]=(f-h)*se.SQRT2*.5}o[n][0]=l[_+0][n][0],o[n][0]*=o[n][0];for(u=ce.BLKSIZE_s/2-1;u>=0;--u){var m=l[_+0][n][ce.BLKSIZE_s/2-u],p=l[_+0][n][ce.BLKSIZE_s/2+u];o[n][ce.BLKSIZE_s/2-u]=i(.5*(m*m+p*p))}}function I(e,t,a,s){var r=e.internal_flags;2==e.athaa_loudapprox&&a<2&&(r.loudness_sq[t][a]=r.loudness_sq_save[a],r.loudness_sq_save[a]=o(s,r))}this.L3psycho_anal_ns=function(e,t,a,n,i,o,_,c,u,h){var m,p,b,g,A,E,x,P,I,L,C=e.internal_flags,N=ie([2,ce.BLKSIZE]),O=ie([2,3,ce.BLKSIZE_s]),D=ne(ce.CBANDS+1),H=ne(ce.CBANDS+1),F=ne(ce.CBANDS+2),V=oe(2),z=oe(2),X=ie([2,576]),Y=oe(ce.CBANDS+2),q=oe(ce.CBANDS+2);for(re.fill(q,0),m=C.channels_out,e.mode==MPEGMode.JOINT_STEREO&&(m=4),I=e.VBR==ee.vbr_off?0==C.ResvMax?0:C.ResvSize/C.ResvMax*.5:e.VBR==ee.vbr_rh||e.VBR==ee.vbr_mtrh||e.VBR==ee.vbr_mt?.6:1,p=0;p<C.channels_out;p++){var U=t[p],j=a+576-350-r+192;for(g=0;g<576;g++){var G,W;for(G=U[j+g+10],W=0,A=0;A<9;A+=2)G+=B[A]*(U[j+g+A]+U[j+g+r-A]),W+=B[A+1]*(U[j+g+A+1]+U[j+g+r-A-1]);X[p][g]=G+W}i[n][p].en.assign(C.en[p]),i[n][p].thm.assign(C.thm[p]),m>2&&(o[n][p].en.assign(C.en[p+2]),o[n][p].thm.assign(C.thm[p+2]))}for(p=0;p<m;p++){var K,Z=ne(12),$=[0,0,0,0],Q=ne(12),J=1,te=ne(ce.CBANDS),se=ne(ce.CBANDS),_e=[0,0,0,0],ue=ne(ce.HBLKSIZE),fe=ie([3,ce.HBLKSIZE_s]);for(le(C.npart_s<=ce.CBANDS),le(C.npart_l<=ce.CBANDS),g=0;g<3;g++)Z[g]=C.nsPsy.last_en_subshort[p][g+6],le(C.nsPsy.last_en_subshort[p][g+4]>0),Q[g]=Z[g]/C.nsPsy.last_en_subshort[p][g+4],$[0]+=Z[g];if(2==p)for(g=0;g<576;g++){var he,me;he=X[0][g],me=X[1][g],X[0][g]=he+me,X[1][g]=he-me}var pe=X[1&p],de=0;for(g=0;g<9;g++){for(var be=de+64,ge=1;de<be;de++)ge<Math.abs(pe[de])&&(ge=Math.abs(pe[de]));C.nsPsy.last_en_subshort[p][g]=Z[g+3]=ge,$[1+g/3]+=ge,ge>Z[g+3-2]?(le(Z[g+3-2]>0),ge/=Z[g+3-2]):ge=Z[g+3-2]>10*ge?Z[g+3-2]/(10*ge):0,Q[g+3]=ge}if(e.analysis){var ve=Q[0];for(g=1;g<12;g++)ve<Q[g]&&(ve=Q[g]);C.pinfo.ers[n][p]=C.pinfo.ers_save[p],C.pinfo.ers_save[p]=ve}for(K=3==p?C.nsPsy.attackthre_s:C.nsPsy.attackthre,g=0;g<12;g++)0==_e[g/3]&&Q[g]>K&&(_e[g/3]=g%3+1);for(g=1;g<4;g++){var Se;$[g-1]>$[g]?(le($[g]>0),Se=$[g-1]/$[g]):(le($[g-1]>0),Se=$[g]/$[g-1]),Se<1.7&&(_e[g]=0,1==g&&(_e[0]=0))}for(0!=_e[0]&&0!=C.nsPsy.lastAttacks[p]&&(_e[0]=0),3!=C.nsPsy.lastAttacks[p]&&_e[0]+_e[1]+_e[2]+_e[3]==0||(J=0,0!=_e[1]&&0!=_e[0]&&(_e[1]=0),0!=_e[2]&&0!=_e[1]&&(_e[2]=0),0!=_e[3]&&0!=_e[2]&&(_e[3]=0)),p<2?z[p]=J:0==J&&(z[0]=z[1]=0),u[p]=C.tot_ener[p],l(e,ue,fe,N,1&p,O,1&p,n,p,t,a),k(C,ue,D,te,se),T(C,te,se,Y),P=0;P<3;P++){var we,Me;for(w(e,fe,H,F,p,P),v(C,H,F,p,P),x=0;x<ce.SBMAX_s;x++){if(Me=C.thm[p].s[x][P],Me*=.8,_e[P]>=2||1==_e[P+1]){var Ae=0!=P?P-1:2;ge=M(C.thm[p].s[x][Ae],Me,.6*I);Me=Math.min(Me,ge)}if(1==_e[P]){Ae=0!=P?P-1:2,ge=M(C.thm[p].s[x][Ae],Me,s*I);Me=Math.min(Me,ge)}else if(0!=P&&3==_e[P-1]||0==P&&3==C.nsPsy.lastAttacks[p]){Ae=2!=P?P+1:0,ge=M(C.thm[p].s[x][Ae],Me,s*I);Me=Math.min(Me,ge)}we=Z[3*P+3]+Z[3*P+4]+Z[3*P+5],6*Z[3*P+5]<we&&(Me*=.5,6*Z[3*P+4]<we&&(Me*=.5)),C.thm[p].s[x][P]=Me}}for(C.nsPsy.lastAttacks[p]=_e[2],E=0,b=0;b<C.npart_l;b++){for(var Re=C.s3ind[b][0],Ee=D[Re]*f[Y[Re]],ye=C.s3_ll[E++]*Ee;++Re<=C.s3ind[b][1];)Ee=D[Re]*f[Y[Re]],ye=d(ye,C.s3_ll[E++]*Ee,Re,Re-b,C);ye*=.158489319246111,C.blocktype_old[1&p]==ce.SHORT_TYPE?F[b]=ye:F[b]=M(Math.min(ye,Math.min(2*C.nb_1[p][b],16*C.nb_2[p][b])),ye,I),C.nb_2[p][b]=C.nb_1[p][b],C.nb_1[p][b]=ye}for(;b<=ce.CBANDS;++b)D[b]=0,F[b]=0;S(C,D,F,p)}(e.mode!=MPEGMode.STEREO&&e.mode!=MPEGMode.JOINT_STEREO||e.interChRatio>0&&function(e,t){var a=e.internal_flags;if(a.channels_out>1){for(var s=0;s<ce.SBMAX_l;s++){var r=a.thm[0].l[s],n=a.thm[1].l[s];a.thm[0].l[s]+=n*t,a.thm[1].l[s]+=r*t}for(s=0;s<ce.SBMAX_s;s++)for(var i=0;i<3;i++)r=a.thm[0].s[s][i],n=a.thm[1].s[s][i],a.thm[0].s[s][i]+=n*t,a.thm[1].s[s][i]+=r*t}}(e,e.interChRatio),e.mode==MPEGMode.JOINT_STEREO)&&(!function(e){for(var t=0;t<ce.SBMAX_l;t++)if(!(e.thm[0].l[t]>1.58*e.thm[1].l[t]||e.thm[1].l[t]>1.58*e.thm[0].l[t])){var a=e.mld_l[t]*e.en[3].l[t],s=Math.max(e.thm[2].l[t],Math.min(e.thm[3].l[t],a));a=e.mld_l[t]*e.en[2].l[t];var r=Math.max(e.thm[3].l[t],Math.min(e.thm[2].l[t],a));e.thm[2].l[t]=s,e.thm[3].l[t]=r}for(t=0;t<ce.SBMAX_s;t++)for(var n=0;n<3;n++)e.thm[0].s[t][n]>1.58*e.thm[1].s[t][n]||e.thm[1].s[t][n]>1.58*e.thm[0].s[t][n]||(a=e.mld_s[t]*e.en[3].s[t][n],s=Math.max(e.thm[2].s[t][n],Math.min(e.thm[3].s[t][n],a)),a=e.mld_s[t]*e.en[2].s[t][n],r=Math.max(e.thm[3].s[t][n],Math.min(e.thm[2].s[t][n],a)),e.thm[2].s[t][n]=s,e.thm[3].s[t][n]=r)}(C),L=e.msfix,Math.abs(L)>0&&function(e,t,a){var s=t,r=Math.pow(10,a);t*=2,s*=2;for(var n=0;n<ce.SBMAX_l;n++)c=e.ATH.cb_l[e.bm_l[n]]*r,(o=Math.min(Math.max(e.thm[0].l[n],c),Math.max(e.thm[1].l[n],c)))*t<(l=Math.max(e.thm[2].l[n],c))+(_=Math.max(e.thm[3].l[n],c))&&(l*=u=o*s/(l+_),_*=u),e.thm[2].l[n]=Math.min(l,e.thm[2].l[n]),e.thm[3].l[n]=Math.min(_,e.thm[3].l[n]);for(r*=ce.BLKSIZE_s/ce.BLKSIZE,n=0;n<ce.SBMAX_s;n++)for(var i=0;i<3;i++){var o,l,_,c,u;c=e.ATH.cb_s[e.bm_s[n]]*r,(o=Math.min(Math.max(e.thm[0].s[n][i],c),Math.max(e.thm[1].s[n][i],c)))*t<(l=Math.max(e.thm[2].s[n][i],c))+(_=Math.max(e.thm[3].s[n][i],c))&&(l*=u=o*t/(l+_),_*=u),e.thm[2].s[n][i]=Math.min(e.thm[2].s[n][i],l),e.thm[3].s[n][i]=Math.min(e.thm[3].s[n][i],_)}}(C,L,e.ATHlower*C.ATH.adjust));for(function(e,t,a,s){var r=e.internal_flags;e.short_blocks!=ae.short_block_coupled||0!=t[0]&&0!=t[1]||(t[0]=t[1]=0);for(var n=0;n<r.channels_out;n++)s[n]=ce.NORM_TYPE,e.short_blocks==ae.short_block_dispensed&&(t[n]=1),e.short_blocks==ae.short_block_forced&&(t[n]=0),0!=t[n]?(le(r.blocktype_old[n]!=ce.START_TYPE),r.blocktype_old[n]==ce.SHORT_TYPE&&(s[n]=ce.STOP_TYPE)):(s[n]=ce.SHORT_TYPE,r.blocktype_old[n]==ce.NORM_TYPE&&(r.blocktype_old[n]=ce.START_TYPE),r.blocktype_old[n]==ce.STOP_TYPE&&(r.blocktype_old[n]=ce.SHORT_TYPE)),a[n]=r.blocktype_old[n],r.blocktype_old[n]=s[n]}(e,z,h,V),p=0;p<m;p++){var ke,Te,Be,xe=0;p>1?(ke=c,xe=-2,Te=ce.NORM_TYPE,h[0]!=ce.SHORT_TYPE&&h[1]!=ce.SHORT_TYPE||(Te=ce.SHORT_TYPE),Be=o[n][p-2]):(ke=_,xe=0,Te=h[p],Be=i[n][p]),Te==ce.SHORT_TYPE?ke[xe+p]=R(Be,C.masking_lower):ke[xe+p]=y(Be,C.masking_lower),e.analysis&&(C.pinfo.pe[n][p]=ke[xe+p])}return 0};var L=[-1730326e-23,-.01703172,-1349528e-23,.0418072,-673278e-22,-.0876324,-30835e-21,.1863476,-1104424e-22,-.627638];function C(e,t,a){if(0==a)for(var s=0;s<e.npart_s;s++)e.nb_s2[t][s]=e.nb_s1[t][s],e.nb_s1[t][s]=0}function N(e,t){for(var a=0;a<e.npart_l;a++)e.nb_2[t][a]=e.nb_1[t][a],e.nb_1[t][a]=0}function O(e,t,a,s,r,n){var i,o,l,_=e.internal_flags,c=new float[ce.CBANDS],u=ne(ce.CBANDS),h=new int[ce.CBANDS];for(l=o=0;l<_.npart_s;++l){var m=0,p=0,d=_.numlines_s[l];for(i=0;i<d;++i,++o){var b=t[n][o];m+=b,p<b&&(p=b)}a[l]=m,c[l]=p,u[l]=m/d,le(u[l]>=0)}for(le(l==_.npart_s);l<ce.CBANDS;++l)c[l]=0,u[l]=0;for(function(e,t,a,s){var r=f.length-1,n=0,i=a[n]+a[n+1];for(i>0?((o=t[n])<t[n+1]&&(o=t[n+1]),le(e.numlines_s[n]+e.numlines_s[n+1]-1>0),(l=0|(i=20*(2*o-i)/(i*(e.numlines_s[n]+e.numlines_s[n+1]-1))))>r&&(l=r),s[n]=l):s[n]=0,n=1;n<e.npart_s-1;n++){var o,l;i=a[n-1]+a[n]+a[n+1],le(n+1<e.npart_s),i>0?((o=t[n-1])<t[n]&&(o=t[n]),o<t[n+1]&&(o=t[n+1]),le(e.numlines_s[n-1]+e.numlines_s[n]+e.numlines_s[n+1]-1>0),(l=0|(i=20*(3*o-i)/(i*(e.numlines_s[n-1]+e.numlines_s[n]+e.numlines_s[n+1]-1))))>r&&(l=r),s[n]=l):s[n]=0}le(n==e.npart_s-1),(i=a[n-1]+a[n])>0?((o=t[n-1])<t[n]&&(o=t[n]),le(e.numlines_s[n-1]+e.numlines_s[n]-1>0),(l=0|(i=20*(2*o-i)/(i*(e.numlines_s[n-1]+e.numlines_s[n]-1))))>r&&(l=r),s[n]=l):s[n]=0,le(n==e.npart_s-1)}(_,c,u,h),o=l=0;l<_.npart_s;l++){var v,S,w,M,A,R=_.s3ind_s[l][0],E=_.s3ind_s[l][1];for(v=h[R],S=1,M=_.s3_ss[o]*a[R]*f[h[R]],++o,++R;R<=E;)v+=h[R],S+=1,M=g(M,w=_.s3_ss[o]*a[R]*f[h[R]],R-l),++o,++R;M*=A=.5*f[v=(1+2*v)/(2*S)],s[l]=M,_.nb_s2[r][l]=_.nb_s1[r][l],_.nb_s1[r][l]=M,w=c[l],w*=_.minval_s[l],w*=A,s[l]>w&&(s[l]=w),_.masking_lower>1&&(s[l]*=_.masking_lower),s[l]>a[l]&&(s[l]=a[l]),_.masking_lower<1&&(s[l]*=_.masking_lower),le(s[l]>=0)}for(;l<ce.CBANDS;++l)a[l]=0,s[l]=0}function D(e,t,a,r,n){var i,o=ne(ce.CBANDS),l=ne(ce.CBANDS),_=oe(ce.CBANDS+2);k(e,t,a,o,l),T(e,o,l,_);var c=0;for(i=0;i<e.npart_l;i++){var u,h,m,p=e.s3ind[i][0],d=e.s3ind[i][1],b=0,v=0;for(b=_[p],v+=1,h=e.s3_ll[c]*a[p]*f[_[p]],++c,++p;p<=d;)b+=_[p],v+=1,h=g(h,u=e.s3_ll[c]*a[p]*f[_[p]],p-i),++c,++p;if(h*=m=.5*f[b=(1+2*b)/(2*v)],e.blocktype_old[1&n]==ce.SHORT_TYPE){var S=2*e.nb_1[n][i];r[i]=S>0?Math.min(h,S):Math.min(h,a[i]*s)}else{var w=16*e.nb_2[n][i],M=2*e.nb_1[n][i];w<=0&&(w=h),M<=0&&(M=h),S=e.blocktype_old[1&n]==ce.NORM_TYPE?Math.min(M,w):M,r[i]=Math.min(h,S)}e.nb_2[n][i]=e.nb_1[n][i],e.nb_1[n][i]=h,u=o[i],u*=e.minval_l[i],u*=m,r[i]>u&&(r[i]=u),e.masking_lower>1&&(r[i]*=e.masking_lower),r[i]>a[i]&&(r[i]=a[i]),e.masking_lower<1&&(r[i]*=e.masking_lower),le(r[i]>=0)}for(;i<ce.CBANDS;++i)a[i]=0,r[i]=0}function H(e,t,a,s,r,n,i){for(var o,l,_=2*n,c=n>0?Math.pow(10,r):1,u=0;u<i;++u){var f=e[2][u],h=e[3][u],m=t[0][u],p=t[1][u],d=t[2][u],b=t[3][u];if(m<=1.58*p&&p<=1.58*m){var g=a[u]*h,v=a[u]*f;l=Math.max(d,Math.min(b,g)),o=Math.max(b,Math.min(d,v))}else l=d,o=b;if(n>0){var S,w,M=s[u]*c;if(S=Math.min(Math.max(m,M),Math.max(p,M)),(w=(d=Math.max(l,M))+(b=Math.max(o,M)))>0&&S*_<w){var A=S*_/w;d*=A,b*=A}l=Math.min(d,l),o=Math.min(b,o)}l>f&&(l=f),o>h&&(o=h),t[2][u]=l,t[3][u]=o}}function F(e,t){var a;return(a=e>=0?27*-e:e*t)<=-72?0:Math.exp(a*n)}function V(e){var t,a,s=0;for(s=0;F(s,e)>1e-20;s-=1);for(r=s,n=0;Math.abs(n-r)>1e-12;)F(s=(n+r)/2,e)>0?n=s:r=s;t=r;var r,n;s=0;for(s=0;F(s,e)>1e-20;s+=1);for(r=0,n=s;Math.abs(n-r)>1e-12;)F(s=(n+r)/2,e)>0?r=s:n=s;a=n;var i,o=0,l=1e3;for(i=0;i<=l;++i){o+=F(s=t+i*(a-t)/l,e)}return(l+1)/(o*(a-t))}function z(e){var t,a,s,r;return t=e,a=(t*=t>=0?3:1.5)>=.5&&t<=2.5?8*((r=t-.5)*r-2*r):0,(s=15.811389+7.5*(t+=.474)-17.5*Math.sqrt(1+t*t))<=-60?0:(t=Math.exp((a+s)*n),t/=.6609193)}function X(e){return e<0&&(e=0),e*=.001,13*Math.atan(.76*e)+3.5*Math.atan(e*e/56.25)}function Y(e,t,a,s,r,n,i,o,l,_,c,u){var f,h=ne(ce.CBANDS+1),m=o/(u>15?1152:384),p=oe(ce.HBLKSIZE);o/=l;var d=0,b=0;for(f=0;f<ce.CBANDS;f++){var g;for(k=X(o*d),h[f]=o*d,g=d;X(o*g)-k<.34&&g<=l/2;g++);for(e[f]=g-d,b=f+1;d<g;)le(d<ce.HBLKSIZE),p[d++]=f;if(d>l/2){d=l/2,++f;break}}le(f<ce.CBANDS),h[f]=o*d;for(var v=0;v<u;v++){var S,w,M,A,R;M=_[v],A=_[v+1],(S=0|Math.floor(.5+c*(M-.5)))<0&&(S=0),(w=0|Math.floor(.5+c*(A-.5)))>l/2&&(w=l/2),a[v]=(p[S]+p[w])/2,t[v]=p[w];var E=m*A;i[v]=(E-h[t[v]])/(h[t[v]+1]-h[t[v]]),i[v]<0?i[v]=0:i[v]>1&&(i[v]=1),R=X(o*_[v]*c),R=Math.min(R,15.5)/15.5,n[v]=Math.pow(10,1.25*(1-Math.cos(Math.PI*R))-2.5)}d=0;for(var y=0;y<b;y++){var k,T,B=e[y];k=X(o*d),T=X(o*(d+B-1)),s[y]=.5*(k+T),k=X(o*(d-.5)),T=X(o*(d+B-.5)),r[y]=T-k,d+=B}return b}function q(e,t,a,s,r,n){var i,o=ie([ce.CBANDS,ce.CBANDS]),l=0;if(n)for(var _=0;_<t;_++)for(i=0;i<t;i++){var c=z(a[_]-a[i])*s[i];o[_][i]=c*r[_]}else for(i=0;i<t;i++){var u=15+Math.min(21/a[i],12),f=V(u);for(_=0;_<t;_++){c=f*F(a[_]-a[i],u)*s[i];o[_][i]=c*r[_]}}for(_=0;_<t;_++){for(i=0;i<t&&!(o[_][i]>0);i++);for(e[_][0]=i,i=t-1;i>0&&!(o[_][i]>0);i--);e[_][1]=i,l+=e[_][1]-e[_][0]+1}var h=ne(l),m=0;for(_=0;_<t;_++)for(i=e[_][0];i<=e[_][1];i++)h[m++]=o[_][i];return h}function U(e){var t=X(e);return t=Math.min(t,15.5)/15.5,Math.pow(10,1.25*(1-Math.cos(Math.PI*t))-2.5)}function j(e,t){return e<-.3&&(e=3410),e/=1e3,e=Math.max(.1,e),3.64*Math.pow(e,-.8)-6.8*Math.exp(-.6*Math.pow(e-3.4,2))+6*Math.exp(-.15*Math.pow(e-8.7,2))+.001*(.6+.04*t)*Math.pow(e,4)}this.L3psycho_anal_vbr=function(e,t,a,s,n,i,o,l,_,c){var u=e.internal_flags,f=ne(ce.HBLKSIZE),h=ie([3,ce.HBLKSIZE_s]),m=ie([2,ce.BLKSIZE]),p=ie([2,3,ce.BLKSIZE_s]),d=ie([4,ce.CBANDS]),b=ie([4,ce.CBANDS]),g=ie([4,3]),w=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],A=oe(2),E=e.mode==MPEGMode.JOINT_STEREO?4:u.channels_out;!function(e,t,a,s,n,i,o,l,_,c){for(var u=ie([2,576]),f=e.internal_flags,h=f.channels_out,m=e.mode==MPEGMode.JOINT_STEREO?4:h,p=0;p<h;p++){firbuf=t[p];for(var d=a+576-350-r+192,b=0;b<576;b++){var g,v;g=firbuf[d+b+10],v=0;for(var S=0;S<9;S+=2)g+=L[S]*(firbuf[d+b+S]+firbuf[d+b+r-S]),v+=L[S+1]*(firbuf[d+b+S+1]+firbuf[d+b+r-S-1]);u[p][b]=g+v}n[s][p].en.assign(f.en[p]),n[s][p].thm.assign(f.thm[p]),m>2&&(i[s][p].en.assign(f.en[p+2]),i[s][p].thm.assign(f.thm[p+2]))}for(p=0;p<m;p++){var w=ne(12),M=ne(12),A=[0,0,0,0],R=u[1&p],E=0,y=3==p?f.nsPsy.attackthre_s:f.nsPsy.attackthre,k=1;if(2==p)for(b=0,S=576;S>0;++b,--S){var T=u[0][b],B=u[1][b];u[0][b]=T+B,u[1][b]=T-B}for(b=0;b<3;b++)M[b]=f.nsPsy.last_en_subshort[p][b+6],le(f.nsPsy.last_en_subshort[p][b+4]>0),w[b]=M[b]/f.nsPsy.last_en_subshort[p][b+4],A[0]+=M[b];for(b=0;b<9;b++){for(var x=E+64,P=1;E<x;E++)P<Math.abs(R[E])&&(P=Math.abs(R[E]));f.nsPsy.last_en_subshort[p][b]=M[b+3]=P,A[1+b/3]+=P,P>M[b+3-2]?(le(M[b+3-2]>0),P/=M[b+3-2]):P=M[b+3-2]>10*P?M[b+3-2]/(10*P):0,w[b+3]=P}for(b=0;b<3;++b){var I=M[3*b+3]+M[3*b+4]+M[3*b+5],C=1;6*M[3*b+5]<I&&(C*=.5,6*M[3*b+4]<I&&(C*=.5)),l[p][b]=C}if(e.analysis){var N=w[0];for(b=1;b<12;b++)N<w[b]&&(N=w[b]);f.pinfo.ers[s][p]=f.pinfo.ers_save[p],f.pinfo.ers_save[p]=N}for(b=0;b<12;b++)0==_[p][b/3]&&w[b]>y&&(_[p][b/3]=b%3+1);for(b=1;b<4;b++){var O=A[b-1],D=A[b];Math.max(O,D)<4e4&&O<1.7*D&&D<1.7*O&&(1==b&&_[p][0]<=_[p][b]&&(_[p][0]=0),_[p][b]=0)}_[p][0]<=f.nsPsy.lastAttacks[p]&&(_[p][0]=0),3!=f.nsPsy.lastAttacks[p]&&_[p][0]+_[p][1]+_[p][2]+_[p][3]==0||(k=0,0!=_[p][1]&&0!=_[p][0]&&(_[p][1]=0),0!=_[p][2]&&0!=_[p][1]&&(_[p][2]=0),0!=_[p][3]&&0!=_[p][2]&&(_[p][3]=0)),p<2?c[p]=k:0==k&&(c[0]=c[1]=0),o[p]=f.tot_ener[p]}}(e,t,a,s,n,i,_,g,w,A),function(e,t){var a=e.internal_flags;e.short_blocks!=ae.short_block_coupled||0!=t[0]&&0!=t[1]||(t[0]=t[1]=0);for(var s=0;s<a.channels_out;s++)e.short_blocks==ae.short_block_dispensed&&(t[s]=1),e.short_blocks==ae.short_block_forced&&(t[s]=0)}(e,A);for(var k=0;k<E;k++){x(e,t,a,k,s,f,m,B=1&k),I(e,s,k,f),0!=A[B]?D(u,f,d[k],b[k],k):N(u,k)}A[0]+A[1]==2&&e.mode==MPEGMode.JOINT_STEREO&&H(d,b,u.mld_cb_l,u.ATH.cb_l,e.ATHlower*u.ATH.adjust,e.msfix,u.npart_l);for(k=0;k<E;k++){0!=A[B=1&k]&&S(u,d[k],b[k],k)}for(var T=0;T<3;T++){for(k=0;k<E;++k){0!=A[B=1&k]?C(u,k,T):(P(e,t,a,k,T,h,p,B),O(e,h,d[k],b[k],k,T))}A[0]+A[1]==0&&e.mode==MPEGMode.JOINT_STEREO&&H(d,b,u.mld_cb_s,u.ATH.cb_s,e.ATHlower*u.ATH.adjust,e.msfix,u.npart_s);for(k=0;k<E;++k){0==A[B=1&k]&&v(u,d[k],b[k],k,T)}}for(k=0;k<E;k++){var B;if(0==A[B=1&k])for(var F=0;F<ce.SBMAX_s;F++){var V=ne(3);for(T=0;T<3;T++){var z=u.thm[k].s[F][T];if(z*=.8,w[k][T]>=2||1==w[k][T+1]){var X=0!=T?T-1:2,Y=M(u.thm[k].s[F][X],z,.36);z=Math.min(z,Y)}else if(1==w[k][T]){X=0!=T?T-1:2,Y=M(u.thm[k].s[F][X],z,.18);z=Math.min(z,Y)}else if(0!=T&&3==w[k][T-1]||0==T&&3==u.nsPsy.lastAttacks[k]){X=2!=T?T+1:0,Y=M(u.thm[k].s[F][X],z,.18);z=Math.min(z,Y)}z*=g[k][T],V[T]=z}for(T=0;T<3;T++)u.thm[k].s[F][T]=V[T]}}for(k=0;k<E;k++)u.nsPsy.lastAttacks[k]=w[k][2];!function(e,t,a){for(var s=e.internal_flags,r=0;r<s.channels_out;r++){var n=ce.NORM_TYPE;0!=t[r]?(le(s.blocktype_old[r]!=ce.START_TYPE),s.blocktype_old[r]==ce.SHORT_TYPE&&(n=ce.STOP_TYPE)):(n=ce.SHORT_TYPE,s.blocktype_old[r]==ce.NORM_TYPE&&(s.blocktype_old[r]=ce.START_TYPE),s.blocktype_old[r]==ce.STOP_TYPE&&(s.blocktype_old[r]=ce.SHORT_TYPE)),a[r]=s.blocktype_old[r],s.blocktype_old[r]=n}}(e,A,c);for(k=0;k<E;k++){var q,U,j,G;k>1?(q=l,U=-2,j=ce.NORM_TYPE,c[0]!=ce.SHORT_TYPE&&c[1]!=ce.SHORT_TYPE||(j=ce.SHORT_TYPE),G=i[s][k-2]):(q=o,U=0,j=c[k],G=n[s][k]),j==ce.SHORT_TYPE?q[U+k]=R(G,u.masking_lower):q[U+k]=y(G,u.masking_lower),e.analysis&&(u.pinfo.pe[s][k]=q[U+k])}return 0},this.psymodel_init=function(a){var s,r=a.internal_flags,n=!0,i=13,o=24,l=0,f=0,h=-8.25,m=-4.5,p=ne(ce.CBANDS),d=ne(ce.CBANDS),b=ne(ce.CBANDS),g=a.out_samplerate;switch(a.experimentalZ){default:case 0:n=!0;break;case 1:n=a.VBR!=ee.vbr_mtrh&&a.VBR!=ee.vbr_mt;break;case 2:n=!1;break;case 3:i=8,l=-1.75,f=-.0125,h=-8.25,m=-2.25}for(r.ms_ener_ratio_old=.25,r.blocktype_old[0]=r.blocktype_old[1]=ce.NORM_TYPE,s=0;s<4;++s){for(var v=0;v<ce.CBANDS;++v)r.nb_1[s][v]=1e20,r.nb_2[s][v]=1e20,r.nb_s1[s][v]=r.nb_s2[s][v]=1;for(var S=0;S<ce.SBMAX_l;S++)r.en[s].l[S]=1e20,r.thm[s].l[S]=1e20;for(v=0;v<3;++v){for(S=0;S<ce.SBMAX_s;S++)r.en[s].s[S][v]=1e20,r.thm[s].s[S][v]=1e20;r.nsPsy.lastAttacks[s]=0}for(v=0;v<9;v++)r.nsPsy.last_en_subshort[s][v]=10}for(r.loudness_sq_save[0]=r.loudness_sq_save[1]=0,r.npart_l=Y(r.numlines_l,r.bo_l,r.bm_l,p,d,r.mld_l,r.PSY.bo_l_weight,g,ce.BLKSIZE,r.scalefac_band.l,ce.BLKSIZE/1152,ce.SBMAX_l),le(r.npart_l<ce.CBANDS),s=0;s<r.npart_l;s++){var w=l;p[s]>=i&&(w=f*(p[s]-i)/(o-i)+l*(o-p[s])/(o-i)),b[s]=Math.pow(10,w/10),r.numlines_l[s]>0?r.rnumlines_l[s]=1/r.numlines_l[s]:r.rnumlines_l[s]=0}r.s3_ll=q(r.s3ind,r.npart_l,p,d,b,n);var M;v=0;for(s=0;s<r.npart_l;s++){E=te.MAX_VALUE;for(var A=0;A<r.numlines_l[s];A++,v++){var R=g*v/(1e3*ce.BLKSIZE);y=this.ATHformula(1e3*R,a)-20,y=Math.pow(10,.1*y),E>(y*=r.numlines_l[s])&&(E=y)}r.ATH.cb_l[s]=E,(E=20*p[s]/10-20)>6&&(E=100),E<-15&&(E=-15),E-=8,r.minval_l[s]=Math.pow(10,E/10)*r.numlines_l[s]}for(r.npart_s=Y(r.numlines_s,r.bo_s,r.bm_s,p,d,r.mld_s,r.PSY.bo_s_weight,g,ce.BLKSIZE_s,r.scalefac_band.s,ce.BLKSIZE_s/384,ce.SBMAX_s),le(r.npart_s<ce.CBANDS),v=0,s=0;s<r.npart_s;s++){var E;w=h;p[s]>=i&&(w=m*(p[s]-i)/(o-i)+h*(o-p[s])/(o-i)),b[s]=Math.pow(10,w/10),E=te.MAX_VALUE;for(A=0;A<r.numlines_s[s];A++,v++){var y;R=g*v/(1e3*ce.BLKSIZE_s);y=this.ATHformula(1e3*R,a)-20,y=Math.pow(10,.1*y),E>(y*=r.numlines_s[s])&&(E=y)}r.ATH.cb_s[s]=E,E=7*p[s]/12-7,p[s]>12&&(E*=1+3.1*Math.log(1+E)),p[s]<12&&(E*=1+2.3*Math.log(1-E)),E<-15&&(E=-15),E-=8,r.minval_s[s]=Math.pow(10,E/10)*r.numlines_s[s]}r.s3_ss=q(r.s3ind_s,r.npart_s,p,d,b,n),_=Math.pow(10,9/16),c=Math.pow(10,1.5),u=Math.pow(10,1.5),e.init_fft(r),r.decay=Math.exp(-1*t/(.01*g/192)),M=3.5,2&a.exp_nspsytune&&(M=1),Math.abs(a.msfix)>0&&(M=a.msfix),a.msfix=M;for(var k=0;k<r.npart_l;k++)r.s3ind[k][1]>r.npart_l-1&&(r.s3ind[k][1]=r.npart_l-1);var T=576*r.mode_gr/g;if(r.ATH.decay=Math.pow(10,-1.2*T),r.ATH.adjust=.01,r.ATH.adjustLimit=1,le(r.bo_l[ce.SBMAX_l-1]<=r.npart_l),le(r.bo_s[ce.SBMAX_s-1]<=r.npart_s),-1!=a.ATHtype){var B=a.out_samplerate/ce.BLKSIZE,x=0;for(R=0,s=0;s<ce.BLKSIZE/2;++s)R+=B,r.ATH.eql_w[s]=1/Math.pow(10,this.ATHformula(R,a)/10),x+=r.ATH.eql_w[s];for(x=1/x,s=ce.BLKSIZE/2;--s>=0;)r.ATH.eql_w[s]*=x}for(k=v=0;k<r.npart_s;++k)for(s=0;s<r.numlines_s[k];++s)++v;for(k=v=0;k<r.npart_l;++k)for(s=0;s<r.numlines_l[k];++s)++v;for(v=0,s=0;s<r.npart_l;s++){R=g*(v+r.numlines_l[s]/2)/(1*ce.BLKSIZE);r.mld_cb_l[s]=U(R),v+=r.numlines_l[s]}for(;s<ce.CBANDS;++s)r.mld_cb_l[s]=1;for(v=0,s=0;s<r.npart_s;s++){R=g*(v+r.numlines_s[s]/2)/(1*ce.BLKSIZE_s);r.mld_cb_s[s]=U(R),v+=r.numlines_s[s]}for(;s<ce.CBANDS;++s)r.mld_cb_s[s]=1;return 0},this.ATHformula=function(e,t){var a;switch(t.ATHtype){case 0:a=j(e,9);break;case 1:a=j(e,-1);break;case 2:default:a=j(e,0);break;case 3:a=j(e,1)+6;break;case 4:a=j(e,t.ATHcurve)}return a}};function fe(e){var t=e;this.ordinal=function(){return t}}fe.STEREO=new fe(0),fe.JOINT_STEREO=new fe(1),fe.DUAL_CHANNEL=new fe(2),fe.MONO=new fe(3),fe.NOT_SET=new fe(4);var he=fe,me=he;var pe=function(){this.class_id=0,this.num_samples=0,this.num_channels=0,this.in_samplerate=0,this.out_samplerate=0,this.scale=0,this.scale_left=0,this.scale_right=0,this.analysis=!1,this.bWriteVbrTag=!1,this.decode_only=!1,this.quality=0,this.mode=me.STEREO,this.force_ms=!1,this.free_format=!1,this.findReplayGain=!1,this.decode_on_the_fly=!1,this.write_id3tag_automatic=!1,this.brate=0,this.compression_ratio=0,this.copyright=0,this.original=0,this.extension=0,this.emphasis=0,this.error_protection=0,this.strict_ISO=!1,this.disable_reservoir=!1,this.quant_comp=0,this.quant_comp_short=0,this.experimentalY=!1,this.experimentalZ=0,this.exp_nspsytune=0,this.preset=0,this.VBR=null,this.VBR_q_frac=0,this.VBR_q=0,this.VBR_mean_bitrate_kbps=0,this.VBR_min_bitrate_kbps=0,this.VBR_max_bitrate_kbps=0,this.VBR_hard_min=0,this.lowpassfreq=0,this.highpassfreq=0,this.lowpasswidth=0,this.highpasswidth=0,this.maskingadjust=0,this.maskingadjust_short=0,this.ATHonly=!1,this.ATHshort=!1,this.noATH=!1,this.ATHtype=0,this.ATHcurve=0,this.ATHlower=0,this.athaa_type=0,this.athaa_loudapprox=0,this.athaa_sensitivity=0,this.short_blocks=null,this.useTemporal=!1,this.interChRatio=0,this.msfix=0,this.tune=!1,this.tune_value_a=0,this.version=0,this.encoder_delay=0,this.encoder_padding=0,this.framesize=0,this.frameNum=0,this.lame_allocated_gfp=0,this.internal_flags=null},de=Z(),be={};be.SFBMAX=3*de.SBMAX_s;var ge=be,ve=W.new_float,Se=W.new_int,we=ge;var Me=function(){this.xr=ve(576),this.l3_enc=Se(576),this.scalefac=Se(we.SFBMAX),this.xrpow_max=0,this.part2_3_length=0,this.big_values=0,this.count1=0,this.global_gain=0,this.scalefac_compress=0,this.block_type=0,this.mixed_block_flag=0,this.table_select=Se(3),this.subblock_gain=Se(4),this.region0_count=0,this.region1_count=0,this.preflag=0,this.scalefac_scale=0,this.count1table_select=0,this.part2_length=0,this.sfb_lmax=0,this.sfb_smin=0,this.psy_lmax=0,this.sfbmax=0,this.psymax=0,this.sfbdivide=0,this.width=Se(we.SFBMAX),this.window=Se(we.SFBMAX),this.count1bits=0,this.sfb_partition_table=null,this.slen=Se(4),this.max_nonzero_coeff=0;var e=this;function t(e){return new Int32Array(e)}this.assign=function(a){var s;e.xr=(s=a.xr,new Float32Array(s)),e.l3_enc=t(a.l3_enc),e.scalefac=t(a.scalefac),e.xrpow_max=a.xrpow_max,e.part2_3_length=a.part2_3_length,e.big_values=a.big_values,e.count1=a.count1,e.global_gain=a.global_gain,e.scalefac_compress=a.scalefac_compress,e.block_type=a.block_type,e.mixed_block_flag=a.mixed_block_flag,e.table_select=t(a.table_select),e.subblock_gain=t(a.subblock_gain),e.region0_count=a.region0_count,e.region1_count=a.region1_count,e.preflag=a.preflag,e.scalefac_scale=a.scalefac_scale,e.count1table_select=a.count1table_select,e.part2_length=a.part2_length,e.sfb_lmax=a.sfb_lmax,e.sfb_smin=a.sfb_smin,e.psy_lmax=a.psy_lmax,e.sfbmax=a.sfbmax,e.psymax=a.psymax,e.sfbdivide=a.sfbdivide,e.width=t(a.width),e.window=t(a.window),e.count1bits=a.count1bits,e.sfb_partition_table=a.sfb_partition_table.slice(0),e.slen=t(a.slen),e.max_nonzero_coeff=a.max_nonzero_coeff}},Ae=W.new_int,Re=Me;var Ee=function(){this.tt=[[null,null],[null,null]],this.main_data_begin=0,this.private_bits=0,this.resvDrain_pre=0,this.resvDrain_post=0,this.scfsi=[Ae(4),Ae(4)];for(var e=0;e<2;e++)for(var t=0;t<2;t++)this.tt[e][t]=new Re},ye=W.System,ke=W.new_int,Te=Z();var Be=function(e,t,a,s){this.l=ke(1+Te.SBMAX_l),this.s=ke(1+Te.SBMAX_s),this.psfb21=ke(1+Te.PSFB21),this.psfb12=ke(1+Te.PSFB12);var r=this.l,n=this.s;4==arguments.length&&(this.arrL=arguments[0],this.arrS=arguments[1],this.arr21=arguments[2],this.arr12=arguments[3],ye.arraycopy(this.arrL,0,r,0,Math.min(this.arrL.length,this.l.length)),ye.arraycopy(this.arrS,0,n,0,Math.min(this.arrS.length,this.s.length)),ye.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length)),ye.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length)))},xe=W.new_float,Pe=W.new_float_n,Ie=W.new_int,Le=Z();var Ce=W.new_byte,Ne=W.new_double,Oe=W.new_float,De=W.new_float_n,He=W.new_int,Fe=W.new_int_n,Ve=Ee,ze=Be,Xe=function(){this.last_en_subshort=Pe([4,9]),this.lastAttacks=Ie(4),this.pefirbuf=xe(19),this.longfact=xe(Le.SBMAX_l),this.shortfact=xe(Le.SBMAX_s),this.attackthre=0,this.attackthre_s=0},Ye=function(){this.sum=0,this.seen=0,this.want=0,this.pos=0,this.size=0,this.bag=null,this.nVbrNumFrames=0,this.nBytesWritten=0,this.TotalFrameSize=0},qe=K(),Ue=Z(),je=ge;function Ge(){function e(){this.write_timing=0,this.ptr=0,this.buf=Ce(40)}this.Class_ID=0,this.lame_encode_frame_init=0,this.iteration_init_init=0,this.fill_buffer_resample_init=0,this.mfbuf=De([2,Ge.MFSIZE]),this.mode_gr=0,this.channels_in=0,this.channels_out=0,this.resample_ratio=0,this.mf_samples_to_encode=0,this.mf_size=0,this.VBR_min_bitrate=0,this.VBR_max_bitrate=0,this.bitrate_index=0,this.samplerate_index=0,this.mode_ext=0,this.lowpass1=0,this.lowpass2=0,this.highpass1=0,this.highpass2=0,this.noise_shaping=0,this.noise_shaping_amp=0,this.substep_shaping=0,this.psymodel=0,this.noise_shaping_stop=0,this.subblock_gain=0,this.use_best_huffman=0,this.full_outer_loop=0,this.l3_side=new Ve,this.ms_ratio=Oe(2),this.padding=0,this.frac_SpF=0,this.slot_lag=0,this.tag_spec=null,this.nMusicCRC=0,this.OldValue=He(2),this.CurrentStep=He(2),this.masking_lower=0,this.bv_scf=He(576),this.pseudohalf=He(je.SFBMAX),this.sfb21_extra=!1,this.inbuf_old=new Array(2),this.blackfilt=new Array(2*Ge.BPC+1),this.itime=Ne(2),this.sideinfo_len=0,this.sb_sample=De([2,2,18,Ue.SBLIMIT]),this.amp_filter=Oe(32),this.header=new Array(Ge.MAX_HEADER_BUF),this.h_ptr=0,this.w_ptr=0,this.ancillary_flag=0,this.ResvSize=0,this.ResvMax=0,this.scalefac_band=new ze,this.minval_l=Oe(Ue.CBANDS),this.minval_s=Oe(Ue.CBANDS),this.nb_1=De([4,Ue.CBANDS]),this.nb_2=De([4,Ue.CBANDS]),this.nb_s1=De([4,Ue.CBANDS]),this.nb_s2=De([4,Ue.CBANDS]),this.s3_ss=null,this.s3_ll=null,this.decay=0,this.thm=new Array(4),this.en=new Array(4),this.tot_ener=Oe(4),this.loudness_sq=De([2,2]),this.loudness_sq_save=Oe(2),this.mld_l=Oe(Ue.SBMAX_l),this.mld_s=Oe(Ue.SBMAX_s),this.bm_l=He(Ue.SBMAX_l),this.bo_l=He(Ue.SBMAX_l),this.bm_s=He(Ue.SBMAX_s),this.bo_s=He(Ue.SBMAX_s),this.npart_l=0,this.npart_s=0,this.s3ind=Fe([Ue.CBANDS,2]),this.s3ind_s=Fe([Ue.CBANDS,2]),this.numlines_s=He(Ue.CBANDS),this.numlines_l=He(Ue.CBANDS),this.rnumlines_l=Oe(Ue.CBANDS),this.mld_cb_l=Oe(Ue.CBANDS),this.mld_cb_s=Oe(Ue.CBANDS),this.numlines_s_num1=0,this.numlines_l_num1=0,this.pe=Oe(4),this.ms_ratio_s_old=0,this.ms_ratio_l_old=0,this.ms_ener_ratio_old=0,this.blocktype_old=He(2),this.nsPsy=new Xe,this.VBR_seek_table=new Ye,this.ATH=null,this.PSY=null,this.nogap_total=0,this.nogap_current=0,this.decode_on_the_fly=!0,this.findReplayGain=!0,this.findPeakSample=!0,this.PeakSample=0,this.RadioGain=0,this.AudiophileGain=0,this.rgdata=null,this.noclipGainChange=0,this.noclipScale=0,this.bitrate_stereoMode_Hist=Fe([16,5]),this.bitrate_blockType_Hist=Fe([16,6]),this.pinfo=null,this.hip=null,this.in_buffer_nsamples=0,this.in_buffer_0=null,this.in_buffer_1=null,this.iteration_loop=null;for(var t=0;t<this.en.length;t++)this.en[t]=new qe;for(t=0;t<this.thm.length;t++)this.thm[t]=new qe;for(t=0;t<this.header.length;t++)this.header[t]=new e}Ge.MFSIZE=3456+Ue.ENCDELAY-Ue.MDCTDELAY,Ge.MAX_HEADER_BUF=256,Ge.MAX_BITS_PER_CHANNEL=4095,Ge.MAX_BITS_PER_GRANULE=7680,Ge.BPC=320;var We=Ge,Ke=W.new_float,Ze=Z();var $e=function(){this.useAdjust=0,this.aaSensitivityP=0,this.adjust=0,this.adjustLimit=0,this.decay=0,this.floor=0,this.l=Ke(Ze.SBMAX_l),this.s=Ke(Ze.SBMAX_s),this.psfb21=Ke(Ze.PSFB21),this.psfb12=Ke(Ze.PSFB12),this.cb_l=Ke(Ze.CBANDS),this.cb_s=Ke(Ze.CBANDS),this.eql_w=Ke(Ze.BLKSIZE/2)},Qe=W.System,Je=W.Arrays;function et(){var e=et.RMS_WINDOW_TIME_NUMERATOR,t=et.RMS_WINDOW_TIME_DENOMINATOR,a=[[.038575994352,-3.84664617118067,-.02160367184185,7.81501653005538,-.00123395316851,-11.34170355132042,-9291677959e-14,13.05504219327545,-.01655260341619,-12.28759895145294,.02161526843274,9.4829380631979,-.02074045215285,-5.87257861775999,.00594298065125,2.75465861874613,.00306428023191,-.86984376593551,.00012025322027,.13919314567432,.00288463683916],[.0541865640643,-3.47845948550071,-.02911007808948,6.36317777566148,-.00848709379851,-8.54751527471874,-.00851165645469,9.4769360780128,-.00834990904936,-8.81498681370155,.02245293253339,6.85401540936998,-.02596338512915,-4.39470996079559,.01624864962975,2.19611684890774,-.00240879051584,-.75104302451432,.00674613682247,.13149317958808,-.00187763777362],[.15457299681924,-2.37898834973084,-.09331049056315,2.84868151156327,-.06247880153653,-2.64577170229825,.02163541888798,2.23697657451713,-.05588393329856,-1.67148153367602,.04781476674921,1.00595954808547,.00222312597743,-.45953458054983,.03174092540049,.16378164858596,-.01390589421898,-.05032077717131,.00651420667831,.0234789740702,-.00881362733839],[.30296907319327,-1.61273165137247,-.22613988682123,1.0797749225997,-.08587323730772,-.2565625775407,.03282930172664,-.1627671912044,-.00915702933434,-.22638893773906,-.02364141202522,.39120800788284,-.00584456039913,-.22138138954925,.06276101321749,.04500235387352,-828086748e-14,.02005851806501,.00205861885564,.00302439095741,-.02950134983287],[.33642304856132,-1.49858979367799,-.2557224142557,.87350271418188,-.11828570177555,.12205022308084,.11921148675203,-.80774944671438,-.07834489609479,.47854794562326,-.0046997791438,-.12453458140019,-.0058950022444,-.04067510197014,.05724228140351,.08333755284107,.00832043980773,-.04237348025746,-.0163538138454,.02977207319925,-.0176017656815],[.4491525660845,-.62820619233671,-.14351757464547,.29661783706366,-.22784394429749,-.372563729424,-.01419140100551,.00213767857124,.04078262797139,-.42029820170918,-.12398163381748,.22199650564824,.04097565135648,.00613424350682,.10478503600251,.06747620744683,-.01863887810927,.05784820375801,-.03193428438915,.03222754072173,.00541907748707],[.56619470757641,-1.04800335126349,-.75464456939302,.29156311971249,.1624213774223,-.26806001042947,.16744243493672,.00819999645858,-.18901604199609,.45054734505008,.3093178284183,-.33032403314006,-.27562961986224,.0673936833311,.00647310677246,-.04784254229033,.08647503780351,.01639907836189,-.0378898455484,.01807364323573,-.00588215443421],[.58100494960553,-.51035327095184,-.53174909058578,-.31863563325245,-.14289799034253,-.20256413484477,.17520704835522,.1472815413433,.02377945217615,.38952639978999,.15558449135573,-.23313271880868,-.25344790059353,-.05246019024463,.01628462406333,-.02505961724053,.06920467763959,.02442357316099,-.03721611395801,.01818801111503,-.00749618797172],[.53648789255105,-.2504987195602,-.42163034350696,-.43193942311114,-.00275953611929,-.03424681017675,.04267842219415,-.04678328784242,-.10214864179676,.26408300200955,.14590772289388,.15113130533216,-.02459864859345,-.17556493366449,-.11202315195388,-.18823009262115,-.04060034127,.05477720428674,.0478866554818,.0470440968812,-.02217936801134]],s=[[.98621192462708,-1.97223372919527,-1.97242384925416,.97261396931306,.98621192462708],[.98500175787242,-1.96977855582618,-1.97000351574484,.9702284756635,.98500175787242],[.97938932735214,-1.95835380975398,-1.95877865470428,.95920349965459,.97938932735214],[.97531843204928,-1.95002759149878,-1.95063686409857,.95124613669835,.97531843204928],[.97316523498161,-1.94561023566527,-1.94633046996323,.94705070426118,.97316523498161],[.96454515552826,-1.92783286977036,-1.92909031105652,.93034775234268,.96454515552826],[.96009142950541,-1.91858953033784,-1.92018285901082,.92177618768381,.96009142950541],[.95856916599601,-1.9154210807478,-1.91713833199203,.91885558323625,.95856916599601],[.94597685600279,-1.88903307939452,-1.89195371200558,.89487434461664,.94597685600279]];function r(e,t,a,s,r,n){for(;0!=r--;)a[s]=1e-10+e[t+0]*n[0]-a[s-1]*n[1]+e[t-1]*n[2]-a[s-2]*n[3]+e[t-2]*n[4]-a[s-3]*n[5]+e[t-3]*n[6]-a[s-4]*n[7]+e[t-4]*n[8]-a[s-5]*n[9]+e[t-5]*n[10]-a[s-6]*n[11]+e[t-6]*n[12]-a[s-7]*n[13]+e[t-7]*n[14]-a[s-8]*n[15]+e[t-8]*n[16]-a[s-9]*n[17]+e[t-9]*n[18]-a[s-10]*n[19]+e[t-10]*n[20],++s,++t}function n(e,t,a,s,r,n){for(;0!=r--;)a[s]=e[t+0]*n[0]-a[s-1]*n[1]+e[t-1]*n[2]-a[s-2]*n[3]+e[t-2]*n[4],++s,++t}function i(e){return e*e}this.InitGainAnalysis=function(a,s){return function(a,s){for(var r=0;r<MAX_ORDER;r++)a.linprebuf[r]=a.lstepbuf[r]=a.loutbuf[r]=a.rinprebuf[r]=a.rstepbuf[r]=a.routbuf[r]=0;switch(0|s){case 48e3:a.reqindex=0;break;case 44100:a.reqindex=1;break;case 32e3:a.reqindex=2;break;case 24e3:a.reqindex=3;break;case 22050:a.reqindex=4;break;case 16e3:a.reqindex=5;break;case 12e3:a.reqindex=6;break;case 11025:a.reqindex=7;break;case 8e3:a.reqindex=8;break;default:return INIT_GAIN_ANALYSIS_ERROR}return a.sampleWindow=0|(s*e+t-1)/t,a.lsum=0,a.rsum=0,a.totsamp=0,Je.ill(a.A,0),INIT_GAIN_ANALYSIS_OK}(a,s)!=INIT_GAIN_ANALYSIS_OK?INIT_GAIN_ANALYSIS_ERROR:(a.linpre=MAX_ORDER,a.rinpre=MAX_ORDER,a.lstep=MAX_ORDER,a.rstep=MAX_ORDER,a.lout=MAX_ORDER,a.rout=MAX_ORDER,Je.fill(a.B,0),INIT_GAIN_ANALYSIS_OK)},this.AnalyzeSamples=function(e,t,o,l,_,c,u){var f,h,m,p,d,b,g;if(0==c)return GAIN_ANALYSIS_OK;switch(g=0,d=c,u){case 1:l=t,_=o;break;case 2:break;default:return GAIN_ANALYSIS_ERROR}for(c<MAX_ORDER?(Qe.arraycopy(t,o,e.linprebuf,MAX_ORDER,c),Qe.arraycopy(l,_,e.rinprebuf,MAX_ORDER,c)):(Qe.arraycopy(t,o,e.linprebuf,MAX_ORDER,MAX_ORDER),Qe.arraycopy(l,_,e.rinprebuf,MAX_ORDER,MAX_ORDER));d>0;){b=d>e.sampleWindow-e.totsamp?e.sampleWindow-e.totsamp:d,g<MAX_ORDER?(f=e.linpre+g,h=e.linprebuf,m=e.rinpre+g,p=e.rinprebuf,b>MAX_ORDER-g&&(b=MAX_ORDER-g)):(f=o+g,h=t,m=_+g,p=l),r(h,f,e.lstepbuf,e.lstep+e.totsamp,b,a[e.reqindex]),r(p,m,e.rstepbuf,e.rstep+e.totsamp,b,a[e.reqindex]),n(e.lstepbuf,e.lstep+e.totsamp,e.loutbuf,e.lout+e.totsamp,b,s[e.reqindex]),n(e.rstepbuf,e.rstep+e.totsamp,e.routbuf,e.rout+e.totsamp,b,s[e.reqindex]),f=e.lout+e.totsamp,h=e.loutbuf,m=e.rout+e.totsamp,p=e.routbuf;for(var v=b%8;0!=v--;)e.lsum+=i(h[f++]),e.rsum+=i(p[m++]);for(v=b/8;0!=v--;)e.lsum+=i(h[f+0])+i(h[f+1])+i(h[f+2])+i(h[f+3])+i(h[f+4])+i(h[f+5])+i(h[f+6])+i(h[f+7]),f+=8,e.rsum+=i(p[m+0])+i(p[m+1])+i(p[m+2])+i(p[m+3])+i(p[m+4])+i(p[m+5])+i(p[m+6])+i(p[m+7]),m+=8;if(d-=b,g+=b,e.totsamp+=b,e.totsamp==e.sampleWindow){var S=10*et.STEPS_per_dB*Math.log10((e.lsum+e.rsum)/e.totsamp*.5+1e-37),w=S<=0?0:0|S;w>=e.A.length&&(w=e.A.length-1),e.A[w]++,e.lsum=e.rsum=0,Qe.arraycopy(e.loutbuf,e.totsamp,e.loutbuf,0,MAX_ORDER),Qe.arraycopy(e.routbuf,e.totsamp,e.routbuf,0,MAX_ORDER),Qe.arraycopy(e.lstepbuf,e.totsamp,e.lstepbuf,0,MAX_ORDER),Qe.arraycopy(e.rstepbuf,e.totsamp,e.rstepbuf,0,MAX_ORDER),e.totsamp=0}if(e.totsamp>e.sampleWindow)return GAIN_ANALYSIS_ERROR}return c<MAX_ORDER?(Qe.arraycopy(e.linprebuf,c,e.linprebuf,0,MAX_ORDER-c),Qe.arraycopy(e.rinprebuf,c,e.rinprebuf,0,MAX_ORDER-c),Qe.arraycopy(t,o,e.linprebuf,MAX_ORDER-c,c),Qe.arraycopy(l,_,e.rinprebuf,MAX_ORDER-c,c)):(Qe.arraycopy(t,o+c-MAX_ORDER,e.linprebuf,0,MAX_ORDER),Qe.arraycopy(l,_+c-MAX_ORDER,e.rinprebuf,0,MAX_ORDER)),GAIN_ANALYSIS_OK},this.GetTitleGain=function(e){for(var t=function(e,t){var a,s=0;for(a=0;a<t;a++)s+=e[a];if(0==s)return GAIN_NOT_ENOUGH_SAMPLES;var r=0|Math.ceil(s*(1-.95));for(a=t;a-- >0&&!((r-=e[a])<=0););return 64.82-a/et.STEPS_per_dB}(e.A,e.A.length),a=0;a<e.A.length;a++)e.B[a]+=e.A[a],e.A[a]=0;for(a=0;a<MAX_ORDER;a++)e.linprebuf[a]=e.lstepbuf[a]=e.loutbuf[a]=e.rinprebuf[a]=e.rstepbuf[a]=e.routbuf[a]=0;return e.totsamp=0,e.lsum=e.rsum=0,t}}et.STEPS_per_dB=100,et.MAX_dB=120,et.GAIN_NOT_ENOUGH_SAMPLES=-24601,et.GAIN_ANALYSIS_ERROR=0,et.GAIN_ANALYSIS_OK=1,et.INIT_GAIN_ANALYSIS_ERROR=0,et.INIT_GAIN_ANALYSIS_OK=1,et.YULE_ORDER=10,et.MAX_ORDER=et.YULE_ORDER,et.MAX_SAMP_FREQ=48e3,et.RMS_WINDOW_TIME_NUMERATOR=1,et.RMS_WINDOW_TIME_DENOMINATOR=20,et.MAX_SAMPLES_PER_WINDOW=et.MAX_SAMP_FREQ*et.RMS_WINDOW_TIME_NUMERATOR/et.RMS_WINDOW_TIME_DENOMINATOR+1;var tt=et,at=W.new_float,st=W.new_int,rt=tt;var nt=function(){this.linprebuf=at(2*rt.MAX_ORDER),this.linpre=0,this.lstepbuf=at(rt.MAX_SAMPLES_PER_WINDOW+rt.MAX_ORDER),this.lstep=0,this.loutbuf=at(rt.MAX_SAMPLES_PER_WINDOW+rt.MAX_ORDER),this.lout=0,this.rinprebuf=at(2*rt.MAX_ORDER),this.rinpre=0,this.rstepbuf=at(rt.MAX_SAMPLES_PER_WINDOW+rt.MAX_ORDER),this.rstep=0,this.routbuf=at(rt.MAX_SAMPLES_PER_WINDOW+rt.MAX_ORDER),this.rout=0,this.sampleWindow=0,this.totsamp=0,this.lsum=0,this.rsum=0,this.freqindex=0,this.first=0,this.A=st(0|rt.STEPS_per_dB*rt.MAX_dB),this.B=st(0|rt.STEPS_per_dB*rt.MAX_dB)};var it=function(e){this.bits=e},ot=W.new_float,lt=W.new_int,_t=W.assert,ct=it,ut=Z(),ft=ge,ht=We;var mt=function(e){var t=e;this.quantize=t,this.iteration_loop=function(e,t,a,s){var r,n=e.internal_flags,i=ot(ft.SFBMAX),o=ot(576),l=lt(2),_=0,c=n.l3_side,u=new ct(_);this.quantize.rv.ResvFrameBegin(e,u),_=u.bits;for(var f=0;f<n.mode_gr;f++){r=this.quantize.qupvt.on_pe(e,t,l,_,f,f),n.mode_ext==ut.MPG_MD_MS_LR&&(this.quantize.ms_convert(n.l3_side,f),this.quantize.qupvt.reduce_side(l,a[f],_,r));for(var h=0;h<n.channels_out;h++){var m,p,d=c.tt[f][h];d.block_type!=ut.SHORT_TYPE?(m=0,p=n.PSY.mask_adjust-m):(m=0,p=n.PSY.mask_adjust_short-m),n.masking_lower=Math.pow(10,.1*p),this.quantize.init_outer_loop(n,d),this.quantize.init_xrpow(n,d,o)&&(this.quantize.qupvt.calc_xmin(e,s[f][h],d,i),this.quantize.outer_loop(e,d,i,o,h,l[h])),this.quantize.iteration_finish_one(n,f,h),_t(d.part2_3_length<=ht.MAX_BITS_PER_CHANNEL),_t(d.part2_3_length<=l[h])}}this.quantize.rv.ResvFrameEnd(n,_)}};function pt(e,t,a,s){this.xlen=e,this.linmax=t,this.table=a,this.hlen=s}var dt={t1HB:[1,1,1,0],t2HB:[1,2,1,3,1,1,3,2,0],t3HB:[3,2,1,1,1,1,3,2,0],t5HB:[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0],t6HB:[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0],t7HB:[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0],t8HB:[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0],t9HB:[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0],t10HB:[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0],t11HB:[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0],t12HB:[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0],t13HB:[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1],t15HB:[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0],t16HB:[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3],t24HB:[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3],t32HB:[1,10,8,20,12,20,16,32,14,12,24,0,28,16,24,16],t33HB:[15,28,26,48,22,40,36,64,14,24,20,32,12,16,8,0],t1l:[1,4,3,5],t2l:[1,4,7,4,5,7,6,7,8],t3l:[2,3,7,4,4,7,6,7,8],t5l:[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10],t6l:[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9],t7l:[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12],t8l:[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13],t9l:[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11],t10l:[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13],t11l:[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12],t12l:[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12],t13l:[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18],t15l:[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15],t16_5l:[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12],t16l:[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10],t24l:[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6],t32l:[1,5,5,7,5,8,7,9,5,7,7,9,7,9,9,10],t33l:[4,5,5,6,5,6,6,7,5,6,6,7,6,7,7,8]};dt.ht=[new pt(0,0,null,null),new pt(2,0,dt.t1HB,dt.t1l),new pt(3,0,dt.t2HB,dt.t2l),new pt(3,0,dt.t3HB,dt.t3l),new pt(0,0,null,null),new pt(4,0,dt.t5HB,dt.t5l),new pt(4,0,dt.t6HB,dt.t6l),new pt(6,0,dt.t7HB,dt.t7l),new pt(6,0,dt.t8HB,dt.t8l),new pt(6,0,dt.t9HB,dt.t9l),new pt(8,0,dt.t10HB,dt.t10l),new pt(8,0,dt.t11HB,dt.t11l),new pt(8,0,dt.t12HB,dt.t12l),new pt(16,0,dt.t13HB,dt.t13l),new pt(0,0,null,dt.t16_5l),new pt(16,0,dt.t15HB,dt.t15l),new pt(1,1,dt.t16HB,dt.t16l),new pt(2,3,dt.t16HB,dt.t16l),new pt(3,7,dt.t16HB,dt.t16l),new pt(4,15,dt.t16HB,dt.t16l),new pt(6,63,dt.t16HB,dt.t16l),new pt(8,255,dt.t16HB,dt.t16l),new pt(10,1023,dt.t16HB,dt.t16l),new pt(13,8191,dt.t16HB,dt.t16l),new pt(4,15,dt.t24HB,dt.t24l),new pt(5,31,dt.t24HB,dt.t24l),new pt(6,63,dt.t24HB,dt.t24l),new pt(7,127,dt.t24HB,dt.t24l),new pt(8,255,dt.t24HB,dt.t24l),new pt(9,511,dt.t24HB,dt.t24l),new pt(11,2047,dt.t24HB,dt.t24l),new pt(13,8191,dt.t24HB,dt.t24l),new pt(0,0,dt.t32HB,dt.t32l),new pt(0,0,dt.t33HB,dt.t33l)],dt.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366],dt.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296],dt.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369],dt.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]],dt.samplerate_table=[[22050,24e3,16e3,-1],[44100,48e3,32e3,-1],[11025,12e3,8e3,-1]],dt.scfsi_band=[0,6,11,16,21];var bt=dt,gt=Be,vt=W.VbrMode,St=W.Float,wt=W.Util,Mt=W.new_float,At=W.new_int,Rt=W.assert,Et=Z(),yt=it,kt=We;function Tt(){var e=null,t=null,a=null;function s(e){return _[e+Tt.Q_MAX2]}this.setModules=function(s,r,n){e=s,t=r,a=n},this.IPOW20=function(e){return c[e]};var r=2220446049250313e-31,n=Tt.IXMAX_VAL+2,i=Tt.Q_MAX,o=Tt.Q_MAX2;this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var l=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=l,this.sfBandIndex=[new gt([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new gt([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new gt([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new gt([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new gt([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new gt([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new gt([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new gt([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new gt([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0,8,16,24,36,52,72,96,124,160,162,164,166,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var _=Mt(i+o+1),c=Mt(i),u=Mt(n),f=Mt(n);function h(e,t){var s=a.ATHformula(t,e);return s-=100,s=Math.pow(10,s/10+e.ATHlower)}function m(e){this.s=e}this.adj43=f,this.iteration_init=function(t){var a,s=t.internal_flags,r=s.l3_side;if(0==s.iteration_init_init){for(s.iteration_init_init=1,r.main_data_begin=0,function(e){for(var t=e.internal_flags.ATH.l,a=e.internal_flags.ATH.psfb21,s=e.internal_flags.ATH.s,r=e.internal_flags.ATH.psfb12,n=e.internal_flags,i=e.out_samplerate,o=0;o<Et.SBMAX_l;o++){var l=n.scalefac_band.l[o],_=n.scalefac_band.l[o+1];t[o]=St.MAX_VALUE;for(var c=l;c<_;c++){var u=h(e,c*i/1152);t[o]=Math.min(t[o],u)}}for(o=0;o<Et.PSFB21;o++)for(l=n.scalefac_band.psfb21[o],_=n.scalefac_band.psfb21[o+1],a[o]=St.MAX_VALUE,c=l;c<_;c++)u=h(e,c*i/1152),a[o]=Math.min(a[o],u);for(o=0;o<Et.SBMAX_s;o++){for(l=n.scalefac_band.s[o],_=n.scalefac_band.s[o+1],s[o]=St.MAX_VALUE,c=l;c<_;c++)u=h(e,c*i/384),s[o]=Math.min(s[o],u);s[o]*=n.scalefac_band.s[o+1]-n.scalefac_band.s[o]}for(o=0;o<Et.PSFB12;o++){for(l=n.scalefac_band.psfb12[o],_=n.scalefac_band.psfb12[o+1],r[o]=St.MAX_VALUE,c=l;c<_;c++)u=h(e,c*i/384),r[o]=Math.min(r[o],u);r[o]*=n.scalefac_band.s[13]-n.scalefac_band.s[12]}if(e.noATH){for(o=0;o<Et.SBMAX_l;o++)t[o]=1e-20;for(o=0;o<Et.PSFB21;o++)a[o]=1e-20;for(o=0;o<Et.SBMAX_s;o++)s[o]=1e-20;for(o=0;o<Et.PSFB12;o++)r[o]=1e-20}n.ATH.floor=10*Math.log10(h(e,-1))}(t),u[0]=0,a=1;a<n;a++)u[a]=Math.pow(a,4/3);for(a=0;a<n-1;a++)f[a]=a+1-Math.pow(.5*(u[a]+u[a+1]),.75);for(f[a]=.5,a=0;a<i;a++)c[a]=Math.pow(2,-.1875*(a-210));for(a=0;a<=i+o;a++)_[a]=Math.pow(2,.25*(a-210-o));var l,m,p,d;for(e.huffman_init(s),(a=t.exp_nspsytune>>2&63)>=32&&(a-=64),l=Math.pow(10,a/4/10),(a=t.exp_nspsytune>>8&63)>=32&&(a-=64),m=Math.pow(10,a/4/10),(a=t.exp_nspsytune>>14&63)>=32&&(a-=64),p=Math.pow(10,a/4/10),(a=t.exp_nspsytune>>20&63)>=32&&(a-=64),d=p*Math.pow(10,a/4/10),a=0;a<Et.SBMAX_l;a++){b=a<=6?l:a<=13?m:a<=20?p:d,s.nsPsy.longfact[a]=b}for(a=0;a<Et.SBMAX_s;a++){var b;b=a<=5?l:a<=10?m:a<=11?p:d,s.nsPsy.shortfact[a]=b}}},this.on_pe=function(e,a,s,r,n,i){var o,l,_=e.internal_flags,c=0,u=At(2),f=new yt(c),h=t.ResvMaxBits(e,r,f,i),m=(c=f.bits)+h;for(m>kt.MAX_BITS_PER_GRANULE&&(m=kt.MAX_BITS_PER_GRANULE),o=0,l=0;l<_.channels_out;++l)s[l]=Math.min(kt.MAX_BITS_PER_CHANNEL,c/_.channels_out),u[l]=0|s[l]*a[n][l]/700-s[l],u[l]>3*r/4&&(u[l]=3*r/4),u[l]<0&&(u[l]=0),u[l]+s[l]>kt.MAX_BITS_PER_CHANNEL&&(u[l]=Math.max(0,kt.MAX_BITS_PER_CHANNEL-s[l])),o+=u[l];if(o>h)for(l=0;l<_.channels_out;++l)u[l]=h*u[l]/o;for(l=0;l<_.channels_out;++l)s[l]+=u[l],h-=u[l];for(o=0,l=0;l<_.channels_out;++l)o+=s[l];if(o>kt.MAX_BITS_PER_GRANULE){for(l=0;l<_.channels_out;++l)s[l]*=kt.MAX_BITS_PER_GRANULE,s[l]/=o,s[l]}return m},this.reduce_side=function(e,t,a,s){Rt(e[0]+e[1]<=kt.MAX_BITS_PER_GRANULE);var r=.33*(.5-t)/.5;r<0&&(r=0),r>.5&&(r=.5);var n=0|.5*r*(e[0]+e[1]);n>kt.MAX_BITS_PER_CHANNEL-e[0]&&(n=kt.MAX_BITS_PER_CHANNEL-e[0]),n<0&&(n=0),e[1]>=125&&(e[1]-n>125?(e[0]<a&&(e[0]+=n),e[1]-=n):(e[0]+=e[1]-125,e[1]=125)),(n=e[0]+e[1])>s&&(e[0]=s*e[0]/n,e[1]=s*e[1]/n),Rt(e[0]<=kt.MAX_BITS_PER_CHANNEL),Rt(e[1]<=kt.MAX_BITS_PER_CHANNEL),Rt(e[0]+e[1]<=kt.MAX_BITS_PER_GRANULE)},this.athAdjust=function(e,t,a){var s=90.30873362,r=wt.FAST_LOG10_X(t,10),n=e*e,i=0;return r-=a,n>1e-20&&(i=1+wt.FAST_LOG10_X(n,10/s)),i<0&&(i=0),r*=i,r+=a+s-94.82444863,Math.pow(10,.1*r)},this.calc_xmin=function(e,t,a,s){var n,i=0,o=e.internal_flags,l=0,_=0,c=o.ATH,u=a.xr,f=e.VBR==vt.vbr_mtrh?1:0,h=o.masking_lower;for(e.VBR!=vt.vbr_mtrh&&e.VBR!=vt.vbr_mt||(h=1),n=0;n<a.psy_lmax;n++){w=(S=e.VBR==vt.vbr_rh||e.VBR==vt.vbr_mtrh?athAdjust(c.adjust,c.l[n],c.floor):c.adjust*c.l[n])/(b=a.width[n]),M=r,y=b>>1,E=0;do{E+=k=u[l]*u[l],M+=k<w?k:w,E+=T=u[++l]*u[l],M+=T<w?T:w,l++}while(--y>0);if(E>S&&_++,n==Et.SBPSY_l)M<(R=S*o.nsPsy.longfact[n])&&(M=R);if(0!=f&&(S=M),!e.ATHonly)if((A=t.en.l[n])>0)R=E*t.thm.l[n]*h/A,0!=f&&(R*=o.nsPsy.longfact[n]),S<R&&(S=R);s[i++]=0!=f?S:S*o.nsPsy.longfact[n]}var m=575;if(a.block_type!=Et.SHORT_TYPE)for(var p=576;0!=p--&&BitStream.EQ(u[p],0);)m=p;a.max_nonzero_coeff=m;for(var d=a.sfb_smin;n<a.psymax;d++,n+=3){var b,g,v;for(v=e.VBR==vt.vbr_rh||e.VBR==vt.vbr_mtrh?athAdjust(c.adjust,c.s[d],c.floor):c.adjust*c.s[d],b=a.width[n],g=0;g<3;g++){var S,w,M,A,R,E=0,y=b>>1;w=v/b,M=r;do{var k,T;E+=k=u[l]*u[l],M+=k<w?k:w,E+=T=u[++l]*u[l],M+=T<w?T:w,l++}while(--y>0);if(E>v&&_++,d==Et.SBPSY_s)M<(R=v*o.nsPsy.shortfact[d])&&(M=R);if(S=0!=f?M:v,!e.ATHonly&&!e.ATHshort)if((A=t.en.s[d][g])>0)R=E*t.thm.s[d][g]*h/A,0!=f&&(R*=o.nsPsy.shortfact[d]),S<R&&(S=R);s[i++]=0!=f?S:S*o.nsPsy.shortfact[d]}e.useTemporal&&(s[i-3]>s[i-3+1]&&(s[i-3+1]+=(s[i-3]-s[i-3+1])*o.decay),s[i-3+1]>s[i-3+2]&&(s[i-3+2]+=(s[i-3+1]-s[i-3+2])*o.decay))}return _},this.calc_noise_core=function(e,t,a,s){var r=0,n=t.s,i=e.l3_enc;if(n>e.count1)for(;0!=a--;){l=e.xr[n],n++,r+=l*l,l=e.xr[n],n++,r+=l*l}else if(n>e.big_values){var o=Mt(2);for(o[0]=0,o[1]=s;0!=a--;){l=Math.abs(e.xr[n])-o[i[n]],n++,r+=l*l,l=Math.abs(e.xr[n])-o[i[n]],n++,r+=l*l}}else for(;0!=a--;){var l;l=Math.abs(e.xr[n])-u[i[n]]*s,n++,r+=l*l,l=Math.abs(e.xr[n])-u[i[n]]*s,n++,r+=l*l}return t.s=n,r},this.calc_noise=function(e,t,a,r,n){var i,o,_=0,c=0,u=0,f=0,h=0,p=-20,d=0,b=e.scalefac,g=0;for(r.over_SSD=0,i=0;i<e.psymax;i++){var v,S=e.global_gain-(b[g++]+(0!=e.preflag?l[i]:0)<<e.scalefac_scale+1)-8*e.subblock_gain[e.window[i]],w=0;if(null!=n&&n.step[i]==S)w=n.noise[i],d+=e.width[i],a[_++]=w/t[c++],w=n.noise_log[i];else{var M,A=s(S);if(o=e.width[i]>>1,d+e.width[i]>e.max_nonzero_coeff)o=(M=e.max_nonzero_coeff-d+1)>0?M>>1:0;var R=new m(d);w=this.calc_noise_core(e,R,o,A),d=R.s,null!=n&&(n.step[i]=S,n.noise[i]=w),w=a[_++]=w/t[c++],w=wt.FAST_LOG10(Math.max(w,1e-20)),null!=n&&(n.noise_log[i]=w)}if(null!=n&&(n.global_gain=e.global_gain),h+=w,w>0)v=Math.max(0|10*w+.5,1),r.over_SSD+=v*v,u++,f+=w;p=Math.max(p,w)}return r.over_count=u,r.tot_noise=h,r.over_noise=f,r.max_noise=p,u},this.set_pinfo=function(e,t,a,s,r){var n,i,o,_,c,u=e.internal_flags,f=0==t.scalefac_scale?.5:1,h=t.scalefac,m=Mt(L3Side.SFBMAX),p=Mt(L3Side.SFBMAX),d=new CalcNoiseResult;calc_xmin(e,a,t,m),calc_noise(t,m,p,d,null);var b=0;for(i=t.sfb_lmax,t.block_type!=Et.SHORT_TYPE&&0==t.mixed_block_flag&&(i=22),n=0;n<i;n++){var g=u.scalefac_band.l[n],v=(S=u.scalefac_band.l[n+1])-g;for(_=0;b<S;b++)_+=t.xr[b]*t.xr[b];_/=v,c=1e15,u.pinfo.en[s][r][n]=c*_,u.pinfo.xfsf[s][r][n]=c*m[n]*p[n]/v,a.en.l[n]>0&&!e.ATHonly?_/=a.en.l[n]:_=0,u.pinfo.thr[s][r][n]=c*Math.max(_*a.thm.l[n],u.ATH.l[n]),u.pinfo.LAMEsfb[s][r][n]=0,0!=t.preflag&&n>=11&&(u.pinfo.LAMEsfb[s][r][n]=-f*l[n]),n<Et.SBPSY_l&&(Rt(h[n]>=0),u.pinfo.LAMEsfb[s][r][n]-=f*h[n])}if(t.block_type==Et.SHORT_TYPE)for(i=n,n=t.sfb_smin;n<Et.SBMAX_s;n++){g=u.scalefac_band.s[n],v=(S=u.scalefac_band.s[n+1])-g;for(var S,w=0;w<3;w++){for(_=0,o=g;o<S;o++)_+=t.xr[b]*t.xr[b],b++;_=Math.max(_/v,1e-20),c=1e15,u.pinfo.en_s[s][r][3*n+w]=c*_,u.pinfo.xfsf_s[s][r][3*n+w]=c*m[i]*p[i]/v,a.en.s[n][w]>0?_/=a.en.s[n][w]:_=0,(e.ATHonly||e.ATHshort)&&(_=0),u.pinfo.thr_s[s][r][3*n+w]=c*Math.max(_*a.thm.s[n][w],u.ATH.s[n]),u.pinfo.LAMEsfb_s[s][r][3*n+w]=-2*t.subblock_gain[w],n<Et.SBPSY_s&&(u.pinfo.LAMEsfb_s[s][r][3*n+w]-=f*h[i]),i++}}u.pinfo.LAMEqss[s][r]=t.global_gain,u.pinfo.LAMEmainbits[s][r]=t.part2_3_length+t.part2_length,u.pinfo.LAMEsfbits[s][r]=t.part2_length,u.pinfo.over[s][r]=d.over_count,u.pinfo.max_noise[s][r]=10*d.max_noise,u.pinfo.over_noise[s][r]=10*d.over_noise,u.pinfo.tot_noise[s][r]=10*d.tot_noise,u.pinfo.over_SSD[s][r]=d.over_SSD}}Tt.Q_MAX=257,Tt.Q_MAX2=116,Tt.LARGE_BITS=1e5,Tt.IXMAX_VAL=8206;var Bt=Tt,xt=W.System,Pt=W.Arrays,It=W.new_int,Lt=W.assert,Ct=Z(),Nt=bt,Ot=Me,Dt=Bt;var Ht=function e(){var t=null;function a(e){this.bits=0|e}this.qupvt=null,this.setModules=function(e){this.qupvt=e,t=e};var s=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]];function r(e,t,a,s,r,n){var i=.5946/t;for(e>>=1;0!=e--;)r[n++]=i>a[s++]?0:1,r[n++]=i>a[s++]?0:1}function n(e,a,s,r,n,i){var o=(e>>=1)%2;for(e>>=1;0!=e--;){var l,_,c,u,f,h,m,p;l=s[r++]*a,_=s[r++]*a,f=0|l,c=s[r++]*a,h=0|_,u=s[r++]*a,m=0|c,l+=t.adj43[f],p=0|u,_+=t.adj43[h],n[i++]=0|l,c+=t.adj43[m],n[i++]=0|_,u+=t.adj43[p],n[i++]=0|c,n[i++]=0|u}0!=o&&(f=0|(l=s[r++]*a),h=0|(_=s[r++]*a),l+=t.adj43[f],_+=t.adj43[h],n[i++]=0|l,n[i++]=0|_)}var i=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];function o(e,t,a,s){var r=function(e,t,a){var s=0,r=0;do{var n=e[t++],i=e[t++];s<n&&(s=n),r<i&&(r=i)}while(t<a);return s<r&&(s=r),s}(e,t,a);switch(r){case 0:return r;case 1:return function(e,t,a,s){var r=0,n=Nt.ht[1].hlen;do{var i=2*e[t+0]+e[t+1];t+=2,r+=n[i]}while(t<a);return s.bits+=r,1}(e,t,a,s);case 2:case 3:return function(e,t,a,s,r){var n,i,o=0,l=Nt.ht[s].xlen;i=2==s?Nt.table23:Nt.table56;do{var _=e[t+0]*l+e[t+1];t+=2,o+=i[_]}while(t<a);return n=65535&o,(o>>=16)>n&&(o=n,s++),r.bits+=o,s}(e,t,a,i[r-1],s);case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return function(e,t,a,s,r){var n=0,i=0,o=0,l=Nt.ht[s].xlen,_=Nt.ht[s].hlen,c=Nt.ht[s+1].hlen,u=Nt.ht[s+2].hlen;do{var f=e[t+0]*l+e[t+1];t+=2,n+=_[f],i+=c[f],o+=u[f]}while(t<a);var h=s;return n>i&&(n=i,h++),n>o&&(n=o,h=s+2),r.bits+=n,h}(e,t,a,i[r-1],s);default:if(r>Dt.IXMAX_VAL)return s.bits=Dt.LARGE_BITS,-1;var n,o;for(r-=15,n=24;n<32&&!(Nt.ht[n].linmax>=r);n++);for(o=n-8;o<24&&!(Nt.ht[o].linmax>=r);o++);return function(e,t,a,s,r,n){var i,o=65536*Nt.ht[s].xlen+Nt.ht[r].xlen,l=0;do{var _=e[t++],c=e[t++];0!=_&&(_>14&&(_=15,l+=o),_*=16),0!=c&&(c>14&&(c=15,l+=o),_+=c),l+=Nt.largetbl[_]}while(t<a);return i=65535&l,(l>>=16)>i&&(l=i,s=r),n.bits+=l,s}(e,t,a,o,n,s)}}function l(e,t,s,r,n,i,l,_){for(var c=t.big_values,u=2;u<Ct.SBMAX_l+1;u++){var f=e.scalefac_band.l[u];if(f>=c)break;var h=n[u-2]+t.count1bits;if(s.part2_3_length<=h)break;var m=new a(h),p=o(r,f,c,m);h=m.bits,s.part2_3_length<=h||(s.assign(t),s.part2_3_length=h,s.region0_count=i[u-2],s.region1_count=u-2-i[u-2],s.table_select[0]=l[u-2],s.table_select[1]=_[u-2],s.table_select[2]=p)}}this.noquant_count_bits=function(e,t,s){var r=t.l3_enc,n=Math.min(576,t.max_nonzero_coeff+2>>1<<1);for(null!=s&&(s.sfb_count1=0);n>1&&0==(r[n-1]|r[n-2]);n-=2);t.count1=n;for(var i=0,l=0;n>3;n-=4){var _;if((2147483647&(r[n-1]|r[n-2]|r[n-3]|r[n-4]))>1)break;_=2*(2*(2*r[n-4]+r[n-3])+r[n-2])+r[n-1],i+=Nt.t32l[_],l+=Nt.t33l[_]}var c=i;if(t.count1table_select=0,i>l&&(c=l,t.count1table_select=1),t.count1bits=c,t.big_values=n,0==n)return c;if(t.block_type==Ct.SHORT_TYPE)(i=3*e.scalefac_band.s[3])>t.big_values&&(i=t.big_values),l=t.big_values;else if(t.block_type==Ct.NORM_TYPE){if(i=t.region0_count=e.bv_scf[n-2],l=t.region1_count=e.bv_scf[n-1],Lt(i+l+2<Ct.SBPSY_l),l=e.scalefac_band.l[i+l+2],i=e.scalefac_band.l[i+1],l<n){var u=new a(c);t.table_select[2]=o(r,l,n,u),c=u.bits}}else t.region0_count=7,t.region1_count=Ct.SBMAX_l-1-7-1,(i=e.scalefac_band.l[8])>(l=n)&&(i=l);if(i=Math.min(i,n),l=Math.min(l,n),0<i){u=new a(c);t.table_select[0]=o(r,0,i,u),c=u.bits}if(i<l){u=new a(c);t.table_select[1]=o(r,i,l,u),c=u.bits}if(2==e.use_best_huffman&&(t.part2_3_length=c,best_huffman_divide(e,t),c=t.part2_3_length),null!=s&&t.block_type==Ct.NORM_TYPE){for(var f=0;e.scalefac_band.l[f]<t.big_values;)f++;s.sfb_count1=f}return c},this.count_bits=function(e,a,s,i){var o=s.l3_enc,l=Dt.IXMAX_VAL/t.IPOW20(s.global_gain);if(s.xrpow_max>l)return Dt.LARGE_BITS;if(function(e,a,s,i,o){var l,_,c,u=0,f=0,h=0,m=0,p=a,d=0,b=p,g=0,v=e,S=0;for(c=null!=o&&i.global_gain==o.global_gain,_=i.block_type==Ct.SHORT_TYPE?38:21,l=0;l<=_;l++){var w=-1;if((c||i.block_type==Ct.NORM_TYPE)&&(w=i.global_gain-(i.scalefac[l]+(0!=i.preflag?t.pretab[l]:0)<<i.scalefac_scale+1)-8*i.subblock_gain[i.window[l]]),Lt(i.width[l]>=0),c&&o.step[l]==w)0!=f&&(n(f,s,v,S,b,g),f=0),0!=h&&(r(h,s,v,S,b,g),h=0);else{var M,A=i.width[l];if(u+i.width[l]>i.max_nonzero_coeff&&(M=i.max_nonzero_coeff-u+1,Pt.fill(a,i.max_nonzero_coeff,576,0),(A=M)<0&&(A=0),l=_+1),0==f&&0==h&&(b=p,g=d,v=e,S=m),null!=o&&o.sfb_count1>0&&l>=o.sfb_count1&&o.step[l]>0&&w>=o.step[l]?(0!=f&&(n(f,s,v,S,b,g),f=0,b=p,g=d,v=e,S=m),h+=A):(0!=h&&(r(h,s,v,S,b,g),h=0,b=p,g=d,v=e,S=m),f+=A),A<=0){0!=h&&(r(h,s,v,S,b,g),h=0),0!=f&&(n(f,s,v,S,b,g),f=0);break}}l<=_&&(d+=i.width[l],m+=i.width[l],u+=i.width[l])}0!=f&&(n(f,s,v,S,b,g),f=0),0!=h&&(r(h,s,v,S,b,g),h=0)}(a,o,t.IPOW20(s.global_gain),s,i),2&e.substep_shaping)for(var _=0,c=s.global_gain+s.scalefac_scale,u=.634521682242439/t.IPOW20(c),f=0;f<s.sfbmax;f++){var h,m=s.width[f];if(0==e.pseudohalf[f])_+=m;else for(h=_,_+=m;h<_;++h)o[h]=a[h]>=u?o[h]:0}return this.noquant_count_bits(e,s,i)},this.best_huffman_divide=function(e,t){var s=new Ot,r=t.l3_enc,n=It(23),i=It(23),_=It(23),c=It(23);if(t.block_type!=Ct.SHORT_TYPE||1!=e.mode_gr){s.assign(t),t.block_type==Ct.NORM_TYPE&&(!function(e,t,s,r,n,i,l){for(var _=t.big_values,c=0;c<=22;c++)r[c]=Dt.LARGE_BITS;for(c=0;c<16;c++){var u=e.scalefac_band.l[c+1];if(u>=_)break;var f=0,h=new a(f),m=o(s,0,u,h);f=h.bits;for(var p=0;p<8;p++){var d=e.scalefac_band.l[c+p+2];if(d>=_)break;var b=f,g=o(s,u,d,h=new a(b));b=h.bits,r[c+p]>b&&(r[c+p]=b,n[c+p]=c,i[c+p]=m,l[c+p]=g)}}}(e,t,r,n,i,_,c),l(e,s,t,r,n,i,_,c));var u=s.big_values;if(!(0==u||(r[u-2]|r[u-1])>1||(u=t.count1+2)>576)){s.assign(t),s.count1=u;for(var f=0,h=0;u>s.big_values;u-=4){var m=2*(2*(2*r[u-4]+r[u-3])+r[u-2])+r[u-1];f+=Nt.t32l[m],h+=Nt.t33l[m]}if(s.big_values=u,s.count1table_select=0,f>h&&(f=h,s.count1table_select=1),s.count1bits=f,s.block_type==Ct.NORM_TYPE)l(e,s,t,r,n,i,_,c);else{if(s.part2_3_length=f,(f=e.scalefac_band.l[8])>u&&(f=u),f>0){var p=new a(s.part2_3_length);s.table_select[0]=o(r,0,f,p),s.part2_3_length=p.bits}if(u>f){p=new a(s.part2_3_length);s.table_select[1]=o(r,f,u,p),s.part2_3_length=p.bits}t.part2_3_length>s.part2_3_length&&t.assign(s)}}}};var _=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],c=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],u=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],f=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];e.slen1_tab=u,e.slen2_tab=f,this.best_scalefac_store=function(e,a,s,r){var n,i,o,l,h=r.tt[a][s],m=0;for(o=0,n=0;n<h.sfbmax;n++){var p=h.width[n];for(o+=p,l=-p;l<0&&0==h.l3_enc[l+o];l++);0==l&&(h.scalefac[n]=m=-2)}if(0==h.scalefac_scale&&0==h.preflag){var d=0;for(n=0;n<h.sfbmax;n++)h.scalefac[n]>0&&(d|=h.scalefac[n]);if(!(1&d)&&0!=d){for(n=0;n<h.sfbmax;n++)h.scalefac[n]>0&&(h.scalefac[n]>>=1);h.scalefac_scale=m=1}}if(0==h.preflag&&h.block_type!=Ct.SHORT_TYPE&&2==e.mode_gr){for(n=11;n<Ct.SBPSY_l&&!(h.scalefac[n]<t.pretab[n]&&-2!=h.scalefac[n]);n++);if(n==Ct.SBPSY_l){for(n=11;n<Ct.SBPSY_l;n++)h.scalefac[n]>0&&(h.scalefac[n]-=t.pretab[n]);h.preflag=m=1}}for(i=0;i<4;i++)r.scfsi[s][i]=0;for(2==e.mode_gr&&1==a&&r.tt[0][s].block_type!=Ct.SHORT_TYPE&&r.tt[1][s].block_type!=Ct.SHORT_TYPE&&(!function(e,t){for(var a,s=t.tt[1][e],r=t.tt[0][e],n=0;n<Nt.scfsi_band.length-1;n++){for(a=Nt.scfsi_band[n];a<Nt.scfsi_band[n+1]&&!(r.scalefac[a]!=s.scalefac[a]&&s.scalefac[a]>=0);a++);if(a==Nt.scfsi_band[n+1]){for(a=Nt.scfsi_band[n];a<Nt.scfsi_band[n+1];a++)s.scalefac[a]=-1;t.scfsi[e][n]=1}}var i=0,o=0;for(a=0;a<11;a++)-1!=s.scalefac[a]&&(o++,i<s.scalefac[a]&&(i=s.scalefac[a]));for(var l=0,h=0;a<Ct.SBPSY_l;a++)-1!=s.scalefac[a]&&(h++,l<s.scalefac[a]&&(l=s.scalefac[a]));for(n=0;n<16;n++)if(i<_[n]&&l<c[n]){var m=u[n]*o+f[n]*h;s.part2_length>m&&(s.part2_length=m,s.scalefac_compress=n)}}(s,r),m=0),n=0;n<h.sfbmax;n++)-2==h.scalefac[n]&&(h.scalefac[n]=0);0!=m&&(2==e.mode_gr?this.scale_bitcount(h):this.scale_bitcount_lsf(e,h))};var h=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126],m=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122],p=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function(e){var a,s,r,n=0,i=0,o=e.scalefac;if(Lt(function(e,t){for(var a=0;a<t;++a)if(e[a]<0)return!1;return!0}(o,e.sfbmax)),e.block_type==Ct.SHORT_TYPE)r=h,0!=e.mixed_block_flag&&(r=m);else if(r=p,0==e.preflag){for(s=11;s<Ct.SBPSY_l&&!(o[s]<t.pretab[s]);s++);if(s==Ct.SBPSY_l)for(e.preflag=1,s=11;s<Ct.SBPSY_l;s++)o[s]-=t.pretab[s]}for(s=0;s<e.sfbdivide;s++)n<o[s]&&(n=o[s]);for(;s<e.sfbmax;s++)i<o[s]&&(i=o[s]);for(e.part2_length=Dt.LARGE_BITS,a=0;a<16;a++)n<_[a]&&i<c[a]&&e.part2_length>r[a]&&(e.part2_length=r[a],e.scalefac_compress=a);return e.part2_length==Dt.LARGE_BITS};var d=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function(e,a){var s,r,n,i,o,l,_,c,u=It(4),f=a.scalefac;for(s=0!=a.preflag?2:0,_=0;_<4;_++)u[_]=0;if(a.block_type==Ct.SHORT_TYPE){r=1;var h=t.nr_of_sfb_block[s][r];for(c=0,n=0;n<4;n++)for(i=h[n]/3,_=0;_<i;_++,c++)for(o=0;o<3;o++)f[3*c+o]>u[n]&&(u[n]=f[3*c+o])}else{r=0;h=t.nr_of_sfb_block[s][r];for(c=0,n=0;n<4;n++)for(i=h[n],_=0;_<i;_++,c++)f[c]>u[n]&&(u[n]=f[c])}for(l=!1,n=0;n<4;n++)u[n]>d[s][n]&&(l=!0);if(!l){var m,p,g,v;for(a.sfb_partition_table=t.nr_of_sfb_block[s][r],n=0;n<4;n++)a.slen[n]=b[u[n]];switch(m=a.slen[0],p=a.slen[1],g=a.slen[2],v=a.slen[3],s){case 0:a.scalefac_compress=(5*m+p<<4)+(g<<2)+v;break;case 1:a.scalefac_compress=400+(5*m+p<<2)+g;break;case 2:a.scalefac_compress=500+3*m+p;break;default:xt.err.printf("intensity stereo not implemented yet\n")}}if(!l)for(Lt(null!=a.sfb_partition_table),a.part2_length=0,n=0;n<4;n++)a.part2_length+=a.slen[n]*a.sfb_partition_table[n];return l};var b=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function(e){for(var t=2;t<=576;t+=2){for(var a,r=0;e.scalefac_band.l[++r]<t;);for(a=s[r][0];e.scalefac_band.l[a+1]>t;)a--;for(a<0&&(a=s[r][0]),e.bv_scf[t-2]=a,a=s[r][1];e.scalefac_band.l[a+e.bv_scf[t-2]+2]>t;)a--;a<0&&(a=s[r][1]),e.bv_scf[t-1]=a}}},Ft=W.System,Vt=W.Arrays,zt=W.new_byte,Xt=W.new_float_n,Yt=W.new_int,qt=W.assert,Ut=Ht,jt=bt,Gt=Z(),Wt=We;function Kt(){var e=this,t=null,a=null,s=null,r=null;this.setModules=function(e,n,i,o){t=e,a=n,s=i,r=o};var n=null,i=0,o=0,l=0;function _(e){Ft.arraycopy(e.header[e.w_ptr].buf,0,n,o,e.sideinfo_len),o+=e.sideinfo_len,i+=8*e.sideinfo_len,e.w_ptr=e.w_ptr+1&Wt.MAX_HEADER_BUF-1}function c(e,t,a){for(;a>0;){var s;0==l&&(l=8,o++,qt(o<Lame.LAME_MAXMP3BUFFER),qt(e.header[e.w_ptr].write_timing>=i),e.header[e.w_ptr].write_timing==i&&_(e),n[o]=0),a-=s=Math.min(a,l),l-=s,n[o]|=t>>a<<l,i+=s}}function u(e,t,a){for(;a>0;){var s;0==l&&(l=8,o++,qt(o<Lame.LAME_MAXMP3BUFFER),n[o]=0),a-=s=Math.min(a,l),l-=s,n[o]|=t>>a<<l,i+=s}}function f(e,t){var a,r=e.internal_flags;if(t>=8&&(c(r,76,8),t-=8),t>=8&&(c(r,65,8),t-=8),t>=8&&(c(r,77,8),t-=8),t>=8&&(c(r,69,8),t-=8),t>=32){var n=s.getLameShortVersion();if(t>=32)for(a=0;a<n.length&&t>=8;++a)t-=8,c(r,n.charAt(a),8)}for(;t>=1;t-=1)c(r,r.ancillary_flag,1),r.ancillary_flag^=e.disable_reservoir?0:1}function h(e,t,a){for(var s=e.header[e.h_ptr].ptr;a>0;){var r=Math.min(a,8-(7&s));a-=r,e.header[e.h_ptr].buf[s>>3]|=t>>a<<8-(7&s)-r,s+=r}e.header[e.h_ptr].ptr=s}function m(e,t){e<<=8;for(var a=0;a<8;a++)65536&((t<<=1)^(e<<=1))&&(t^=32773);return t}function p(e,t){var a,s=jt.ht[t.count1table_select+32],r=0,n=t.big_values,i=t.big_values;for(qt(t.count1table_select<2),a=(t.count1-t.big_values)/4;a>0;--a){var o=0,l=0;0!=t.l3_enc[n+0]&&(l+=8,t.xr[i+0]<0&&o++),0!=t.l3_enc[n+1]&&(l+=4,o*=2,t.xr[i+1]<0&&o++),0!=t.l3_enc[n+2]&&(l+=2,o*=2,t.xr[i+2]<0&&o++),0!=t.l3_enc[n+3]&&(l++,o*=2,t.xr[i+3]<0&&o++),n+=4,i+=4,c(e,o+s.table[l],s.hlen[l]),r+=s.hlen[l]}return r}function d(e,t,a,s,r){var n=jt.ht[t],i=0;if(0==t)return i;for(var o=a;o<s;o+=2){var l=0,_=0,u=n.xlen,f=n.xlen,h=0,m=r.l3_enc[o],p=r.l3_enc[o+1];if(0!=m&&(r.xr[o]<0&&h++,l--),t>15){if(m>14){var d=m-15;qt(d<=n.linmax),h|=d<<1,_=u,m=15}if(p>14){var b=p-15;qt(b<=n.linmax),h<<=u,h|=b,_+=u,p=15}f=16}0!=p&&(h<<=1,r.xr[o+1]<0&&h++,l--),m=m*f+p,_-=l,l+=n.hlen[m],c(e,n.table[m],l),c(e,h,_),i+=l+_}return i}function b(e,t){var a=3*e.scalefac_band.s[3];a>t.big_values&&(a=t.big_values);var s=d(e,t.table_select[0],0,a,t);return s+=d(e,t.table_select[1],a,t.big_values,t)}function g(e,t){var a,s,r,n;a=t.big_values;var i=t.region0_count+1;return qt(i<e.scalefac_band.l.length),r=e.scalefac_band.l[i],i+=t.region1_count+1,qt(i<e.scalefac_band.l.length),r>a&&(r=a),(n=e.scalefac_band.l[i])>a&&(n=a),s=d(e,t.table_select[0],0,r,t),s+=d(e,t.table_select[1],r,n,t),s+=d(e,t.table_select[2],n,a,t)}function v(){this.total=0}function S(t,a){var s,r,n,l,_,c=t.internal_flags;return _=c.w_ptr,-1==(l=c.h_ptr-1)&&(l=Wt.MAX_HEADER_BUF-1),s=c.header[l].write_timing-i,a.total=s,s>=0&&(r=1+l-_,l<_&&(r=1+l-_+Wt.MAX_HEADER_BUF),s-=8*r*c.sideinfo_len),s+=n=e.getframebits(t),a.total+=n,a.total%8!=0?a.total=1+a.total/8:a.total=a.total/8,a.total+=o+1,s<0&&Ft.err.println("strange error flushing buffer ... \n"),s}this.getframebits=function(e){var t,a=e.internal_flags;return t=0!=a.bitrate_index?jt.bitrate_table[e.version][a.bitrate_index]:e.brate,8*(0|72e3*(e.version+1)*t/e.out_samplerate+a.padding)},this.CRC_writeheader=function(e,t){var a=65535;a=m(255&t[2],a),a=m(255&t[3],a);for(var s=6;s<e.sideinfo_len;s++)a=m(255&t[s],a);t[4]=byte(a>>8),t[5]=byte(255&a)},this.flush_bitstream=function(e){var a,s,r=e.internal_flags,n=r.h_ptr-1;if(-1==n&&(n=Wt.MAX_HEADER_BUF-1),a=r.l3_side,!((s=S(e,new v))<0)){if(f(e,s),qt(r.header[n].write_timing+this.getframebits(e)==i),r.ResvSize=0,a.main_data_begin=0,r.findReplayGain){var o=t.GetTitleGain(r.rgdata);qt(NEQ(o,GainAnalysis.GAIN_NOT_ENOUGH_SAMPLES)),r.RadioGain=0|Math.floor(10*o+.5)}r.findPeakSample&&(r.noclipGainChange=0|Math.ceil(20*Math.log10(r.PeakSample/32767)*10),r.noclipGainChange>0&&(EQ(e.scale,1)||EQ(e.scale,0))?r.noclipScale=Math.floor(32767/r.PeakSample*100)/100:r.noclipScale=-1)}},this.add_dummy_byte=function(e,t,a){for(var s,r=e.internal_flags;a-- >0;)for(u(0,t,8),s=0;s<Wt.MAX_HEADER_BUF;++s)r.header[s].write_timing+=8},this.format_bitstream=function(e){var t,a=e.internal_flags;t=a.l3_side;var s=this.getframebits(e);f(e,t.resvDrain_pre),function(e,t){var a,s,r,n=e.internal_flags;if(a=n.l3_side,n.header[n.h_ptr].ptr=0,Vt.fill(n.header[n.h_ptr].buf,0,n.sideinfo_len,0),e.out_samplerate<16e3?h(n,4094,12):h(n,4095,12),h(n,e.version,1),h(n,1,2),h(n,e.error_protection?0:1,1),h(n,n.bitrate_index,4),h(n,n.samplerate_index,2),h(n,n.padding,1),h(n,e.extension,1),h(n,e.mode.ordinal(),2),h(n,n.mode_ext,2),h(n,e.copyright,1),h(n,e.original,1),h(n,e.emphasis,2),e.error_protection&&h(n,0,16),1==e.version){for(qt(a.main_data_begin>=0),h(n,a.main_data_begin,9),2==n.channels_out?h(n,a.private_bits,3):h(n,a.private_bits,5),r=0;r<n.channels_out;r++){var i;for(i=0;i<4;i++)h(n,a.scfsi[r][i],1)}for(s=0;s<2;s++)for(r=0;r<n.channels_out;r++)h(n,(o=a.tt[s][r]).part2_3_length+o.part2_length,12),h(n,o.big_values/2,9),h(n,o.global_gain,8),h(n,o.scalefac_compress,4),o.block_type!=Gt.NORM_TYPE?(h(n,1,1),h(n,o.block_type,2),h(n,o.mixed_block_flag,1),14==o.table_select[0]&&(o.table_select[0]=16),h(n,o.table_select[0],5),14==o.table_select[1]&&(o.table_select[1]=16),h(n,o.table_select[1],5),h(n,o.subblock_gain[0],3),h(n,o.subblock_gain[1],3),h(n,o.subblock_gain[2],3)):(h(n,0,1),14==o.table_select[0]&&(o.table_select[0]=16),h(n,o.table_select[0],5),14==o.table_select[1]&&(o.table_select[1]=16),h(n,o.table_select[1],5),14==o.table_select[2]&&(o.table_select[2]=16),h(n,o.table_select[2],5),qt(0<=o.region0_count&&o.region0_count<16),qt(0<=o.region1_count&&o.region1_count<8),h(n,o.region0_count,4),h(n,o.region1_count,3)),h(n,o.preflag,1),h(n,o.scalefac_scale,1),h(n,o.count1table_select,1)}else for(qt(a.main_data_begin>=0),h(n,a.main_data_begin,8),h(n,a.private_bits,n.channels_out),s=0,r=0;r<n.channels_out;r++){var o;h(n,(o=a.tt[s][r]).part2_3_length+o.part2_length,12),h(n,o.big_values/2,9),h(n,o.global_gain,8),h(n,o.scalefac_compress,9),o.block_type!=Gt.NORM_TYPE?(h(n,1,1),h(n,o.block_type,2),h(n,o.mixed_block_flag,1),14==o.table_select[0]&&(o.table_select[0]=16),h(n,o.table_select[0],5),14==o.table_select[1]&&(o.table_select[1]=16),h(n,o.table_select[1],5),h(n,o.subblock_gain[0],3),h(n,o.subblock_gain[1],3),h(n,o.subblock_gain[2],3)):(h(n,0,1),14==o.table_select[0]&&(o.table_select[0]=16),h(n,o.table_select[0],5),14==o.table_select[1]&&(o.table_select[1]=16),h(n,o.table_select[1],5),14==o.table_select[2]&&(o.table_select[2]=16),h(n,o.table_select[2],5),qt(0<=o.region0_count&&o.region0_count<16),qt(0<=o.region1_count&&o.region1_count<8),h(n,o.region0_count,4),h(n,o.region1_count,3)),h(n,o.scalefac_scale,1),h(n,o.count1table_select,1)}e.error_protection&&CRC_writeheader(n,n.header[n.h_ptr].buf);var l=n.h_ptr;qt(n.header[l].ptr==8*n.sideinfo_len),n.h_ptr=l+1&Wt.MAX_HEADER_BUF-1,n.header[n.h_ptr].write_timing=n.header[l].write_timing+t,n.h_ptr==n.w_ptr&&Ft.err.println("Error: MAX_HEADER_BUF too small in bitstream.c \n")}(e,s);var r=8*a.sideinfo_len;if(r+=function(e){var t,a,s,r,n=0,i=e.internal_flags,o=i.l3_side;if(1==e.version)for(t=0;t<2;t++)for(a=0;a<i.channels_out;a++){var l=o.tt[t][a],_=Ut.slen1_tab[l.scalefac_compress],u=Ut.slen2_tab[l.scalefac_compress];for(r=0,s=0;s<l.sfbdivide;s++)-1!=l.scalefac[s]&&(c(i,l.scalefac[s],_),r+=_);for(;s<l.sfbmax;s++)-1!=l.scalefac[s]&&(c(i,l.scalefac[s],u),r+=u);qt(r==l.part2_length),l.block_type==Gt.SHORT_TYPE?r+=b(i,l):r+=g(i,l),r+=p(i,l),qt(r==l.part2_3_length+l.part2_length),n+=r}else for(t=0,a=0;a<i.channels_out;a++){l=o.tt[t][a];var f,h,m=0;if(qt(null!=l.sfb_partition_table),r=0,s=0,h=0,l.block_type==Gt.SHORT_TYPE){for(;h<4;h++){var d=l.sfb_partition_table[h]/3,v=l.slen[h];for(f=0;f<d;f++,s++)c(i,Math.max(l.scalefac[3*s+0],0),v),c(i,Math.max(l.scalefac[3*s+1],0),v),c(i,Math.max(l.scalefac[3*s+2],0),v),m+=3*v}r+=b(i,l)}else{for(;h<4;h++)for(d=l.sfb_partition_table[h],v=l.slen[h],f=0;f<d;f++,s++)c(i,Math.max(l.scalefac[s],0),v),m+=v;r+=g(i,l)}r+=p(i,l),qt(r==l.part2_3_length),qt(m==l.part2_length),n+=m+r}return n}(e),f(e,t.resvDrain_post),r+=t.resvDrain_post,t.main_data_begin+=(s-r)/8,S(e,new v)!=a.ResvSize&&Ft.err.println("Internal buffer inconsistency. flushbits <> ResvSize"),8*t.main_data_begin!=a.ResvSize&&(Ft.err.printf("bit reservoir error: \nl3_side.main_data_begin: %d \nResvoir size:             %d \nresv drain (post)         %d \nresv drain (pre)          %d \nheader and sideinfo:      %d \ndata bits:                %d \ntotal bits:               %d (remainder: %d) \nbitsperframe:             %d \n",8*t.main_data_begin,a.ResvSize,t.resvDrain_post,t.resvDrain_pre,8*a.sideinfo_len,r-t.resvDrain_post-8*a.sideinfo_len,r,r%8,s),Ft.err.println("This is a fatal error.  It has several possible causes:"),Ft.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations"),Ft.err.println(" 9%%  Your system is overclocked"),Ft.err.println(" 1%%  bug in LAME encoding library"),a.ResvSize=8*t.main_data_begin),i>1e9){var n;for(n=0;n<Wt.MAX_HEADER_BUF;++n)a.header[n].write_timing-=i;i=0}return 0},this.copy_buffer=function(e,s,i,_,c){var u=o+1;if(u<=0)return 0;if(0!=_&&u>_)return-1;if(Ft.arraycopy(n,0,s,i,u),o=-1,l=0,0!=c){var f=Yt(1);if(f[0]=e.nMusicCRC,r.updateMusicCRC(f,s,i,u),e.nMusicCRC=f[0],u>0&&(e.VBR_seek_table.nBytesWritten+=u),e.decode_on_the_fly)for(var h,m=Xt([2,1152]),p=u,d=-1;0!=d;)if(d=a.hip_decode1_unclipped(e.hip,s,i,p,m[0],m[1]),p=0,-1==d&&(d=0),d>0){if(e.findPeakSample){for(h=0;h<d;h++)m[0][h]>e.PeakSample?e.PeakSample=m[0][h]:-m[0][h]>e.PeakSample&&(e.PeakSample=-m[0][h]);if(e.channels_out>1)for(h=0;h<d;h++)m[1][h]>e.PeakSample?e.PeakSample=m[1][h]:-m[1][h]>e.PeakSample&&(e.PeakSample=-m[1][h])}if(e.findReplayGain&&t.AnalyzeSamples(e.rgdata,m[0],0,m[1],0,d,e.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6}}return u},this.init_bit_stream_w=function(e){n=zt(Lame.LAME_MAXMP3BUFFER),e.h_ptr=e.w_ptr=0,e.header[e.h_ptr].write_timing=0,o=-1,l=0,i=0}}Kt.EQ=function(e,t){return Math.abs(e)>Math.abs(t)?Math.abs(e-t)<=1e-6*Math.abs(e):Math.abs(e-t)<=1e-6*Math.abs(t)},Kt.NEQ=function(e,t){return!Kt.EQ(e,t)};var Zt=Kt,$t=W.System,Qt=W.VbrMode,Jt=W.ShortBlock,ea=W.new_float,ta=W.new_int_n,aa=W.new_short_n,sa=W.assert,ra=ue,na=pe,ia=We,oa=$e,la=nt,_a=mt,ca=Zt,ua=bt,fa=Z();var ha=function e(){var t,a,s,r,n,i=this;e.V9=410,e.V8=420,e.V7=430,e.V6=440,e.V5=450,e.V4=460,e.V3=470,e.V2=480,e.V1=490,e.V0=500,e.R3MIX=1e3,e.STANDARD=1001,e.EXTREME=1002,e.INSANE=1003,e.STANDARD_FAST=1004,e.EXTREME_FAST=1005,e.MEDIUM=1006,e.MEDIUM_FAST=1007,e.LAME_MAXMP3BUFFER=147456;var o,l,_,c=new ra;function u(){this.mask_adjust=0,this.mask_adjust_short=0,this.bo_l_weight=ea(fa.SBMAX_l),this.bo_s_weight=ea(fa.SBMAX_s)}function f(){this.lowerlimit=0}function h(e,t){this.lowpass=t}this.enc=new fa,this.setModules=function(e,i,u,f,h,m,p,d,b){t=e,a=i,s=u,r=f,n=h,o=m,l=d,_=b,this.enc.setModules(a,c,r,o)};var m=4294479419;function p(e){return e>1?0:e<=0?1:Math.cos(Math.PI/2*e)}function d(e,t){switch(e){case 44100:return t.version=1,0;case 48e3:return t.version=1,1;case 32e3:return t.version=1,2;case 22050:case 11025:return t.version=0,0;case 24e3:case 12e3:return t.version=0,1;case 16e3:case 8e3:return t.version=0,2;default:return t.version=0,-1}}function b(e,t,a){a<16e3&&(t=2);for(var s=ua.bitrate_table[t][1],r=2;r<=14;r++)ua.bitrate_table[t][r]>0&&Math.abs(ua.bitrate_table[t][r]-e)<Math.abs(s-e)&&(s=ua.bitrate_table[t][r]);return s}function g(e,t,a){a<16e3&&(t=2);for(var s=0;s<=14;s++)if(ua.bitrate_table[t][s]>0&&ua.bitrate_table[t][s]==e)return s;return-1}function v(e,t){var a=[new h(8,2e3),new h(16,3700),new h(24,3900),new h(32,5500),new h(40,7e3),new h(48,7500),new h(56,1e4),new h(64,11e3),new h(80,13500),new h(96,15100),new h(112,15600),new h(128,17e3),new h(160,17500),new h(192,18600),new h(224,19400),new h(256,19700),new h(320,20500)],s=i.nearestBitrateFullIndex(t);e.lowerlimit=a[s].lowpass}function S(e){var t=fa.BLKSIZE+e.framesize-fa.FFTOFFSET;return t=Math.max(t,512+e.framesize-32)}function w(e,t,a,s,r,n){var o=i.enc.lame_encode_mp3_frame(e,t,a,s,r,n);return e.frameNum++,o}function M(){this.n_in=0,this.n_out=0}function A(){this.num_used=0}function R(e,t){return 0!=t?R(t,e%t):e}function E(e,t,a){var s=Math.PI*t;(e/=a)<0&&(e=0),e>1&&(e=1);var r=e-.5,n=.42-.5*Math.cos(2*e*Math.PI)+.08*Math.cos(4*e*Math.PI);return Math.abs(r)<1e-9?s/Math.PI:n*Math.sin(a*s*r)/(Math.PI*a*r)}function y(e,t,a,s,r,n,i,o,l){var _,c,u=e.internal_flags,f=0,h=e.out_samplerate/R(e.out_samplerate,e.in_samplerate);h>ia.BPC&&(h=ia.BPC);var m=Math.abs(u.resample_ratio-Math.floor(.5+u.resample_ratio))<1e-4?1:0,p=1/u.resample_ratio;p>1&&(p=1);var d=31;0==d%2&&--d;var b=(d+=m)+1;if(0==u.fill_buffer_resample_init){for(u.inbuf_old[0]=ea(b),u.inbuf_old[1]=ea(b),_=0;_<=2*h;++_)u.blackfilt[_]=ea(b);for(u.itime[0]=0,u.itime[1]=0,f=0;f<=2*h;f++){var g=0,v=(f-h)/(2*h);for(_=0;_<=d;_++)g+=u.blackfilt[f][_]=E(_-v,p,d);for(_=0;_<=d;_++)u.blackfilt[f][_]/=g}u.fill_buffer_resample_init=1}var S=u.inbuf_old[l];for(c=0;c<s;c++){var w,M;if(w=c*u.resample_ratio,d+(f=0|Math.floor(w-u.itime[l]))-d/2>=i)break;v=w-u.itime[l]-(f+d%2*.5);M=0|Math.floor(2*v*h+h+.5);var A=0;for(_=0;_<=d;++_){var y=0|_+f-d/2;A+=(y<0?S[b+y]:r[n+y])*u.blackfilt[M][_]}t[a+c]=A}if(o.num_used=Math.min(i,d+f-d/2),u.itime[l]+=o.num_used-c*u.resample_ratio,o.num_used>=b)for(_=0;_<b;_++)S[_]=r[n+o.num_used+_-b];else{var k=b-o.num_used;for(_=0;_<k;++_)S[_]=S[_+o.num_used];for(f=0;_<b;++_,++f)S[_]=r[n+f];sa(f==o.num_used)}return c}function k(e,t,a,s,r,n){var i=e.internal_flags;if(i.resample_ratio<.9999||i.resample_ratio>1.0001)for(var o=0;o<i.channels_out;o++){var l=new A;n.n_out=y(e,t[o],i.mf_size,e.framesize,a[o],s,r,l,o),n.n_in=l.num_used}else{n.n_out=Math.min(e.framesize,r),n.n_in=n.n_out;for(var _=0;_<n.n_out;++_)t[0][i.mf_size+_]=a[0][s+_],2==i.channels_out&&(t[1][i.mf_size+_]=a[1][s+_])}}this.lame_init=function(){var e=new na;return function(e){var t;e.class_id=m,t=e.internal_flags=new ia,e.mode=MPEGMode.NOT_SET,e.original=1,e.in_samplerate=44100,e.num_channels=2,e.num_samples=-1,e.bWriteVbrTag=!0,e.quality=-1,e.short_blocks=null,t.subblock_gain=-1,e.lowpassfreq=0,e.highpassfreq=0,e.lowpasswidth=-1,e.highpasswidth=-1,e.VBR=Qt.vbr_off,e.VBR_q=4,e.ATHcurve=-1,e.VBR_mean_bitrate_kbps=128,e.VBR_min_bitrate_kbps=0,e.VBR_max_bitrate_kbps=0,e.VBR_hard_min=0,t.VBR_min_bitrate=1,t.VBR_max_bitrate=13,e.quant_comp=-1,e.quant_comp_short=-1,e.msfix=-1,t.resample_ratio=1,t.OldValue[0]=180,t.OldValue[1]=180,t.CurrentStep[0]=4,t.CurrentStep[1]=4,t.masking_lower=1,t.nsPsy.attackthre=-1,t.nsPsy.attackthre_s=-1,e.scale=-1,e.athaa_type=-1,e.ATHtype=-1,e.athaa_loudapprox=-1,e.athaa_sensitivity=0,e.useTemporal=null,e.interChRatio=-1,t.mf_samples_to_encode=fa.ENCDELAY+fa.POSTDELAY,e.encoder_padding=0,t.mf_size=fa.ENCDELAY-fa.MDCTDELAY,e.findReplayGain=!1,e.decode_on_the_fly=!1,t.decode_on_the_fly=!1,t.findReplayGain=!1,t.findPeakSample=!1,t.RadioGain=0,t.AudiophileGain=0,t.noclipGainChange=0,t.noclipScale=-1,e.preset=0,e.write_id3tag_automatic=!0}(e),e.lame_allocated_gfp=1,e},this.nearestBitrateFullIndex=function(e){var t=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320],a=0,s=0,r=0,n=0;n=t[16],r=16,s=t[16],a=16;for(var i=0;i<16;i++)if(Math.max(e,t[i+1])!=e){n=t[i+1],r=i+1,s=t[i],a=i;break}return n-e>e-s?a:r},this.lame_init_params=function(e){var i,h,S,w=e.internal_flags;if(w.Class_ID=0,null==w.ATH&&(w.ATH=new oa),null==w.PSY&&(w.PSY=new u),null==w.rgdata&&(w.rgdata=new la),w.channels_in=e.num_channels,1==w.channels_in&&(e.mode=MPEGMode.MONO),w.channels_out=e.mode==MPEGMode.MONO?1:2,w.mode_ext=fa.MPG_MD_MS_LR,e.mode==MPEGMode.MONO&&(e.force_ms=!1),e.VBR==Qt.vbr_off&&128!=e.VBR_mean_bitrate_kbps&&0==e.brate&&(e.brate=e.VBR_mean_bitrate_kbps),e.VBR==Qt.vbr_off||e.VBR==Qt.vbr_mtrh||e.VBR==Qt.vbr_mt||(e.free_format=!1),e.VBR==Qt.vbr_off&&0==e.brate&&ca.EQ(e.compression_ratio,0)&&(e.compression_ratio=11.025),e.VBR==Qt.vbr_off&&e.compression_ratio>0&&(0==e.out_samplerate&&(e.out_samplerate=map2MP3Frequency(int(.97*e.in_samplerate))),e.brate=0|16*e.out_samplerate*w.channels_out/(1e3*e.compression_ratio),w.samplerate_index=d(e.out_samplerate,e),e.free_format||(e.brate=b(e.brate,e.version,e.out_samplerate))),0!=e.out_samplerate&&(e.out_samplerate<16e3?(e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,8),e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,64)):e.out_samplerate<32e3?(e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,8),e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,160)):(e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,32),e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,320))),0==e.lowpassfreq){var M=16e3;switch(e.VBR){case Qt.vbr_off:v(A=new f,e.brate),M=A.lowerlimit;break;case Qt.vbr_abr:var A;v(A=new f,e.VBR_mean_bitrate_kbps),M=A.lowerlimit;break;case Qt.vbr_rh:var R=[19500,19e3,18600,18e3,17500,16e3,15600,14900,12500,1e4,3950];if(0<=e.VBR_q&&e.VBR_q<=9){var E=R[e.VBR_q],y=R[e.VBR_q+1],k=e.VBR_q_frac;M=linear_int(E,y,k)}else M=19500;break;default:R=[19500,19e3,18500,18e3,17500,16500,15500,14500,12500,9500,3950];if(0<=e.VBR_q&&e.VBR_q<=9){E=R[e.VBR_q],y=R[e.VBR_q+1],k=e.VBR_q_frac;M=linear_int(E,y,k)}else M=19500}e.mode!=MPEGMode.MONO||e.VBR!=Qt.vbr_off&&e.VBR!=Qt.vbr_abr||(M*=1.5),e.lowpassfreq=0|M}if(0==e.out_samplerate&&(2*e.lowpassfreq>e.in_samplerate&&(e.lowpassfreq=e.in_samplerate/2),e.out_samplerate=(i=0|e.lowpassfreq,h=e.in_samplerate,S=44100,h>=48e3?S=48e3:h>=44100?S=44100:h>=32e3?S=32e3:h>=24e3?S=24e3:h>=22050?S=22050:h>=16e3?S=16e3:h>=12e3?S=12e3:h>=11025?S=11025:h>=8e3&&(S=8e3),-1==i?S:(i<=15960&&(S=44100),i<=15250&&(S=32e3),i<=11220&&(S=24e3),i<=9970&&(S=22050),i<=7230&&(S=16e3),i<=5420&&(S=12e3),i<=4510&&(S=11025),i<=3970&&(S=8e3),h<S?h>44100?48e3:h>32e3?44100:h>24e3?32e3:h>22050?24e3:h>16e3?22050:h>12e3?16e3:h>11025?12e3:h>8e3?11025:8e3:S))),e.lowpassfreq=Math.min(20500,e.lowpassfreq),e.lowpassfreq=Math.min(e.out_samplerate/2,e.lowpassfreq),e.VBR==Qt.vbr_off&&(e.compression_ratio=16*e.out_samplerate*w.channels_out/(1e3*e.brate)),e.VBR==Qt.vbr_abr&&(e.compression_ratio=16*e.out_samplerate*w.channels_out/(1e3*e.VBR_mean_bitrate_kbps)),e.bWriteVbrTag||(e.findReplayGain=!1,e.decode_on_the_fly=!1,w.findPeakSample=!1),w.findReplayGain=e.findReplayGain,w.decode_on_the_fly=e.decode_on_the_fly,w.decode_on_the_fly&&(w.findPeakSample=!0),w.findReplayGain&&t.InitGainAnalysis(w.rgdata,e.out_samplerate)==GainAnalysis.INIT_GAIN_ANALYSIS_ERROR)return e.internal_flags=null,-6;switch(w.decode_on_the_fly&&!e.decode_only&&(null!=w.hip&&_.hip_decode_exit(w.hip),w.hip=_.hip_decode_init()),w.mode_gr=e.out_samplerate<=24e3?1:2,e.framesize=576*w.mode_gr,e.encoder_delay=fa.ENCDELAY,w.resample_ratio=e.in_samplerate/e.out_samplerate,e.VBR){case Qt.vbr_mt:case Qt.vbr_rh:case Qt.vbr_mtrh:e.compression_ratio=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5][e.VBR_q];break;case Qt.vbr_abr:e.compression_ratio=16*e.out_samplerate*w.channels_out/(1e3*e.VBR_mean_bitrate_kbps);break;default:e.compression_ratio=16*e.out_samplerate*w.channels_out/(1e3*e.brate)}if(e.mode==MPEGMode.NOT_SET&&(e.mode=MPEGMode.JOINT_STEREO),e.highpassfreq>0?(w.highpass1=2*e.highpassfreq,e.highpasswidth>=0?w.highpass2=2*(e.highpassfreq+e.highpasswidth):w.highpass2=2*e.highpassfreq,w.highpass1/=e.out_samplerate,w.highpass2/=e.out_samplerate):(w.highpass1=0,w.highpass2=0),e.lowpassfreq>0?(w.lowpass2=2*e.lowpassfreq,e.lowpasswidth>=0?(w.lowpass1=2*(e.lowpassfreq-e.lowpasswidth),w.lowpass1<0&&(w.lowpass1=0)):w.lowpass1=2*e.lowpassfreq,w.lowpass1/=e.out_samplerate,w.lowpass2/=e.out_samplerate):(w.lowpass1=0,w.lowpass2=0),function(e){var t=e.internal_flags,a=32,s=-1;if(t.lowpass1>0){for(var r=999,n=0;n<=31;n++)(_=n/31)>=t.lowpass2&&(a=Math.min(a,n)),t.lowpass1<_&&_<t.lowpass2&&(r=Math.min(r,n));t.lowpass1=999==r?(a-.75)/31:(r-.75)/31,t.lowpass2=a/31}if(t.highpass2>0&&t.highpass2<.75/31*.9&&(t.highpass1=0,t.highpass2=0,$t.err.println("Warning: highpass filter disabled.  highpass frequency too small\n")),t.highpass2>0){var i=-1;for(n=0;n<=31;n++)(_=n/31)<=t.highpass1&&(s=Math.max(s,n)),t.highpass1<_&&_<t.highpass2&&(i=Math.max(i,n));t.highpass1=s/31,t.highpass2=-1==i?(s+.75)/31:(i+.75)/31}for(n=0;n<32;n++){var o,l,_=n/31;o=t.highpass2>t.highpass1?p((t.highpass2-_)/(t.highpass2-t.highpass1+1e-20)):1,l=t.lowpass2>t.lowpass1?p((_-t.lowpass1)/(t.lowpass2-t.lowpass1+1e-20)):1,t.amp_filter[n]=o*l}}(e),w.samplerate_index=d(e.out_samplerate,e),w.samplerate_index<0)return e.internal_flags=null,-1;if(e.VBR==Qt.vbr_off){if(e.free_format)w.bitrate_index=0;else if(e.brate=b(e.brate,e.version,e.out_samplerate),w.bitrate_index=g(e.brate,e.version,e.out_samplerate),w.bitrate_index<=0)return e.internal_flags=null,-1}else w.bitrate_index=1;e.analysis&&(e.bWriteVbrTag=!1),null!=w.pinfo&&(e.bWriteVbrTag=!1),a.init_bit_stream_w(w);for(var T,B=w.samplerate_index+3*e.version+6*(e.out_samplerate<16e3?1:0),x=0;x<fa.SBMAX_l+1;x++)w.scalefac_band.l[x]=r.sfBandIndex[B].l[x];for(x=0;x<fa.PSFB21+1;x++){var P=(w.scalefac_band.l[22]-w.scalefac_band.l[21])/fa.PSFB21,I=w.scalefac_band.l[21]+x*P;w.scalefac_band.psfb21[x]=I}w.scalefac_band.psfb21[fa.PSFB21]=576;for(x=0;x<fa.SBMAX_s+1;x++)w.scalefac_band.s[x]=r.sfBandIndex[B].s[x];for(x=0;x<fa.PSFB12+1;x++){P=(w.scalefac_band.s[13]-w.scalefac_band.s[12])/fa.PSFB12,I=w.scalefac_band.s[12]+x*P;w.scalefac_band.psfb12[x]=I}for(w.scalefac_band.psfb12[fa.PSFB12]=192,1==e.version?w.sideinfo_len=1==w.channels_out?21:36:w.sideinfo_len=1==w.channels_out?13:21,e.error_protection&&(w.sideinfo_len+=2),function(e){var t=e.internal_flags;e.frameNum=0,e.write_id3tag_automatic&&l.id3tag_write_v2(e),t.bitrate_stereoMode_Hist=ta([16,5]),t.bitrate_blockType_Hist=ta([16,6]),t.PeakSample=0,e.bWriteVbrTag&&o.InitVbrTag(e)}(e),w.Class_ID=m,T=0;T<19;T++)w.nsPsy.pefirbuf[T]=700*w.mode_gr*w.channels_out;switch(-1==e.ATHtype&&(e.ATHtype=4),sa(e.VBR_q<=9),sa(e.VBR_q>=0),e.VBR){case Qt.vbr_mt:e.VBR=Qt.vbr_mtrh;case Qt.vbr_mtrh:null==e.useTemporal&&(e.useTemporal=!1),s.apply_preset(e,500-10*e.VBR_q,0),e.quality<0&&(e.quality=LAME_DEFAULT_QUALITY),e.quality<5&&(e.quality=0),e.quality>5&&(e.quality=5),w.PSY.mask_adjust=e.maskingadjust,w.PSY.mask_adjust_short=e.maskingadjust_short,e.experimentalY?w.sfb21_extra=!1:w.sfb21_extra=e.out_samplerate>44e3,w.iteration_loop=new VBRNewIterationLoop(n);break;case Qt.vbr_rh:s.apply_preset(e,500-10*e.VBR_q,0),w.PSY.mask_adjust=e.maskingadjust,w.PSY.mask_adjust_short=e.maskingadjust_short,e.experimentalY?w.sfb21_extra=!1:w.sfb21_extra=e.out_samplerate>44e3,e.quality>6&&(e.quality=6),e.quality<0&&(e.quality=LAME_DEFAULT_QUALITY),w.iteration_loop=new VBROldIterationLoop(n);break;default:var L;w.sfb21_extra=!1,e.quality<0&&(e.quality=LAME_DEFAULT_QUALITY),(L=e.VBR)==Qt.vbr_off&&(e.VBR_mean_bitrate_kbps=e.brate),s.apply_preset(e,e.VBR_mean_bitrate_kbps,0),e.VBR=L,w.PSY.mask_adjust=e.maskingadjust,w.PSY.mask_adjust_short=e.maskingadjust_short,L==Qt.vbr_off?w.iteration_loop=new _a(n):w.iteration_loop=new ABRIterationLoop(n)}if(sa(e.scale>=0),e.VBR!=Qt.vbr_off){if(w.VBR_min_bitrate=1,w.VBR_max_bitrate=14,e.out_samplerate<16e3&&(w.VBR_max_bitrate=8),0!=e.VBR_min_bitrate_kbps&&(e.VBR_min_bitrate_kbps=b(e.VBR_min_bitrate_kbps,e.version,e.out_samplerate),w.VBR_min_bitrate=g(e.VBR_min_bitrate_kbps,e.version,e.out_samplerate),w.VBR_min_bitrate<0))return-1;if(0!=e.VBR_max_bitrate_kbps&&(e.VBR_max_bitrate_kbps=b(e.VBR_max_bitrate_kbps,e.version,e.out_samplerate),w.VBR_max_bitrate=g(e.VBR_max_bitrate_kbps,e.version,e.out_samplerate),w.VBR_max_bitrate<0))return-1;e.VBR_min_bitrate_kbps=ua.bitrate_table[e.version][w.VBR_min_bitrate],e.VBR_max_bitrate_kbps=ua.bitrate_table[e.version][w.VBR_max_bitrate],e.VBR_mean_bitrate_kbps=Math.min(ua.bitrate_table[e.version][w.VBR_max_bitrate],e.VBR_mean_bitrate_kbps),e.VBR_mean_bitrate_kbps=Math.max(ua.bitrate_table[e.version][w.VBR_min_bitrate],e.VBR_mean_bitrate_kbps)}return e.tune&&(w.PSY.mask_adjust+=e.tune_value_a,w.PSY.mask_adjust_short+=e.tune_value_a),function(e){var t=e.internal_flags;switch(e.quality){default:case 9:t.psymodel=0,t.noise_shaping=0,t.noise_shaping_amp=0,t.noise_shaping_stop=0,t.use_best_huffman=0,t.full_outer_loop=0;break;case 8:e.quality=7;case 7:t.psymodel=1,t.noise_shaping=0,t.noise_shaping_amp=0,t.noise_shaping_stop=0,t.use_best_huffman=0,t.full_outer_loop=0;break;case 6:case 5:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=0,t.noise_shaping_stop=0,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=0,t.full_outer_loop=0;break;case 4:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=0,t.noise_shaping_stop=0,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 3:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),t.noise_shaping_amp=1,t.noise_shaping_stop=1,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 2:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),0==t.substep_shaping&&(t.substep_shaping=2),t.noise_shaping_amp=1,t.noise_shaping_stop=1,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0;break;case 1:case 0:t.psymodel=1,0==t.noise_shaping&&(t.noise_shaping=1),0==t.substep_shaping&&(t.substep_shaping=2),t.noise_shaping_amp=2,t.noise_shaping_stop=1,-1==t.subblock_gain&&(t.subblock_gain=1),t.use_best_huffman=1,t.full_outer_loop=0}}(e),sa(e.scale>=0),e.athaa_type<0?w.ATH.useAdjust=3:w.ATH.useAdjust=e.athaa_type,w.ATH.aaSensitivityP=Math.pow(10,e.athaa_sensitivity/-10),null==e.short_blocks&&(e.short_blocks=Jt.short_block_allowed),e.short_blocks!=Jt.short_block_allowed||e.mode!=MPEGMode.JOINT_STEREO&&e.mode!=MPEGMode.STEREO||(e.short_blocks=Jt.short_block_coupled),e.quant_comp<0&&(e.quant_comp=1),e.quant_comp_short<0&&(e.quant_comp_short=0),e.msfix<0&&(e.msfix=0),e.exp_nspsytune=1|e.exp_nspsytune,e.internal_flags.nsPsy.attackthre<0&&(e.internal_flags.nsPsy.attackthre=ra.NSATTACKTHRE),e.internal_flags.nsPsy.attackthre_s<0&&(e.internal_flags.nsPsy.attackthre_s=ra.NSATTACKTHRE_S),sa(e.scale>=0),e.scale<0&&(e.scale=1),e.ATHtype<0&&(e.ATHtype=4),e.ATHcurve<0&&(e.ATHcurve=4),e.athaa_loudapprox<0&&(e.athaa_loudapprox=2),e.interChRatio<0&&(e.interChRatio=0),null==e.useTemporal&&(e.useTemporal=!0),w.slot_lag=w.frac_SpF=0,e.VBR==Qt.vbr_off&&(w.slot_lag=w.frac_SpF=72e3*(e.version+1)*e.brate%e.out_samplerate|0),r.iteration_init(e),c.psymodel_init(e),sa(e.scale>=0),0},this.lame_encode_flush=function(e,t,s,r){var n,i,o,_,c=e.internal_flags,u=aa([2,1152]),f=0,h=c.mf_samples_to_encode-fa.POSTDELAY,m=S(e);if(c.mf_samples_to_encode<1)return 0;for(n=0,e.in_samplerate!=e.out_samplerate&&(h+=16*e.out_samplerate/e.in_samplerate),(o=e.framesize-h%e.framesize)<576&&(o+=e.framesize),e.encoder_padding=o,_=(h+o)/e.framesize;_>0&&f>=0;){var p=m-c.mf_size,d=e.frameNum;p*=e.in_samplerate,(p/=e.out_samplerate)>1152&&(p=1152),p<1&&(p=1),i=r-n,0==r&&(i=0),s+=f=this.lame_encode_buffer(e,u[0],u[1],p,t,s,i),n+=f,_-=d!=e.frameNum?1:0}if(c.mf_samples_to_encode=0,f<0)return f;if(i=r-n,0==r&&(i=0),a.flush_bitstream(e),(f=a.copy_buffer(c,t,s,i,1))<0)return f;if(s+=f,i=r-(n+=f),0==r&&(i=0),e.write_id3tag_automatic){if(l.id3tag_write_v1(e),(f=a.copy_buffer(c,t,s,i,0))<0)return f;n+=f}return n},this.lame_encode_buffer=function(e,s,r,n,i,o,l){var _=e.internal_flags,c=[null,null];if(_.Class_ID!=m)return-3;if(0==n)return 0;!function(e,t){(null==e.in_buffer_0||e.in_buffer_nsamples<t)&&(e.in_buffer_0=ea(t),e.in_buffer_1=ea(t),e.in_buffer_nsamples=t)}(_,n),c[0]=_.in_buffer_0,c[1]=_.in_buffer_1;for(var u=0;u<n;u++)c[0][u]=s[u],_.channels_in>1&&(c[1][u]=r[u]);return function(e,s,r,n,i,o,l){var _,c,u,f,h,p=e.internal_flags,d=0,b=[null,null],g=[null,null];if(p.Class_ID!=m)return-3;if(0==n)return 0;if(h=a.copy_buffer(p,i,o,l,0),h<0)return h;if(o+=h,d+=h,g[0]=s,g[1]=r,ca.NEQ(e.scale,0)&&ca.NEQ(e.scale,1))for(c=0;c<n;++c)g[0][c]*=e.scale,2==p.channels_out&&(g[1][c]*=e.scale);if(ca.NEQ(e.scale_left,0)&&ca.NEQ(e.scale_left,1))for(c=0;c<n;++c)g[0][c]*=e.scale_left;if(ca.NEQ(e.scale_right,0)&&ca.NEQ(e.scale_right,1))for(c=0;c<n;++c)g[1][c]*=e.scale_right;if(2==e.num_channels&&1==p.channels_out)for(c=0;c<n;++c)g[0][c]=.5*(g[0][c]+g[1][c]),g[1][c]=0;f=S(e),b[0]=p.mfbuf[0],b[1]=p.mfbuf[1];var v=0;for(;n>0;){var A=[null,null],R=0,E=0;A[0]=g[0],A[1]=g[1];var y=new M;if(k(e,b,A,v,n,y),R=y.n_in,E=y.n_out,p.findReplayGain&&!p.decode_on_the_fly&&t.AnalyzeSamples(p.rgdata,b[0],p.mf_size,b[1],p.mf_size,E,p.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6;if(n-=R,v+=R,p.channels_out,p.mf_size+=E,sa(p.mf_size<=ia.MFSIZE),p.mf_samples_to_encode<1&&(p.mf_samples_to_encode=fa.ENCDELAY+fa.POSTDELAY),p.mf_samples_to_encode+=E,p.mf_size>=f){var T=l-d;if(0==l&&(T=0),(_=w(e,b[0],b[1],i,o,T))<0)return _;for(o+=_,d+=_,p.mf_size-=e.framesize,p.mf_samples_to_encode-=e.framesize,u=0;u<p.channels_out;u++)for(c=0;c<p.mf_size;c++)b[u][c]=b[u][c+e.framesize]}}return d}(e,c[0],c[1],n,i,o,l)}},ma=W.VbrMode;var pa=function(){function e(e,t,a,s,r,n,i,o,l,_,c,u,f,h,m){this.vbr_q=e,this.quant_comp=t,this.quant_comp_s=a,this.expY=s,this.st_lrm=r,this.st_s=n,this.masking_adj=i,this.masking_adj_short=o,this.ath_lower=l,this.ath_curve=_,this.ath_sensitivity=c,this.interch=u,this.safejoint=f,this.sfb21mod=h,this.msfix=m}function t(e,t,a,s,r,n,i,o,l,_,c,u,f,h){this.quant_comp=t,this.quant_comp_s=a,this.safejoint=s,this.nsmsfix=r,this.st_lrm=n,this.st_s=i,this.nsbass=o,this.scale=l,this.masking_adj=_,this.ath_lower=c,this.ath_curve=u,this.interch=f,this.sfscale=h}var a;this.setModules=function(e){a=e};var s=[new e(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,.97),new e(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new e(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new e(4,9,9,1,6,135,-.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new e(5,9,9,1,6.4,140,.5,.4,-7.5,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,6.6,145,.67,.65,-14.7,6.5,-19,4e-4,0,0,2.3),new e(7,9,9,1,6.6,145,.8,.75,-19.7,8,-22,6e-4,0,0,2.7),new e(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,7e-4,0,0,0),new e(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,8e-4,0,0,0),new e(10,9,9,1,6.6,145,2,2,-36,12,-25,8e-4,0,0,0)],r=[new e(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,.97),new e(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new e(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new e(4,9,9,1,4.2,25,-2.2,.1,0,3.5,-8,0,2,0,1.79),new e(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,2e-4,0,0,1.95),new e(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,4e-4,0,0,2),new e(7,9,9,1,4.2,25,.5,2,-14.5,8,-22,6e-4,0,0,2),new e(8,9,9,1,4.2,25,1,2.4,-22,10,-23,7e-4,0,0,2),new e(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,8e-4,0,0,2),new e(10,9,9,1,4.2,25,2,2.95,-36,12,-30,8e-4,0,0,2)];function n(e,t,a){var n=e.VBR==ma.vbr_rh?s:r,i=e.VBR_q_frac,o=n[t],l=n[t+1],_=o;o.st_lrm=o.st_lrm+i*(l.st_lrm-o.st_lrm),o.st_s=o.st_s+i*(l.st_s-o.st_s),o.masking_adj=o.masking_adj+i*(l.masking_adj-o.masking_adj),o.masking_adj_short=o.masking_adj_short+i*(l.masking_adj_short-o.masking_adj_short),o.ath_lower=o.ath_lower+i*(l.ath_lower-o.ath_lower),o.ath_curve=o.ath_curve+i*(l.ath_curve-o.ath_curve),o.ath_sensitivity=o.ath_sensitivity+i*(l.ath_sensitivity-o.ath_sensitivity),o.interch=o.interch+i*(l.interch-o.interch),o.msfix=o.msfix+i*(l.msfix-o.msfix),function(e,t){var a=0;0>t&&(a=-1,t=0);9<t&&(a=-1,t=9);e.VBR_q=t,e.VBR_q_frac=0}(e,_.vbr_q),0!=a?e.quant_comp=_.quant_comp:Math.abs(e.quant_comp- -1)>0||(e.quant_comp=_.quant_comp),0!=a?e.quant_comp_short=_.quant_comp_s:Math.abs(e.quant_comp_short- -1)>0||(e.quant_comp_short=_.quant_comp_s),0!=_.expY&&(e.experimentalY=0!=_.expY),0!=a?e.internal_flags.nsPsy.attackthre=_.st_lrm:Math.abs(e.internal_flags.nsPsy.attackthre- -1)>0||(e.internal_flags.nsPsy.attackthre=_.st_lrm),0!=a?e.internal_flags.nsPsy.attackthre_s=_.st_s:Math.abs(e.internal_flags.nsPsy.attackthre_s- -1)>0||(e.internal_flags.nsPsy.attackthre_s=_.st_s),0!=a?e.maskingadjust=_.masking_adj:Math.abs(e.maskingadjust-0)>0||(e.maskingadjust=_.masking_adj),0!=a?e.maskingadjust_short=_.masking_adj_short:Math.abs(e.maskingadjust_short-0)>0||(e.maskingadjust_short=_.masking_adj_short),0!=a?e.ATHlower=-_.ath_lower/10:Math.abs(10*-e.ATHlower-0)>0||(e.ATHlower=-_.ath_lower/10),0!=a?e.ATHcurve=_.ath_curve:Math.abs(e.ATHcurve- -1)>0||(e.ATHcurve=_.ath_curve),0!=a?e.athaa_sensitivity=_.ath_sensitivity:Math.abs(e.athaa_sensitivity- -1)>0||(e.athaa_sensitivity=_.ath_sensitivity),_.interch>0&&(0!=a?e.interChRatio=_.interch:Math.abs(e.interChRatio- -1)>0||(e.interChRatio=_.interch)),_.safejoint>0&&(e.exp_nspsytune=e.exp_nspsytune|_.safejoint),_.sfb21mod>0&&(e.exp_nspsytune=e.exp_nspsytune|_.sfb21mod<<20),0!=a?e.msfix=_.msfix:Math.abs(e.msfix- -1)>0||(e.msfix=_.msfix),0==a&&(e.VBR_q=t,e.VBR_q_frac=i)}var i=[new t(8,9,9,0,0,6.6,145,0,.95,0,-30,11,.0012,1),new t(16,9,9,0,0,6.6,145,0,.95,0,-25,11,.001,1),new t(24,9,9,0,0,6.6,145,0,.95,0,-20,11,.001,1),new t(32,9,9,0,0,6.6,145,0,.95,0,-15,11,.001,1),new t(40,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new t(48,9,9,0,0,6.6,145,0,.95,0,-10,11,9e-4,1),new t(56,9,9,0,0,6.6,145,0,.95,0,-6,11,8e-4,1),new t(64,9,9,0,0,6.6,145,0,.95,0,-2,11,8e-4,1),new t(80,9,9,0,0,6.6,145,0,.95,0,0,8,7e-4,1),new t(96,9,9,0,2.5,6.6,145,0,.95,0,1,5.5,6e-4,1),new t(112,9,9,0,2.25,6.6,145,0,.95,0,2,4.5,5e-4,1),new t(128,9,9,0,1.95,6.4,140,0,.95,0,3,4,2e-4,1),new t(160,9,9,1,1.79,6,135,0,.95,-2,5,3.5,0,1),new t(192,9,9,1,1.49,5.6,125,0,.97,-4,7,3,0,0),new t(224,9,9,1,1.25,5.2,125,0,.98,-6,9,2,0,0),new t(256,9,9,1,.97,5.2,125,0,1,-8,10,1,0,0),new t(320,9,9,1,.9,5.2,125,0,1,-10,12,0,0,0)];function o(e,t,s){var r=t,n=a.nearestBitrateFullIndex(t);if(e.VBR=ma.vbr_abr,e.VBR_mean_bitrate_kbps=r,e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,320),e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,8),e.brate=e.VBR_mean_bitrate_kbps,e.VBR_mean_bitrate_kbps>320&&(e.disable_reservoir=!0),i[n].safejoint>0&&(e.exp_nspsytune=2|e.exp_nspsytune),i[n].sfscale>0&&(e.internal_flags.noise_shaping=2),Math.abs(i[n].nsbass)>0){var o=int(4*i[n].nsbass);o<0&&(o+=64),e.exp_nspsytune=e.exp_nspsytune|o<<2}return 0!=s?e.quant_comp=i[n].quant_comp:Math.abs(e.quant_comp- -1)>0||(e.quant_comp=i[n].quant_comp),0!=s?e.quant_comp_short=i[n].quant_comp_s:Math.abs(e.quant_comp_short- -1)>0||(e.quant_comp_short=i[n].quant_comp_s),0!=s?e.msfix=i[n].nsmsfix:Math.abs(e.msfix- -1)>0||(e.msfix=i[n].nsmsfix),0!=s?e.internal_flags.nsPsy.attackthre=i[n].st_lrm:Math.abs(e.internal_flags.nsPsy.attackthre- -1)>0||(e.internal_flags.nsPsy.attackthre=i[n].st_lrm),0!=s?e.internal_flags.nsPsy.attackthre_s=i[n].st_s:Math.abs(e.internal_flags.nsPsy.attackthre_s- -1)>0||(e.internal_flags.nsPsy.attackthre_s=i[n].st_s),0!=s?e.scale=i[n].scale:Math.abs(e.scale- -1)>0||(e.scale=i[n].scale),0!=s?e.maskingadjust=i[n].masking_adj:Math.abs(e.maskingadjust-0)>0||(e.maskingadjust=i[n].masking_adj),i[n].masking_adj>0?0!=s?e.maskingadjust_short=.9*i[n].masking_adj:Math.abs(e.maskingadjust_short-0)>0||(e.maskingadjust_short=.9*i[n].masking_adj):0!=s?e.maskingadjust_short=1.1*i[n].masking_adj:Math.abs(e.maskingadjust_short-0)>0||(e.maskingadjust_short=1.1*i[n].masking_adj),0!=s?e.ATHlower=-i[n].ath_lower/10:Math.abs(10*-e.ATHlower-0)>0||(e.ATHlower=-i[n].ath_lower/10),0!=s?e.ATHcurve=i[n].ath_curve:Math.abs(e.ATHcurve- -1)>0||(e.ATHcurve=i[n].ath_curve),0!=s?e.interChRatio=i[n].interch:Math.abs(e.interChRatio- -1)>0||(e.interChRatio=i[n].interch),t}this.apply_preset=function(e,t,a){switch(t){case Lame.R3MIX:t=Lame.V3,e.VBR=ma.vbr_mtrh;break;case Lame.MEDIUM:t=Lame.V4,e.VBR=ma.vbr_rh;break;case Lame.MEDIUM_FAST:t=Lame.V4,e.VBR=ma.vbr_mtrh;break;case Lame.STANDARD:t=Lame.V2,e.VBR=ma.vbr_rh;break;case Lame.STANDARD_FAST:t=Lame.V2,e.VBR=ma.vbr_mtrh;break;case Lame.EXTREME:t=Lame.V0,e.VBR=ma.vbr_rh;break;case Lame.EXTREME_FAST:t=Lame.V0,e.VBR=ma.vbr_mtrh;break;case Lame.INSANE:return t=320,e.preset=t,o(e,t,a),e.VBR=ma.vbr_off,t}switch(e.preset=t,t){case Lame.V9:return n(e,9,a),t;case Lame.V8:return n(e,8,a),t;case Lame.V7:return n(e,7,a),t;case Lame.V6:return n(e,6,a),t;case Lame.V5:return n(e,5,a),t;case Lame.V4:return n(e,4,a),t;case Lame.V3:return n(e,3,a),t;case Lame.V2:return n(e,2,a),t;case Lame.V1:return n(e,1,a),t;case Lame.V0:return n(e,0,a),t}return 8<=t&&t<=320?o(e,t,a):(e.preset=0,t)}};var da=W.new_float,ba=W.new_int;var ga=W.System,va=W.VbrMode,Sa=W.Util,wa=W.Arrays,Ma=W.new_float,Aa=W.assert,Ra=function(){this.setModules=function(e,t){}},Ea=function(){this.over_noise=0,this.tot_noise=0,this.max_noise=0,this.over_count=0,this.over_SSD=0,this.bits=0},ya=function(){this.global_gain=0,this.sfb_count1=0,this.step=ba(39),this.noise=da(39),this.noise_log=da(39)},ka=Z(),Ta=Me,Ba=ge;var xa=function(){var e,t,a;this.rv=null,this.qupvt=null;var s,r=new Ra;function n(e){this.ordinal=e}function i(e){for(var t=0;t<e.sfbmax;t++)if(e.scalefac[t]+e.subblock_gain[e.window[t]]==0)return!1;return!0}function o(e){return Sa.FAST_LOG10(.368+.632*e*e*e)}function l(e,t,a,s,r){var n;switch(e){default:case 9:t.over_count>0?(n=a.over_SSD<=t.over_SSD,a.over_SSD==t.over_SSD&&(n=a.bits<t.bits)):n=a.max_noise<0&&10*a.max_noise+a.bits<=10*t.max_noise+t.bits;break;case 0:n=a.over_count<t.over_count||a.over_count==t.over_count&&a.over_noise<t.over_noise||a.over_count==t.over_count&&BitStream.EQ(a.over_noise,t.over_noise)&&a.tot_noise<t.tot_noise;break;case 8:a.max_noise=function(e,t){for(var a=1e-37,s=0;s<t.psymax;s++)a+=o(e[s]);return Math.max(1e-20,a)}(r,s);case 1:n=a.max_noise<t.max_noise;break;case 2:n=a.tot_noise<t.tot_noise;break;case 3:n=a.tot_noise<t.tot_noise&&a.max_noise<t.max_noise;break;case 4:n=a.max_noise<=0&&t.max_noise>.2||a.max_noise<=0&&t.max_noise<0&&t.max_noise>a.max_noise-.2&&a.tot_noise<t.tot_noise||a.max_noise<=0&&t.max_noise>0&&t.max_noise>a.max_noise-.2&&a.tot_noise<t.tot_noise+t.over_noise||a.max_noise>0&&t.max_noise>-.05&&t.max_noise>a.max_noise-.1&&a.tot_noise+a.over_noise<t.tot_noise+t.over_noise||a.max_noise>0&&t.max_noise>-.1&&t.max_noise>a.max_noise-.15&&a.tot_noise+a.over_noise+a.over_noise<t.tot_noise+t.over_noise+t.over_noise;break;case 5:n=a.over_noise<t.over_noise||BitStream.EQ(a.over_noise,t.over_noise)&&a.tot_noise<t.tot_noise;break;case 6:n=a.over_noise<t.over_noise||BitStream.EQ(a.over_noise,t.over_noise)&&(a.max_noise<t.max_noise||BitStream.EQ(a.max_noise,t.max_noise)&&a.tot_noise<=t.tot_noise);break;case 7:n=a.over_count<t.over_count||a.over_noise<t.over_noise}return 0==t.over_count&&(n=n&&a.bits<t.bits),n}function _(e,t,r,n,o){var l=e.internal_flags;!function(e,t,a,s,r){var n,i=e.internal_flags;n=0==t.scalefac_scale?1.2968395546510096:1.6817928305074292;for(var o=0,l=0;l<t.sfbmax;l++)o<a[l]&&(o=a[l]);var _=i.noise_shaping_amp;switch(3==_&&(_=r?2:1),_){case 2:break;case 1:o>1?o=Math.pow(o,.5):o*=.95;break;default:o>1?o=1:o*=.95}var c=0;for(l=0;l<t.sfbmax;l++){var u,f=t.width[l];if(c+=f,!(a[l]<o)){if(2&i.substep_shaping&&(i.pseudohalf[l]=0==i.pseudohalf[l]?1:0,0==i.pseudohalf[l]&&2==i.noise_shaping_amp))return;for(t.scalefac[l]++,u=-f;u<0;u++)s[c+u]*=n,s[c+u]>t.xrpow_max&&(t.xrpow_max=s[c+u]);if(2==i.noise_shaping_amp)return}}}(e,t,r,n,o);var _=i(t);return!_&&(!(_=2==l.mode_gr?s.scale_bitcount(t):s.scale_bitcount_lsf(l,t))||(l.noise_shaping>1&&(wa.fill(l.pseudohalf,0),0==t.scalefac_scale?(!function(e,t){for(var s=0,r=0;r<e.sfbmax;r++){var n=e.width[r],i=e.scalefac[r];if(0!=e.preflag&&(i+=a.pretab[r]),s+=n,1&i){i++;for(var o=-n;o<0;o++)t[s+o]*=1.2968395546510096,t[s+o]>e.xrpow_max&&(e.xrpow_max=t[s+o])}e.scalefac[r]=i>>1}e.preflag=0,e.scalefac_scale=1}(t,n),_=!1):t.block_type==ka.SHORT_TYPE&&l.subblock_gain>0&&(_=function(e,t,s){var r,n=t.scalefac;for(r=0;r<t.sfb_lmax;r++)if(n[r]>=16)return!0;for(var i=0;i<3;i++){var o=0,l=0;for(r=t.sfb_lmax+i;r<t.sfbdivide;r+=3)o<n[r]&&(o=n[r]);for(;r<t.sfbmax;r+=3)l<n[r]&&(l=n[r]);if(!(o<16&&l<8)){if(t.subblock_gain[i]>=7)return!0;t.subblock_gain[i]++;var _=e.scalefac_band.l[t.sfb_lmax];for(r=t.sfb_lmax+i;r<t.sfbmax;r+=3){var c=t.width[r],u=n[r];if((u-=4>>t.scalefac_scale)>=0)n[r]=u,_+=3*c;else{n[r]=0;var f=210+(u<<t.scalefac_scale+1);m=a.IPOW20(f),_+=c*(i+1);for(var h=-c;h<0;h++)s[_+h]*=m,s[_+h]>t.xrpow_max&&(t.xrpow_max=s[_+h]);_+=c*(3-i-1)}}var m=a.IPOW20(202);for(_+=t.width[r]*(i+1),h=-t.width[r];h<0;h++)s[_+h]*=m,s[_+h]>t.xrpow_max&&(t.xrpow_max=s[_+h])}}return!1}(l,t,n)||i(t))),_||(_=2==l.mode_gr?s.scale_bitcount(t):s.scale_bitcount_lsf(l,t)),!_))}this.setModules=function(n,i,o,l){e=n,t=i,this.rv=i,a=o,this.qupvt=o,s=l,r.setModules(a,s)},this.ms_convert=function(e,t){for(var a=0;a<576;++a){var s=e.tt[t][0].xr[a],r=e.tt[t][1].xr[a];e.tt[t][0].xr[a]=(s+r)*(.5*Sa.SQRT2),e.tt[t][1].xr[a]=(s-r)*(.5*Sa.SQRT2)}},this.init_xrpow=function(e,t,a){var s=0,r=0|t.max_nonzero_coeff;if(t.xrpow_max=0,wa.fill(a,r,576,0),s=function(e,t,a,s){s=0;for(var r=0;r<=a;++r){var n=Math.abs(e.xr[r]);s+=n,t[r]=Math.sqrt(n*Math.sqrt(n)),t[r]>e.xrpow_max&&(e.xrpow_max=t[r])}return s}(t,a,r,s),s>1e-20){var n=0;2&e.substep_shaping&&(n=1);for(var i=0;i<t.psymax;i++)e.pseudohalf[i]=n;return!0}return wa.fill(t.l3_enc,0,576,0),!1},this.init_outer_loop=function(e,t){t.part2_3_length=0,t.big_values=0,t.count1=0,t.global_gain=210,t.scalefac_compress=0,t.table_select[0]=0,t.table_select[1]=0,t.table_select[2]=0,t.subblock_gain[0]=0,t.subblock_gain[1]=0,t.subblock_gain[2]=0,t.subblock_gain[3]=0,t.region0_count=0,t.region1_count=0,t.preflag=0,t.scalefac_scale=0,t.count1table_select=0,t.part2_length=0,t.sfb_lmax=ka.SBPSY_l,t.sfb_smin=ka.SBPSY_s,t.psy_lmax=e.sfb21_extra?ka.SBMAX_l:ka.SBPSY_l,t.psymax=t.psy_lmax,t.sfbmax=t.sfb_lmax,t.sfbdivide=11;for(var s=0;s<ka.SBMAX_l;s++)t.width[s]=e.scalefac_band.l[s+1]-e.scalefac_band.l[s],t.window[s]=3;if(t.block_type==ka.SHORT_TYPE){var r=Ma(576);t.sfb_smin=0,t.sfb_lmax=0,0!=t.mixed_block_flag&&(t.sfb_smin=3,t.sfb_lmax=2*e.mode_gr+4),t.psymax=t.sfb_lmax+3*((e.sfb21_extra?ka.SBMAX_s:ka.SBPSY_s)-t.sfb_smin),t.sfbmax=t.sfb_lmax+3*(ka.SBPSY_s-t.sfb_smin),t.sfbdivide=t.sfbmax-18,t.psy_lmax=t.sfb_lmax;var n=e.scalefac_band.l[t.sfb_lmax];ga.arraycopy(t.xr,0,r,0,576);for(s=t.sfb_smin;s<ka.SBMAX_s;s++)for(var i=e.scalefac_band.s[s],o=e.scalefac_band.s[s+1],l=0;l<3;l++)for(var _=i;_<o;_++)t.xr[n++]=r[3*_+l];var c=t.sfb_lmax;for(s=t.sfb_smin;s<ka.SBMAX_s;s++)t.width[c]=t.width[c+1]=t.width[c+2]=e.scalefac_band.s[s+1]-e.scalefac_band.s[s],t.window[c]=0,t.window[c+1]=1,t.window[c+2]=2,c+=3}t.count1bits=0,t.sfb_partition_table=a.nr_of_sfb_block[0][0],t.slen[0]=0,t.slen[1]=0,t.slen[2]=0,t.slen[3]=0,t.max_nonzero_coeff=575,wa.fill(t.scalefac,0),function(e,t){var s=e.ATH,r=t.xr;if(t.block_type!=ka.SHORT_TYPE)for(var n=!1,i=ka.PSFB21-1;i>=0&&!n;i--){var o=e.scalefac_band.psfb21[i],l=e.scalefac_band.psfb21[i+1],_=a.athAdjust(s.adjust,s.psfb21[i],s.floor);e.nsPsy.longfact[21]>1e-12&&(_*=e.nsPsy.longfact[21]);for(var c=l-1;c>=o;c--){if(!(Math.abs(r[c])<_)){n=!0;break}r[c]=0}}else for(var u=0;u<3;u++)for(n=!1,i=ka.PSFB12-1;i>=0&&!n;i--){l=(o=3*e.scalefac_band.s[12]+(e.scalefac_band.s[13]-e.scalefac_band.s[12])*u+(e.scalefac_band.psfb12[i]-e.scalefac_band.psfb12[0]))+(e.scalefac_band.psfb12[i+1]-e.scalefac_band.psfb12[i]);var f=a.athAdjust(s.adjust,s.psfb12[i],s.floor);for(e.nsPsy.shortfact[12]>1e-12&&(f*=e.nsPsy.shortfact[12]),c=l-1;c>=o;c--){if(!(Math.abs(r[c])<f)){n=!0;break}r[c]=0}}}(e,t)},n.BINSEARCH_NONE=new n(0),n.BINSEARCH_UP=new n(1),n.BINSEARCH_DOWN=new n(2),this.trancate_smallspectrums=function(e,t,r,n){var i=Ma(Ba.SFBMAX);if((4&e.substep_shaping||t.block_type!=ka.SHORT_TYPE)&&!(128&e.substep_shaping)){a.calc_noise(t,r,i,new Ea,null);for(var o=0;o<576;o++){var l=0;0!=t.l3_enc[o]&&(l=Math.abs(t.xr[o])),n[o]=l}o=0;var _=8;t.block_type==ka.SHORT_TYPE&&(_=6);do{var c,u,f,h,m=t.width[_];if(o+=m,!(i[_]>=1||(wa.sort(n,o-m,m),BitStream.EQ(n[o-1],0)))){c=(1-i[_])*r[_],u=0,h=0;do{var p;for(f=1;h+f<m&&!BitStream.NEQ(n[h+o-m],n[h+o+f-m]);f++);if(c<(p=n[h+o-m]*n[h+o-m]*f)){0!=h&&(u=n[h+o-m-1]);break}c-=p,h+=f}while(h<m);if(!BitStream.EQ(u,0))do{Math.abs(t.xr[o-m])<=u&&(t.l3_enc[o-m]=0)}while(--m>0)}}while(++_<t.psymax);t.part2_3_length=s.noquant_count_bits(e,t,null)}},this.outer_loop=function(e,t,r,i,o,c){var u=e.internal_flags,f=new Ta,h=Ma(576),m=Ma(Ba.SFBMAX),p=new Ea,d=new ya,b=9999999,g=!1,v=!1,S=0;if(function(e,t,a,r,i){var o,l=e.CurrentStep[r],_=!1,c=e.OldValue[r],u=n.BINSEARCH_NONE;for(t.global_gain=c,a-=t.part2_length;;){var f;if(o=s.count_bits(e,i,t,null),1==l||o==a)break;o>a?(u==n.BINSEARCH_DOWN&&(_=!0),_&&(l/=2),u=n.BINSEARCH_UP,f=l):(u==n.BINSEARCH_UP&&(_=!0),_&&(l/=2),u=n.BINSEARCH_DOWN,f=-l),t.global_gain+=f,t.global_gain<0&&(t.global_gain=0,_=!0),t.global_gain>255&&(t.global_gain=255,_=!0)}for(Aa(t.global_gain>=0),Aa(t.global_gain<256);o>a&&t.global_gain<255;)t.global_gain++,o=s.count_bits(e,i,t,null);e.CurrentStep[r]=c-t.global_gain>=4?4:2,e.OldValue[r]=t.global_gain,t.part2_3_length=o}(u,t,c,o,i),0==u.noise_shaping)return 100;a.calc_noise(t,r,m,p,d),p.bits=t.part2_3_length,f.assign(t);var w=0;for(ga.arraycopy(i,0,h,0,576);!g;){do{var M,A=new Ea,R=255;if(M=2&u.substep_shaping?20:3,u.sfb21_extra){if(m[f.sfbmax]>1)break;if(f.block_type==ka.SHORT_TYPE&&(m[f.sfbmax+1]>1||m[f.sfbmax+2]>1))break}if(!_(e,f,m,i,v))break;0!=f.scalefac_scale&&(R=254);var E=c-f.part2_length;if(E<=0)break;for(;(f.part2_3_length=s.count_bits(u,i,f,d))>E&&f.global_gain<=R;)f.global_gain++;if(f.global_gain>R)break;if(0==p.over_count){for(;(f.part2_3_length=s.count_bits(u,i,f,d))>b&&f.global_gain<=R;)f.global_gain++;if(f.global_gain>R)break}if(a.calc_noise(f,r,m,A,d),A.bits=f.part2_3_length,0!=(l(t.block_type!=ka.SHORT_TYPE?e.quant_comp:e.quant_comp_short,p,A,f,m)?1:0))b=t.part2_3_length,p=A,t.assign(f),w=0,ga.arraycopy(i,0,h,0,576);else if(0==u.full_outer_loop){if(++w>M&&0==p.over_count)break;if(3==u.noise_shaping_amp&&v&&w>30)break;if(3==u.noise_shaping_amp&&v&&f.global_gain-S>15)break}}while(f.global_gain+f.scalefac_scale<255);3==u.noise_shaping_amp?v?g=!0:(f.assign(t),ga.arraycopy(h,0,i,0,576),w=0,S=f.global_gain,v=!0):g=!0}return Aa(t.global_gain+t.scalefac_scale<=255),e.VBR==va.vbr_rh||e.VBR==va.vbr_mtrh?ga.arraycopy(h,0,i,0,576):1&u.substep_shaping&&trancate_smallspectrums(u,t,r,i),p.over_count},this.iteration_finish_one=function(e,a,r){var n=e.l3_side,i=n.tt[a][r];s.best_scalefac_store(e,a,r,n),1==e.use_best_huffman&&s.best_huffman_divide(e,i),t.ResvAdjust(e,i)},this.VBR_encode_granule=function(e,t,a,s,r,n,i){var o,l=e.internal_flags,_=new Ta,c=Ma(576),u=i,f=i+1,h=(i+n)/2,m=0,p=l.sfb21_extra;Aa(u<=LameInternalFlags.MAX_BITS_PER_CHANNEL),wa.fill(_.l3_enc,0);do{l.sfb21_extra=!(h>u-42)&&p,outer_loop(e,t,a,s,r,h)<=0?(m=1,f=t.part2_3_length,_.assign(t),ga.arraycopy(s,0,c,0,576),o=(i=f-32)-n,h=(i+n)/2):(o=i-(n=h+32),h=(i+n)/2,0!=m&&(m=2,t.assign(_),ga.arraycopy(c,0,s,0,576)))}while(o>12);l.sfb21_extra=p,2==m&&ga.arraycopy(_.l3_enc,0,t.l3_enc,0,576),Aa(t.part2_3_length<=u)},this.get_framebits=function(a,s){var r=a.internal_flags;r.bitrate_index=r.VBR_min_bitrate;var n=e.getframebits(a);r.bitrate_index=1,n=e.getframebits(a);for(var i=1;i<=r.VBR_max_bitrate;i++){r.bitrate_index=i;var o=new MeanBits(n);s[i]=t.ResvFrameBegin(a,o),n=o.bits}},this.VBR_old_prepare=function(e,s,r,n,i,o,l,_,c){var u,f=e.internal_flags,h=0,m=1,p=0;f.bitrate_index=f.VBR_max_bitrate;var d=t.ResvFrameBegin(e,new MeanBits(0))/f.mode_gr;get_framebits(e,o);for(var b=0;b<f.mode_gr;b++){var g=a.on_pe(e,s,_[b],d,b,0);f.mode_ext==ka.MPG_MD_MS_LR&&(ms_convert(f.l3_side,b),a.reduce_side(_[b],r[b],d,g));for(var v=0;v<f.channels_out;++v){var S=f.l3_side.tt[b][v];S.block_type!=ka.SHORT_TYPE?(h=1.28/(1+Math.exp(3.5-s[b][v]/300))-.05,u=f.PSY.mask_adjust-h):(h=2.56/(1+Math.exp(3.5-s[b][v]/300))-.14,u=f.PSY.mask_adjust_short-h),f.masking_lower=Math.pow(10,.1*u),init_outer_loop(f,S),c[b][v]=a.calc_xmin(e,n[b][v],S,i[b][v]),0!=c[b][v]&&(m=0),l[b][v]=126,p+=_[b][v]}}for(b=0;b<f.mode_gr;b++)for(v=0;v<f.channels_out;v++)p>o[f.VBR_max_bitrate]&&(_[b][v]*=o[f.VBR_max_bitrate],_[b][v]/=p),l[b][v]>_[b][v]&&(l[b][v]=_[b][v]);return m},this.bitpressure_strategy=function(e,t,a,s){for(var r=0;r<e.mode_gr;r++)for(var n=0;n<e.channels_out;n++){for(var i=e.l3_side.tt[r][n],o=t[r][n],l=0,_=0;_<i.psy_lmax;_++)o[l++]*=1+.029*_*_/ka.SBMAX_l/ka.SBMAX_l;if(i.block_type==ka.SHORT_TYPE)for(_=i.sfb_smin;_<ka.SBMAX_s;_++)o[l++]*=1+.029*_*_/ka.SBMAX_s/ka.SBMAX_s,o[l++]*=1+.029*_*_/ka.SBMAX_s/ka.SBMAX_s,o[l++]*=1+.029*_*_/ka.SBMAX_s/ka.SBMAX_s;s[r][n]=0|Math.max(a[r][n],.9*s[r][n])}},this.VBR_new_prepare=function(e,s,r,n,i,o){var l,_=e.internal_flags,c=1,u=0,f=0;if(e.free_format){_.bitrate_index=0;h=new MeanBits(u);l=t.ResvFrameBegin(e,h),u=h.bits,i[0]=l}else{_.bitrate_index=_.VBR_max_bitrate;var h=new MeanBits(u);t.ResvFrameBegin(e,h),u=h.bits,get_framebits(e,i),l=i[_.VBR_max_bitrate]}for(var m=0;m<_.mode_gr;m++){a.on_pe(e,s,o[m],u,m,0),_.mode_ext==ka.MPG_MD_MS_LR&&ms_convert(_.l3_side,m);for(var p=0;p<_.channels_out;++p){var d=_.l3_side.tt[m][p];_.masking_lower=Math.pow(10,.1*_.PSY.mask_adjust),init_outer_loop(_,d),0!=a.calc_xmin(e,r[m][p],d,n[m][p])&&(c=0),f+=o[m][p]}}for(m=0;m<_.mode_gr;m++)for(p=0;p<_.channels_out;p++)f>l&&(o[m][p]*=l,o[m][p]/=f);return c},this.calc_target_bits=function(s,r,n,i,o,l){var _,c,u,f,h=s.internal_flags,m=h.l3_side,p=0;h.bitrate_index=h.VBR_max_bitrate;var d=new MeanBits(p);for(l[0]=t.ResvFrameBegin(s,d),p=d.bits,h.bitrate_index=1,p=e.getframebits(s)-8*h.sideinfo_len,o[0]=p/(h.mode_gr*h.channels_out),p=s.VBR_mean_bitrate_kbps*s.framesize*1e3,1&h.substep_shaping&&(p*=1.09),p/=s.out_samplerate,p-=8*h.sideinfo_len,p/=h.mode_gr*h.channels_out,(_=.93+.07*(11-s.compression_ratio)/5.5)<.9&&(_=.9),_>1&&(_=1),c=0;c<h.mode_gr;c++){var b=0;for(u=0;u<h.channels_out;u++){if(i[c][u]=int(_*p),r[c][u]>700){var g=int((r[c][u]-700)/1.4),v=m.tt[c][u];i[c][u]=int(_*p),v.block_type==ka.SHORT_TYPE&&g<p/2&&(g=p/2),g>3*p/2?g=3*p/2:g<0&&(g=0),i[c][u]+=g}i[c][u]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(i[c][u]=LameInternalFlags.MAX_BITS_PER_CHANNEL),b+=i[c][u]}if(b>LameInternalFlags.MAX_BITS_PER_GRANULE)for(u=0;u<h.channels_out;++u)i[c][u]*=LameInternalFlags.MAX_BITS_PER_GRANULE,i[c][u]/=b}if(h.mode_ext==ka.MPG_MD_MS_LR)for(c=0;c<h.mode_gr;c++)a.reduce_side(i[c],n[c],p*h.channels_out,LameInternalFlags.MAX_BITS_PER_GRANULE);for(f=0,c=0;c<h.mode_gr;c++)for(u=0;u<h.channels_out;u++)i[c][u]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(i[c][u]=LameInternalFlags.MAX_BITS_PER_CHANNEL),f+=i[c][u];if(f>l[0])for(c=0;c<h.mode_gr;c++)for(u=0;u<h.channels_out;u++)i[c][u]*=l[0],i[c][u]/=f}},Pa=W.assert;var Ia=function(){var e;this.setModules=function(t){e=t},this.ResvFrameBegin=function(t,a){var s,r=t.internal_flags,n=r.l3_side,i=e.getframebits(t);a.bits=(i-8*r.sideinfo_len)/r.mode_gr;var o=2048*r.mode_gr-8;t.brate>320?s=8*int(1e3*t.brate/(t.out_samplerate/1152)/8+.5):(s=11520,t.strict_ISO&&(s=8*int(32e4/(t.out_samplerate/1152)/8+.5))),r.ResvMax=s-i,r.ResvMax>o&&(r.ResvMax=o),(r.ResvMax<0||t.disable_reservoir)&&(r.ResvMax=0);var l=a.bits*r.mode_gr+Math.min(r.ResvSize,r.ResvMax);return l>s&&(l=s),Pa(0==r.ResvMax%8),Pa(r.ResvMax>=0),n.resvDrain_pre=0,null!=r.pinfo&&(r.pinfo.mean_bits=a.bits/2,r.pinfo.resvsize=r.ResvSize),l},this.ResvMaxBits=function(e,t,a,s){var r,n=e.internal_flags,i=n.ResvSize,o=n.ResvMax;0!=s&&(i+=t),1&n.substep_shaping&&(o*=.9),a.bits=t,10*i>9*o?(r=i-9*o/10,a.bits+=r,n.substep_shaping|=128):(r=0,n.substep_shaping&=127,e.disable_reservoir||1&n.substep_shaping||(a.bits-=.1*t));var l=i<6*n.ResvMax/10?i:6*n.ResvMax/10;return(l-=r)<0&&(l=0),l},this.ResvAdjust=function(e,t){e.ResvSize-=t.part2_3_length+t.part2_length},this.ResvFrameEnd=function(e,t){var a,s=e.l3_side;e.ResvSize+=t*e.mode_gr;var r=0;s.resvDrain_post=0,s.resvDrain_pre=0,0!=(a=e.ResvSize%8)&&(r+=a),(a=e.ResvSize-r-e.ResvMax)>0&&(r+=a);var n=Math.min(8*s.main_data_begin,r)/8;s.resvDrain_pre+=8*n,r-=8*n,e.ResvSize-=8*n,s.main_data_begin-=n,s.resvDrain_post+=r,e.ResvSize-=r}};var La=function(){this.getLameVersion=function(){return"3.98.4"},this.getLameShortVersion=function(){return"3.98.4"},this.getLameVeryShortVersion=function(){return"LAME3.98r"},this.getPsyVersion=function(){return"0.93"},this.getLameUrl=function(){return"http://www.mp3dev.org/"},this.getLameOsBitness=function(){return"32bits"}},Ca=W.System,Na=W.VbrMode,Oa=W.ShortBlock,Da=W.Arrays,Ha=W.new_byte,Fa=W.assert;function Va(){var e,t,a;this.setModules=function(s,r,n){e=s,t=r,a=n};var s=Va.NUMTOCENTRIES,r=Va.MAXFRAMESIZE,n=s+4+4+4+4+4+9+1+1+8+1+1+3+1+1+2+4+2+2,i="Xing",o="Info",l=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];function _(e,t){var a=255&e[t+0];return a<<=8,a|=255&e[t+1],a<<=8,a|=255&e[t+2],a<<=8,a|=255&e[t+3]}function c(e,t,a){e[t+0]=255&a>>24,e[t+1]=255&a>>16,e[t+2]=255&a>>8,e[t+3]=255&a}function u(e,t,a){e[t+0]=255&a>>8,e[t+1]=255&a}function f(e,t,a){return 255&(e<<t|a&~(-1<<t))}function h(t,a){var s=t.internal_flags;a[0]=f(a[0],8,255),a[1]=f(a[1],3,7),a[1]=f(a[1],1,t.out_samplerate<16e3?0:1),a[1]=f(a[1],1,t.version),a[1]=f(a[1],2,1),a[1]=f(a[1],1,t.error_protection?0:1),a[2]=f(a[2],4,s.bitrate_index),a[2]=f(a[2],2,s.samplerate_index),a[2]=f(a[2],1,0),a[2]=f(a[2],1,t.extension),a[3]=f(a[3],2,t.mode.ordinal()),a[3]=f(a[3],2,s.mode_ext),a[3]=f(a[3],1,t.copyright),a[3]=f(a[3],1,t.original),a[3]=f(a[3],2,t.emphasis),a[0]=255;var r,n,i=241&a[1];r=1==t.version?128:t.out_samplerate<16e3?32:64,t.VBR==Na.vbr_off&&(r=t.brate),n=t.free_format?0:255&16*e.BitrateIndex(r,t.version,t.out_samplerate),1==t.version?(a[1]=255&i|10,i=13&a[2],a[2]=255&(n|i)):(a[1]=255&i|2,i=13&a[2],a[2]=255&(n|i))}function m(e,t){return t=t>>8^l[255&(t^e)]}this.addVbrFrame=function(e){var t=e.internal_flags,a=Tables.bitrate_table[e.version][t.bitrate_index];Fa(null!=t.VBR_seek_table.bag),function(e,t){if(e.nVbrNumFrames++,e.sum+=t,e.seen++,!(e.seen<e.want)&&(e.pos<e.size&&(e.bag[e.pos]=e.sum,e.pos++,e.seen=0),e.pos==e.size)){for(var a=1;a<e.size;a+=2)e.bag[a/2]=e.bag[a];e.want*=2,e.pos/=2}}(t.VBR_seek_table,a)},this.getVbrTag=function(e){var t=new VBRTagData,a=0;t.flags=0;var r=e[a+1]>>3&1,n=e[a+2]>>2&3,l=e[a+3]>>6&3,c=e[a+2]>>4&15;if(c=Tables.bitrate_table[r][c],e[a+1]>>4==14?t.samprate=Tables.samplerate_table[2][n]:t.samprate=Tables.samplerate_table[r][n],!function(e,t){return new String(e,t,4(),null).equals(i)||new String(e,t,4(),null).equals(o)}(e,a+=0!=r?3!=l?36:21:3!=l?21:13))return null;a+=4,t.hId=r;var u=t.flags=_(e,a);if(a+=4,1&u&&(t.frames=_(e,a),a+=4),2&u&&(t.bytes=_(e,a),a+=4),4&u){if(null!=t.toc)for(var f=0;f<s;f++)t.toc[f]=e[a+f];a+=s}t.vbrScale=-1,8&u&&(t.vbrScale=_(e,a),a+=4),t.headersize=72e3*(r+1)*c/t.samprate;var h=e[(a+=21)+0]<<4;h+=e[a+1]>>4;var m=(15&e[a+1])<<8;return(h<0||h>3e3)&&(h=-1),((m+=255&e[a+2])<0||m>3e3)&&(m=-1),t.encDelay=h,t.encPadding=m,t},this.InitVbrTag=function(e){var a,s=e.internal_flags;a=1==e.version?128:e.out_samplerate<16e3?32:64,e.VBR==Na.vbr_off&&(a=e.brate);var i=72e3*(e.version+1)*a/e.out_samplerate,o=s.sideinfo_len+n;if(s.VBR_seek_table.TotalFrameSize=i,i<o||i>r)e.bWriteVbrTag=!1;else{s.VBR_seek_table.nVbrNumFrames=0,s.VBR_seek_table.nBytesWritten=0,s.VBR_seek_table.sum=0,s.VBR_seek_table.seen=0,s.VBR_seek_table.want=1,s.VBR_seek_table.pos=0,null==s.VBR_seek_table.bag&&(s.VBR_seek_table.bag=new int[400],s.VBR_seek_table.size=400);var l=Ha(r);h(e,l);for(var _=s.VBR_seek_table.TotalFrameSize,c=0;c<_;++c)t.add_dummy_byte(e,255&l[c],1)}},this.updateMusicCRC=function(e,t,a,s){for(var r=0;r<s;++r)e[0]=m(t[a+r],e[0])},this.getLameTagFrame=function(e,r){var n=e.internal_flags;if(!e.bWriteVbrTag)return 0;if(n.Class_ID!=Lame.LAME_ID)return 0;if(n.VBR_seek_table.pos<=0)return 0;if(r.length<n.VBR_seek_table.TotalFrameSize)return n.VBR_seek_table.TotalFrameSize;Da.fill(r,0,n.VBR_seek_table.TotalFrameSize,0),h(e,r);var l=Ha(s);if(e.free_format)for(var _=1;_<s;++_)l[_]=255&255*_/100;else!function(e,t){if(!(e.pos<=0))for(var a=1;a<s;++a){var r=a/s,n=0|Math.floor(r*e.pos);n>e.pos-1&&(n=e.pos-1);var i=0|256*e.bag[n]/e.sum;i>255&&(i=255),t[a]=255&i}}(n.VBR_seek_table,l);var f=n.sideinfo_len;e.error_protection&&(f-=2),e.VBR==Na.vbr_off?(r[f++]=255&o.charAt(0),r[f++]=255&o.charAt(1),r[f++]=255&o.charAt(2),r[f++]=255&o.charAt(3)):(r[f++]=255&i.charAt(0),r[f++]=255&i.charAt(1),r[f++]=255&i.charAt(2),r[f++]=255&i.charAt(3)),c(r,f,15),c(r,f+=4,n.VBR_seek_table.nVbrNumFrames),f+=4;var p=n.VBR_seek_table.nBytesWritten+n.VBR_seek_table.TotalFrameSize;c(r,f,0|p),f+=4,Ca.arraycopy(l,0,r,f,l.length),f+=l.length,e.error_protection&&t.CRC_writeheader(n,r);var d=0;for(_=0;_<f;_++)d=m(r[_],d);return f+=function(e,t,s,r,n){var i,o,l,_,f,h=e.internal_flags,p=0,d=e.encoder_delay,b=e.encoder_padding,g=100-10*e.VBR_q-e.quality,v=a.getLameVeryShortVersion(),S=[1,5,3,2,4,0,3],w=0|(e.lowpassfreq/100+.5>255?255:e.lowpassfreq/100+.5),M=0,A=0,R=e.internal_flags.noise_shaping,E=0,y=0,k=0,T=!!(1&e.exp_nspsytune),B=!!(2&e.exp_nspsytune),x=!1,P=!1,I=e.internal_flags.nogap_total,L=e.internal_flags.nogap_current,C=e.ATHtype;switch(e.VBR){case vbr_abr:f=e.VBR_mean_bitrate_kbps;break;case vbr_off:f=e.brate;break;default:f=e.VBR_min_bitrate_kbps}switch(i=0+(e.VBR.ordinal()<S.length?S[e.VBR.ordinal()]:0),h.findReplayGain&&(h.RadioGain>510&&(h.RadioGain=510),h.RadioGain<-510&&(h.RadioGain=-510),A=8192,A|=3072,h.RadioGain>=0?A|=h.RadioGain:(A|=512,A|=-h.RadioGain)),h.findPeakSample&&(M=Math.abs(0|h.PeakSample/32767*Math.pow(2,23)+.5)),-1!=I&&(L>0&&(P=!0),L<I-1&&(x=!0)),_=C+((T?1:0)<<4)+((B?1:0)<<5)+((x?1:0)<<6)+((P?1:0)<<7),g<0&&(g=0),e.mode){case MONO:E=0;break;case STEREO:E=1;break;case DUAL_CHANNEL:E=2;break;case JOINT_STEREO:E=e.force_ms?4:3;break;case NOT_SET:default:E=7}k=e.in_samplerate<=32e3?0:48e3==e.in_samplerate?2:e.in_samplerate>48e3?3:1,(e.short_blocks==Oa.short_block_forced||e.short_blocks==Oa.short_block_dispensed||-1==e.lowpassfreq&&-1==e.highpassfreq||e.scale_left<e.scale_right||e.scale_left>e.scale_right||e.disable_reservoir&&e.brate<320||e.noATH||e.ATHonly||0==C||e.in_samplerate<=32e3)&&(y=1),o=R+(E<<2)+(y<<5)+(k<<6),l=h.nMusicCRC,c(s,r+p,g),p+=4;for(var N=0;N<9;N++)s[r+p+N]=255&v.charAt(N);s[r+(p+=9)]=255&i,s[r+ ++p]=255&w,c(s,r+ ++p,M),u(s,r+(p+=4),A),u(s,r+(p+=2),0),s[r+(p+=2)]=255&_,s[r+ ++p]=f>=255?255:255&f,s[r+ ++p]=255&d>>4,s[r+p+1]=255&(d<<4)+(b>>8),s[r+p+2]=255&b,s[r+(p+=3)]=255&o,p++,s[r+p++]=0,u(s,r+p,e.preset),c(s,r+(p+=2),t),u(s,r+(p+=4),l),p+=2;for(var O=0;O<p;O++)n=m(s[r+O],n);return u(s,r+p,n),p+2}(e,p,r,f,d),n.VBR_seek_table.TotalFrameSize},this.putVbrTag=function(e,t){if(e.internal_flags.VBR_seek_table.pos<=0)return-1;if(t.seek(t.length()),0==t.length())return-1;var a=function(e){e.seek(0);var t=Ha(10);return e.readFully(t),new String(t,"ISO-8859-1").startsWith("ID3")?0:((127&t[6])<<21|(127&t[7])<<14|(127&t[8])<<7|127&t[9])+t.length}(t);t.seek(a);var s=Ha(r),n=getLameTagFrame(e,s);return n>s.length?-1:(n<1||t.write(s,0,n),0)}}Va.NUMTOCENTRIES=100,Va.MAXFRAMESIZE=2880;var za=Va,Xa=W.new_byte,Ya=W.assert,qa=ha,Ua=pa,ja=tt,Ga=Bt,Wa=xa,Ka=Ht,Za=Ia,$a=he,Qa=Zt;Z();var Ja=La,es=za;function ts(){this.setModules=function(e,t){}}function as(){this.setModules=function(e,t,a){}}function ss(){}function rs(){this.setModules=function(e,t){}}function ns(){this.dataOffset=0,this.dataLen=0,this.channels=0,this.sampleRate=0}function is(e){return e.charCodeAt(0)<<24|e.charCodeAt(1)<<16|e.charCodeAt(2)<<8|e.charCodeAt(3)}ns.RIFF=is("RIFF"),ns.WAVE=is("WAVE"),ns.fmt_=is("fmt "),ns.data=is("data"),ns.readHeader=function(e){var t=new ns,a=e.getUint32(0,!1);if(ns.RIFF==a&&(e.getUint32(4,!0),ns.WAVE==e.getUint32(8,!1)&&ns.fmt_==e.getUint32(12,!1))){var s=e.getUint32(16,!0),r=20;switch(s){case 16:case 18:t.channels=e.getUint16(r+2,!0),t.sampleRate=e.getUint32(r+4,!0);break;default:throw"extended fmt chunk not implemented"}r+=s;for(var n=ns.data,i=0;n!=a&&(a=e.getUint32(r,!1),i=e.getUint32(r+4,!0),n!=a);)r+=i+8;return t.dataLen=i,t.dataOffset=r+8,t}};var os=P.Mp3Encoder=function(e,t,a){3!=arguments.length&&(console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified"),e=1,t=44100,a=128);var s=new qa,r=new ts,n=new ja,i=new Qa,o=new Ua,l=new Ga,_=new Wa,c=new es,u=new Ja,f=new rs,h=new Za,m=new Ka,p=new as,d=new ss;s.setModules(n,i,o,l,_,c,u,f,d),i.setModules(n,d,u,c),f.setModules(i,u),o.setModules(s),_.setModules(i,h,l,m),l.setModules(m,h,s.enc.psy),h.setModules(i),m.setModules(l),c.setModules(s,i,u),r.setModules(p,d),p.setModules(u,f,o);var b=s.lame_init();b.num_channels=e,b.in_samplerate=t,b.brate=a,b.mode=$a.STEREO,b.quality=3,b.bWriteVbrTag=!1,b.disable_reservoir=!0,b.write_id3tag_automatic=!1,s.lame_init_params(b);var g=1152,v=0|1.25*g+7200,S=Xa(v);this.encodeBuffer=function(t,a){1==e&&(a=t),Ya(t.length==a.length),t.length>g&&(g=t.length,S=Xa(v=0|1.25*g+7200));var r=s.lame_encode_buffer(b,t,a,t.length,S,0,v);return new Int8Array(S.subarray(0,r))},this.flush=function(){var e=s.lame_encode_flush(b,S,0,v);return new Int8Array(S.subarray(0,e))}},ls=a({__proto__:null,Mp3Encoder:os,WavHeader:P.WavHeader=ns,default:P},[P]);e.AudioConverter=w,e.ErrorCodes=o,e.EventEmitter=s,e.Logger=n,e.MURMURABA_VERSION=B,e.MetricsManager=_,e.MurmubaraEngine=u,e.MurmubaraError=i,e.StateManager=r,e.VERSION=T,e.WorkerManager=l,e.default=x,e.destroyEngine=b,e.getAudioConverter=A,e.getDiagnostics=v,e.getEngine=m,e.getEngineStatus=g,e.initializeAudioEngine=h,e.onMetricsUpdate=S,e.processStream=p,e.processStreamChunked=d,e.useAudioEngine=y,e.useMurmubaraEngine=R,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=index.umd.min.js.map
